
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>4. Navigating a cube &#8212; Iris 2.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="5. Subsetting a Cube" href="subsetting_a_cube.html" />
    <link rel="prev" title="3. Saving Iris cubes" href="saving_iris_cubes.html" />
 
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE"> 

    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script type="text/javascript" src="https://docs.python.org/2/_static/copybutton.js"></script>

    <link rel="icon" type="image/png" sizes="32x32" href="../_static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../_static/favicon-16x16.png">

    <link href="https://fonts.googleapis.com/css?family=Alike|Noto+Sans" rel="stylesheet">

  </head><body>

<a href="https://github.com/SciTools/iris">
    <img class="github-forkme" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
         alt="Fork Iris on GitHub" />
</a>


<div class="header-content">
    <a href="../index.html">
        <img src="../_static/Iris7_1_trim_100.png" alt="Iris logo" />
    </a>
    <div class="strapline">
      <h1>
          Iris <span class="version">v2.3</span>
      </h1>
      <p>
         A powerful, format-agnostic, community-driven Python library for analysing and
         visualising Earth science data.
      </p>
    </div>
</div>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="subsetting_a_cube.html" title="5. Subsetting a Cube"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="saving_iris_cubes.html" title="3. Saving Iris cubes"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../examples/index.html">examples</a>|&nbsp;</li>
        <li><a href="../gallery.html">gallery</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Iris user guide</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Navigating a cube</a><ul>
<li><a class="reference internal" href="#cube-string-representations">4.1. Cube string representations</a></li>
<li><a class="reference internal" href="#working-with-cubes">4.2. Working with cubes</a></li>
<li><a class="reference internal" href="#accessing-coordinates-on-the-cube">4.3. Accessing coordinates on the cube</a></li>
<li><a class="reference internal" href="#adding-metadata-to-a-cube">4.4. Adding metadata to a cube</a></li>
<li><a class="reference internal" href="#adding-and-removing-metadata-to-the-cube-at-load-time">4.5. Adding and removing metadata to the cube at load time</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="saving_iris_cubes.html"
                        title="previous chapter"><span class="section-number">3. </span>Saving Iris cubes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="subsetting_a_cube.html"
                        title="next chapter"><span class="section-number">5. </span>Subsetting a Cube</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/navigating_a_cube.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="navigating-a-cube">
<h1><span class="section-number">4. </span>Navigating a cube<a class="headerlink" href="#navigating-a-cube" title="Permalink to this headline">¶</a></h1>
<p>After loading any cube, you will want to investigate precisely what it contains. This section is all about accessing
and manipulating the metadata contained within a cube.</p>
<div class="section" id="cube-string-representations">
<h2><span class="section-number">4.1. </span>Cube string representations<a class="headerlink" href="#cube-string-representations" title="Permalink to this headline">¶</a></h2>
<p>We have already seen a basic string representation of a cube when printing:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">iris</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;rotated_pole.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">load_cube</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
<span class="go">air_pressure_at_sea_level / (Pa)    (grid_latitude: 22; grid_longitude: 36)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          grid_latitude                           x                   -</span>
<span class="go">          grid_longitude                          -                   x</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          forecast_period: 0.0 hours</span>
<span class="go">          forecast_reference_time: 2006-06-15 00:00:00</span>
<span class="go">          time: 2006-06-15 00:00:00</span>
<span class="go">     Attributes:</span>
<span class="go">          Conventions: CF-1.5</span>
<span class="go">          STASH: m01s16i222</span>
<span class="go">          source: Data from Met Office Unified Model 6.01</span>
</pre></div>
</div>
<p>This representation is equivalent to passing the cube to the <code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code> function.  This function can be used on
any Python variable to get a string representation of that variable.
Similarly there exist other standard functions for interrogating your variable: <a class="reference external" href="https://docs.python.org/2.7/library/functions.html#repr" title="(in Python v2.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a>, <code class="xref py py-func docutils literal notranslate"><span class="pre">type()</span></code> for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cube</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">cube</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">cube</span><span class="p">))</span>
</pre></div>
</div>
<p>Other, more verbose, functions also exist which give information on <strong>what</strong> you can do with <em>any</em> given
variable. In most cases it is reasonable to ignore anything starting with a “<code class="docutils literal notranslate"><span class="pre">_</span></code>” (underscore) or a “<code class="docutils literal notranslate"><span class="pre">__</span></code>” (double underscore):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
<span class="n">help</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-cubes">
<h2><span class="section-number">4.2. </span>Working with cubes<a class="headerlink" href="#working-with-cubes" title="Permalink to this headline">¶</a></h2>
<p>Every cube has a standard name, long name and units which are accessed with
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.standard_name" title="iris.cube.Cube.standard_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Cube.standard_name</span></code></a>,
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.long_name" title="iris.cube.Cube.long_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Cube.long_name</span></code></a>
and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.units" title="iris.cube.Cube.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Cube.units</span></code></a> respectively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">standard_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
<p>Interrogating these with the standard <code class="xref py py-func docutils literal notranslate"><span class="pre">type()</span></code> function will tell you that <code class="docutils literal notranslate"><span class="pre">standard_name</span></code> and <code class="docutils literal notranslate"><span class="pre">long_name</span></code>
are either a string or <code class="docutils literal notranslate"><span class="pre">None</span></code>, and <code class="docutils literal notranslate"><span class="pre">units</span></code> is an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">iris.unit.Unit</span></code>.</p>
<p>You can access a string representing the “name” of a cube with the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.name" title="iris.cube.Cube.name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cube.name()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
</pre></div>
</div>
<p>The result of which is <strong>always</strong> a string.</p>
<p>Each cube also has a <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/index.html#module-numpy" title="(in NumPy v1.17)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code></a> array which represents the phenomenon of the cube which can be accessed with the
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.data" title="iris.cube.Cube.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Cube.data</span></code></a> attribute. As you can see the type is a <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.17)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy</span> <span class="pre">n-dimensional</span> <span class="pre">array</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When loading from most file formats in Iris, the data itself is not loaded until the <strong>first</strong> time that the data is requested.
Hence you may have noticed that running the previous command for the first time takes a little longer than it does for
subsequent calls.</p>
<p>For this reason, when you have a large cube it is strongly recommended that you do not access the cube’s data unless
you need to.
For convenience <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.shape" title="iris.cube.Cube.shape"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shape</span></code></a> and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.ndim" title="iris.cube.Cube.ndim"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ndim</span></code></a> attributes exists on a cube, which
can tell you the shape of the cube’s data without loading it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
</pre></div>
</div>
<p>For more on the benefits, handling and uses of lazy data, see
<a class="reference internal" href="real_and_lazy_data.html"><span class="doc">Real and Lazy Data</span></a></p>
</div>
<p>You can change the units of a cube using the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.convert_units" title="iris.cube.Cube.convert_units"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_units()</span></code></a> method. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="s1">&#39;celsius&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As well as changing the value of the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.units" title="iris.cube.Cube.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">units</span></code></a> attribute this will also convert the values in
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.data" title="iris.cube.Cube.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a>. To replace the units without modifying the data values one can change the
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.units" title="iris.cube.Cube.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">units</span></code></a> attribute directly.</p>
<p>Some cubes represent a processed phenomenon which are represented with cell methods, these can be accessed on a
cube with the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.cell_methods" title="iris.cube.Cube.cell_methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Cube.cell_methods</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-coordinates-on-the-cube">
<h2><span class="section-number">4.3. </span>Accessing coordinates on the cube<a class="headerlink" href="#accessing-coordinates-on-the-cube" title="Permalink to this headline">¶</a></h2>
<p>A cube’s coordinates can be retrieved via <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.coords" title="iris.cube.Cube.coords"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cube.coords</span></code></a>.
A simple for loop over the coords can print a coordinate’s <a class="reference internal" href="../iris/iris/coords.html#iris.coords.Coord.name" title="iris.coords.Coord.name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">name()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">cube</span><span class="o">.</span><span class="n">coords</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
</pre></div>
</div>
<p>Alternatively, we can use <em>list comprehension</em> to store the names in a list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coord_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">cube</span><span class="o">.</span><span class="n">coords</span><span class="p">()]</span>
</pre></div>
</div>
<p>The result is a basic Python list which could be sorted alphabetically and joined together:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">coord_names</span><span class="p">)))</span>
<span class="go">forecast_period, forecast_reference_time, grid_latitude, grid_longitude, time</span>
</pre></div>
</div>
<p>To get an individual coordinate given its name, the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.coord" title="iris.cube.Cube.coord"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cube.coord</span></code></a> method can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coord</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;grid_latitude&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">coord</span><span class="p">))</span>
</pre></div>
</div>
<p>Every coordinate has a <a class="reference internal" href="../iris/iris/coords.html#iris.coords.Coord.standard_name" title="iris.coords.Coord.standard_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Coord.standard_name</span></code></a>,
<a class="reference internal" href="../iris/iris/coords.html#iris.coords.Coord.long_name" title="iris.coords.Coord.long_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Coord.long_name</span></code></a>, and <a class="reference internal" href="../iris/iris/coords.html#iris.coords.Coord.units" title="iris.coords.Coord.units"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Coord.units</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">standard_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally every coordinate can provide its <a class="reference internal" href="../iris/iris/coords.html#iris.coords.Coord.points" title="iris.coords.Coord.points"><code class="xref py py-attr docutils literal notranslate"><span class="pre">points</span></code></a> and <a class="reference internal" href="../iris/iris/coords.html#iris.coords.Coord.bounds" title="iris.coords.Coord.bounds"><code class="xref py py-attr docutils literal notranslate"><span class="pre">bounds</span></code></a>
numpy array. If the coordinate has no bounds <code class="docutils literal notranslate"><span class="pre">None</span></code> will be returned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">bounds</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-metadata-to-a-cube">
<h2><span class="section-number">4.4. </span>Adding metadata to a cube<a class="headerlink" href="#adding-metadata-to-a-cube" title="Permalink to this headline">¶</a></h2>
<p>We can add and remove coordinates via <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.add_dim_coord" title="iris.cube.Cube.add_dim_coord"><code class="xref py py-func docutils literal notranslate"><span class="pre">Cube.add_dim_coord</span></code></a>,
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.add_aux_coord" title="iris.cube.Cube.add_aux_coord"><code class="xref py py-func docutils literal notranslate"><span class="pre">Cube.add_aux_coord</span></code></a>, and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.remove_coord" title="iris.cube.Cube.remove_coord"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cube.remove_coord</span></code></a>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">iris.coords</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_coord</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">AuxCoord</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s1">&#39;my_custom_coordinate&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;no_unit&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cube</span><span class="o">.</span><span class="n">add_aux_coord</span><span class="p">(</span><span class="n">new_coord</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
<span class="go">air_pressure_at_sea_level / (Pa)    (grid_latitude: 22; grid_longitude: 36)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          grid_latitude                           x                   -</span>
<span class="go">          grid_longitude                          -                   x</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          forecast_period: 0.0 hours</span>
<span class="go">          forecast_reference_time: 2006-06-15 00:00:00</span>
<span class="go">          my_custom_coordinate: 1</span>
<span class="go">          time: 2006-06-15 00:00:00</span>
<span class="go">     Attributes:</span>
<span class="go">          Conventions: CF-1.5</span>
<span class="go">          STASH: m01s16i222</span>
<span class="go">          source: Data from Met Office Unified Model 6.01</span>
</pre></div>
</div>
<p>The coordinate <code class="docutils literal notranslate"><span class="pre">my_custom_coordinate</span></code> now exists on the cube and is listed under the non-dimensioned single valued scalar coordinates.</p>
</div>
<div class="section" id="adding-and-removing-metadata-to-the-cube-at-load-time">
<h2><span class="section-number">4.5. </span>Adding and removing metadata to the cube at load time<a class="headerlink" href="#adding-and-removing-metadata-to-the-cube-at-load-time" title="Permalink to this headline">¶</a></h2>
<p>Sometimes when loading a cube problems occur when the amount of metadata is more or less than expected.
This is often caused by one of the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>The file does not contain enough metadata, and therefore the cube cannot know everything about the file.</p></li>
<li><p>Some of the metadata of the file is contained in the filename, but is not part of the actual file.</p></li>
<li><p>There is not enough metadata loaded from the original file as Iris has not handled the format fully. <em>(in which case,
please let us know about it)</em></p></li>
</ul>
</div></blockquote>
<p>To solve this, all of <a class="reference internal" href="../iris/iris.html#iris.load" title="iris.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.load()</span></code></a>, <a class="reference internal" href="../iris/iris.html#iris.load_cube" title="iris.load_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.load_cube()</span></code></a>, and <a class="reference internal" href="../iris/iris.html#iris.load_cubes" title="iris.load_cubes"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.load_cubes()</span></code></a> support a callback keyword.</p>
<p>The callback is a user defined function which must have the calling sequence <code class="docutils literal notranslate"><span class="pre">function(cube,</span> <span class="pre">field,</span> <span class="pre">filename)</span></code>
which can make any modifications to the cube in-place, or alternatively return a completely new cube instance.</p>
<p>Suppose we wish to load a lagged ensemble dataset from the Met Office’s GloSea4 model.
The data for this example represents 13 ensemble members of 6 one month timesteps; the logistics of the
model mean that the run is spread over several days.</p>
<p>If we try to load the data directly for <code class="docutils literal notranslate"><span class="pre">surface_temperature</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;GloSea4&#39;</span><span class="p">,</span> <span class="s1">&#39;*.pp&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;surface_temperature&#39;</span><span class="p">))</span>
<span class="go">0: surface_temperature / (K)           (time: 6; forecast_reference_time: 2; latitude: 145; longitude: 192)</span>
<span class="go">1: surface_temperature / (K)           (time: 6; forecast_reference_time: 2; latitude: 145; longitude: 192)</span>
<span class="go">2: surface_temperature / (K)           (realization: 9; time: 6; latitude: 145; longitude: 192)</span>
</pre></div>
</div>
<p>We get multiple cubes some with more dimensions than expected, some without a <code class="docutils literal notranslate"><span class="pre">realization</span></code> (i.e. ensemble member) dimension.
In this case, two of the PP files have been encoded without the appropriate <code class="docutils literal notranslate"><span class="pre">realization</span></code> number attribute, which means that
the appropriate coordinate cannot be added to the resultant cube. Fortunately, the missing attribute has been encoded in the filename
which, given the filename, we could extract:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;GloSea4&#39;</span><span class="p">,</span> <span class="s1">&#39;ensemble_001.pp&#39;</span><span class="p">)</span>
<span class="n">realization</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">realization</span><span class="p">)</span>
</pre></div>
</div>
<p>We can solve this problem by adding the appropriate metadata, on load, by using a callback function, which runs on a field
by field basis <em>before</em> they are automatically merged together:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">iris</span>
<span class="kn">import</span> <span class="nn">iris.coords</span> <span class="k">as</span> <span class="nn">icoords</span>

<span class="k">def</span> <span class="nf">lagged_ensemble_callback</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="c1"># Add our own realization coordinate if it doesn&#39;t already exist.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cube</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="s1">&#39;realization&#39;</span><span class="p">):</span>
        <span class="n">realization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ensemble_coord</span> <span class="o">=</span> <span class="n">icoords</span><span class="o">.</span><span class="n">AuxCoord</span><span class="p">(</span><span class="n">realization</span><span class="p">,</span> <span class="n">standard_name</span><span class="o">=</span><span class="s1">&#39;realization&#39;</span><span class="p">)</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">add_aux_coord</span><span class="p">(</span><span class="n">ensemble_coord</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;GloSea4&#39;</span><span class="p">,</span> <span class="s1">&#39;*.pp&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;surface_temperature&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">lagged_ensemble_callback</span><span class="p">))</span>
</pre></div>
</div>
<p>The result is a single cube which represents the data in a form that was expected:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0: surface_temperature / (K)           (realization: 13; time: 6; latitude: 145; longitude: 192)
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="subsetting_a_cube.html" title="5. Subsetting a Cube"
             >next</a> |</li>
        <li class="right" >
          <a href="saving_iris_cubes.html" title="3. Saving Iris cubes"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../examples/index.html">examples</a>|&nbsp;</li>
        <li><a href="../gallery.html">gallery</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Iris user guide</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer">
    <p style="text-align: left; float: left; margin: 0px; padding: 0 0 0 5px;">Documentation licensed under the <a href="http://reference.data.gov.uk/id/open-government-licence" rel="license">Open Government Licence</a></p>
        &copy; <a href="../copyright.html">British Crown Copyright</a> 2010 - 2019, Met Office
    </div>

    <!-- Include a version switcher to easily move between the documentation of different versions -->
    <script type=text/javascript src="/iris/docs/version_switch.js" async></script>

  </body>
</html>