
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>9. Merge and Concatenate &#8212; Iris 2.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="10. Cube statistics" href="cube_statistics.html" />
    <link rel="prev" title="8. Cube interpolation and regridding" href="interpolation_and_regridding.html" />
 
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE"> 

    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script type="text/javascript" src="https://docs.python.org/2/_static/copybutton.js"></script>

    <link rel="icon" type="image/png" sizes="32x32" href="../_static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../_static/favicon-16x16.png">

    <link href="https://fonts.googleapis.com/css?family=Alike|Noto+Sans" rel="stylesheet">

  </head><body>

<a href="https://github.com/SciTools/iris">
    <img class="github-forkme" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
         alt="Fork Iris on GitHub" />
</a>


<div class="header-content">
    <a href="../index.html">
        <img src="../_static/Iris7_1_trim_100.png" alt="Iris logo" />
    </a>
    <div class="strapline">
      <h1>
          Iris <span class="version">v2.3</span>
      </h1>
      <p>
         A powerful, format-agnostic, community-driven Python library for analysing and
         visualising Earth science data.
      </p>
    </div>
</div>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cube_statistics.html" title="10. Cube statistics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="interpolation_and_regridding.html" title="8. Cube interpolation and regridding"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../examples/index.html">examples</a>|&nbsp;</li>
        <li><a href="../gallery.html">gallery</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Iris user guide</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9. Merge and Concatenate</a><ul>
<li><a class="reference internal" href="#merge">9.1. Merge</a><ul>
<li><a class="reference internal" href="#using-cubelist-merge">9.1.1. Using CubeList.merge</a></li>
<li><a class="reference internal" href="#using-cubelist-merge-cube">9.1.2. Using CubeList.merge_cube</a></li>
<li><a class="reference internal" href="#merge-in-iris-load">9.1.3. Merge in Iris load</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concatenate">9.2. Concatenate</a><ul>
<li><a class="reference internal" href="#using-cubelist-concatenate">9.2.1. Using CubeList.concatenate</a></li>
<li><a class="reference internal" href="#using-cubelist-concatenate-cube">9.2.2. Using CubeList.concatenate_cube</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-issues-with-merge-and-concatenate">9.3. Common issues with merge and concatenate</a><ul>
<li><a class="reference internal" href="#id1">9.3.1. Merge</a></li>
<li><a class="reference internal" href="#id2">9.3.2. Concatenate</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="interpolation_and_regridding.html"
                        title="previous chapter"><span class="section-number">8. </span>Cube interpolation and regridding</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cube_statistics.html"
                        title="next chapter"><span class="section-number">10. </span>Cube statistics</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/merge_and_concat.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="merge-and-concatenate">
<span id="merge-and-concat"></span><h1><span class="section-number">9. </span>Merge and Concatenate<a class="headerlink" href="#merge-and-concatenate" title="Permalink to this headline">¶</a></h1>
<p>We saw in the <a class="reference internal" href="loading_iris_cubes.html"><span class="doc">Loading Iris cubes</span></a> chapter that Iris tries to load as few cubes as
possible. This is done by collecting together multiple fields with a shared standard
name (and other key metadata) into a single multidimensional cube. The processes that
perform this behaviour in Iris are known as <code class="docutils literal notranslate"><span class="pre">merge</span></code> and <code class="docutils literal notranslate"><span class="pre">concatenate</span></code>.</p>
<p>This chapter describes the <code class="docutils literal notranslate"><span class="pre">merge</span></code> and <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> processes; it explains
why common issues occur when using them and gives advice on how prevent these
issues from occurring.</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">merge</span></code> and <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> take multiple cubes as input and
result in fewer cubes as output. The following diagram illustrates the two processes:</p>
<img alt="Pictographic of merge and concatenation." class="align-center" src="../_images/merge_and_concat.png" />
<p>There is one major difference between the <code class="docutils literal notranslate"><span class="pre">merge</span></code> and <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> processes.</p>
<blockquote>
<div><ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> process combines multiple input cubes into a
single resultant cube with new dimensions created from the
<em>scalar coordinate values</em> of the input cubes.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process combines multiple input cubes into a
single resultant cube with the same <em>number of dimensions</em> as the input cubes,
but with the length of one or more dimensions extended by <em>joining together
sequential dimension coordinates</em>.</p></li>
</ul>
</div></blockquote>
<p>Let’s imagine 28 individual cubes representing the
temperature at a location <code class="docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">x)</span></code>; one cube for each day of February. We can use
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> to combine the 28 <code class="docutils literal notranslate"><span class="pre">(y,</span> <span class="pre">x)</span></code> cubes into
a single <code class="docutils literal notranslate"><span class="pre">(t,</span> <span class="pre">y,</span> <span class="pre">x)</span></code> cube, where the length of the <code class="docutils literal notranslate"><span class="pre">t</span></code> dimension is 28.</p>
<p>Now imagine 12 individual cubes representing daily temperature at a time and
location <code class="docutils literal notranslate"><span class="pre">(t,</span> <span class="pre">y,</span> <span class="pre">x)</span></code>; one cube for each month in the year. We can use
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> to combine the 12
<code class="docutils literal notranslate"><span class="pre">(t,</span> <span class="pre">y,</span> <span class="pre">x)</span></code> cubes into a single <code class="docutils literal notranslate"><span class="pre">(t,</span> <span class="pre">y,</span> <span class="pre">x)</span></code> cube, where the length
of the <code class="docutils literal notranslate"><span class="pre">t</span></code> dimension is now 365.</p>
<div class="section" id="merge">
<h2><span class="section-number">9.1. </span>Merge<a class="headerlink" href="#merge" title="Permalink to this headline">¶</a></h2>
<p>We’ve seen that the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process combines multiple input cubes into a
single resultant cube with new dimensions created from the
<em>scalar coordinate values</em> of the input cubes.</p>
<p>In order to construct new coordinates for the new dimensions, the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process requires input cubes
with scalar coordinates that can be combined together into monotonic sequences.
The order of the input cubes does not affect the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> process can produce a cube that has more than one new dimension,
if the scalar coordinate sequences form an orthogonal basis.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The shape, metadata, attributes, coordinates, coordinates metadata, fill value and
other aspects of the input cubes must be consistent across all of the input cubes.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> process will fail if these are not consistent. Such failures are
covered in the <a class="reference internal" href="#merge-concat-common-issues"><span class="std std-ref">Common issues with merge and concatenate</span></a> section.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> process can be accessed using two methods. The two methods are
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a>,
which are described below.</p>
<div class="section" id="using-cubelist-merge">
<h3><span class="section-number">9.1.1. </span>Using CubeList.merge<a class="headerlink" href="#using-cubelist-merge" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CubeList.merge</span></code></a> method operates on a list
of cubes and returns a new <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a> containing the cubes
that have been merged.</p>
<p>Let’s have a look at the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> method in operation.
In this example we have a list of three lateral (<em>x</em>, <em>y</em>) cubes in a
variable called <code class="docutils literal notranslate"><span class="pre">cubes</span></code>, each with a scalar <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate of
differing value. We can merge these cubes by stacking the scalar <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinates to
make a new <code class="docutils literal notranslate"><span class="pre">z</span></code> dimension coordinate:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">2: air_temperature / (kelvin)          (y: 4; x: 5)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go"> ...</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          z: 1 meters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go"> ...</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          z: 2 meters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go"> ...</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          z: 3 meters</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge</span><span class="p">())</span>
<span class="go">0: air_temperature / (kelvin)          (z: 3; y: 4; x: 5)</span>
</pre></div>
</div>
<p>The following diagram illustrates what has taken place in this example:</p>
<img alt="Pictographic of merge." class="align-center" src="../_images/merge.png" />
<p>The diagram illustrates that we have three input cubes of identical shape
that stack on the <code class="docutils literal notranslate"><span class="pre">z</span></code> dimension.
After merging our three input cubes we get a new <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a> containing
one cube with a new <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate.</p>
</div>
<div class="section" id="using-cubelist-merge-cube">
<h3><span class="section-number">9.1.2. </span>Using CubeList.merge_cube<a class="headerlink" href="#using-cubelist-merge-cube" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a> method guarantees that <em>exactly one cube will be returned</em>
as a result of merging the input cubes.
If <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a> cannot fulfil this guarantee, a descriptive error
will be raised providing details to help diagnose the differences between the input cubes.
In contrast, the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> method makes no check on the number of cubes returned.</p>
<p>To demonstrate the differences between <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a>
and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a>, let’s return to our three cubes
from the earlier merge example.</p>
<p>For the purposes of this example a <code class="docutils literal notranslate"><span class="pre">Conventions</span></code> attribute has been added to the first
cube’s <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.attributes" title="iris.cube.Cube.attributes"><code class="xref py py-data docutils literal notranslate"><span class="pre">attributes</span></code></a> dictionary.
Remember that the attributes <em>must</em> be consistent across all cubes in order to merge
into a single cube:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">2: air_temperature / (kelvin)          (y: 4; x: 5)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{&#39;Conventions&#39;: &#39;CF-1.5&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge</span><span class="p">())</span>
<span class="go">0: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (z: 2; y: 4; x: 5)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge_cube</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
    <span class="k">raise</span> <span class="n">iris</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">MergeError</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>
<span class="gr">iris.exceptions.MergeError</span>: <span class="n">failed to merge into a single cube.</span>
<span class="go">  cube.attributes keys differ: &#39;Conventions&#39;</span>
</pre></div>
</div>
<p>Note that <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> returns two cubes here.
All the cubes that can be merged have been merged. Any cubes that can’t be merged are
included unchanged in the returned <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a>.
When <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a> is called on <code class="docutils literal notranslate"><span class="pre">cubes</span></code> it raises a
descriptive error that highlights the difference in the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> dictionaries.
It is this difference that is preventing <code class="docutils literal notranslate"><span class="pre">cubes</span></code> being merged into a
single cube. An example of fixing an issue like this can be found in the
<a class="reference internal" href="#merge-concat-common-issues"><span class="std std-ref">Common issues with merge and concatenate</span></a> section.</p>
</div>
<div class="section" id="merge-in-iris-load">
<h3><span class="section-number">9.1.3. </span>Merge in Iris load<a class="headerlink" href="#merge-in-iris-load" title="Permalink to this headline">¶</a></h3>
<p>The CubeList’s <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> method is used internally
by the three main Iris load functions introduced in <a class="reference internal" href="loading_iris_cubes.html"><span class="doc">Loading Iris cubes</span></a>.
For file formats such as GRIB and PP, which store fields as many
individual 2D arrays, Iris loading uses the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process to produce a
more intuitive higher dimensional cube of each phenomenon where possible.</p>
<p>Sometimes the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process doesn’t behave as expected. In almost all
cases this is due to the input cubes containing unexpected or inconsistent metadata.
For this reason, a fourth Iris file loading function, <a class="reference internal" href="../iris/iris.html#iris.load_raw" title="iris.load_raw"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.load_raw()</span></code></a>, exists.
The <a class="reference internal" href="../iris/iris.html#iris.load_raw" title="iris.load_raw"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_raw()</span></code></a> function is intended as a diagnostic tool that can be used to
load cubes from files without the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process taking place. The return value of
<a class="reference internal" href="../iris/iris.html#iris.load_raw" title="iris.load_raw"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.load_raw()</span></code></a> is always a <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a> instance.
You can then call the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a> method on this returned
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a> to help identify merge related load issues.</p>
</div>
</div>
<div class="section" id="concatenate">
<h2><span class="section-number">9.2. </span>Concatenate<a class="headerlink" href="#concatenate" title="Permalink to this headline">¶</a></h2>
<p>We’ve seen that the <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process combines multiple input cubes into a
single resultant cube with the same <em>number of dimensions</em> as the input cubes,
but with the length of one or more dimensions extended by <em>joining together
sequential dimension coordinates</em>.</p>
<p>In order to extend the dimensions lengths, the <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process requires input cubes
with dimension coordinates that can be combined together into monotonic sequences.
The order of the input cubes does not affect the <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The shape, metadata, attributes, coordinates, coordinates metadata, fill value and
other aspects of the input cubes must be consistent across all of the input cubes.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process will fail if these are not consistent. Such failures are
covered in the <a class="reference internal" href="#merge-concat-common-issues"><span class="std std-ref">Common issues with merge and concatenate</span></a> section.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process can be accessed using two methods. The two methods are
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a>,
which are described below.</p>
<div class="section" id="using-cubelist-concatenate">
<h3><span class="section-number">9.2.1. </span>Using CubeList.concatenate<a class="headerlink" href="#using-cubelist-concatenate" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CubeList.concatenate</span></code></a> method operates on a list
of cubes and returns a new <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a> containing the cubes
that have been concatenated.</p>
<p>Let’s have a look at the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> method in operation.
In the example below we have three 3D <code class="docutils literal notranslate"><span class="pre">(t,</span> <span class="pre">y,</span> <span class="pre">x)</span></code> cubes whose <code class="docutils literal notranslate"><span class="pre">t</span></code> coordinates
have sequentially increasing ranges.
These cubes can be concatenated by combining the <code class="docutils literal notranslate"><span class="pre">t</span></code> coordinates of the input
cubes to form a new cube with an extended <code class="docutils literal notranslate"><span class="pre">t</span></code> coordinate:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>
<span class="go">1: air_temperature / (kelvin)          (t: 28; y: 3; x: 4)</span>
<span class="go">2: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">concatenate</span><span class="p">())</span>
<span class="go">0: air_temperature / (kelvin)          (t: 90; y: 3; x: 4)</span>
</pre></div>
</div>
<p>The following diagram illustrates what has taken place in this example:</p>
<img alt="Pictographic of concatenate." class="align-center" src="../_images/concat.png" />
<p>The diagram illustrates that we have three 3D input cubes
that line up on the <code class="docutils literal notranslate"><span class="pre">t</span></code> dimension.
After concatenating our three input cubes we get a new <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a>
containing one cube with an extended <code class="docutils literal notranslate"><span class="pre">t</span></code> coordinate.</p>
</div>
<div class="section" id="using-cubelist-concatenate-cube">
<h3><span class="section-number">9.2.2. </span>Using CubeList.concatenate_cube<a class="headerlink" href="#using-cubelist-concatenate-cube" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a> method guarantees that <em>exactly one
cube will be returned</em> as a result of concatenating the input cubes.
If <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a> cannot fulfil this guarantee, a descriptive error
will be raised providing details to help diagnose the differences between the input cubes.
In contrast, the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> method makes no check on the number
of cubes returned.</p>
<p>To demonstrate the differences between <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a>
and <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a>, let’s return to our three cubes
from the earlier concatenate example.</p>
<p>For the purposes of this example we’ll add a <em>History</em> attribute to the first
cube’s <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.attributes" title="iris.cube.Cube.attributes"><code class="xref py py-data docutils literal notranslate"><span class="pre">attributes</span></code></a> dictionary.
Remember that the attributes <em>must</em> be consistent across all cubes in order to
concatenate into a single cube:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>
<span class="go">1: air_temperature / (kelvin)          (t: 28; y: 3; x: 4)</span>
<span class="go">2: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{&#39;History&#39;: &#39;Created 2010-06-30&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">concatenate</span><span class="p">())</span>
<span class="go">0: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>
<span class="go">1: air_temperature / (kelvin)          (t: 59; y: 3; x: 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">concatenate_cube</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
    <span class="k">raise</span> <span class="n">iris</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConcatenateError</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>
<span class="gr">iris.exceptions.ConcatenateError</span>: <span class="n">failed to concatenate into a single cube.</span>
<span class="go">  Cube metadata differs for phenomenon: air_temperature</span>
</pre></div>
</div>
<p>Note that <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> returns two cubes here.
All the cubes that can be concatenated have been concatenated. Any cubes that can’t be concatenated are
included unchanged in the returned <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList" title="iris.cube.CubeList"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubeList</span></code></a>.
When <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a> is called on <code class="docutils literal notranslate"><span class="pre">cubes</span></code> it raises a
descriptive error that highlights the difference in the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> dictionaries.
It is this difference that is preventing <code class="docutils literal notranslate"><span class="pre">cubes</span></code> being concatenated into a
single cube. An example of fixing an issue like this can be found in the
<a class="reference internal" href="#merge-concat-common-issues"><span class="std std-ref">Common issues with merge and concatenate</span></a> section.</p>
</div>
</div>
<div class="section" id="common-issues-with-merge-and-concatenate">
<span id="merge-concat-common-issues"></span><h2><span class="section-number">9.3. </span>Common issues with merge and concatenate<a class="headerlink" href="#common-issues-with-merge-and-concatenate" title="Permalink to this headline">¶</a></h2>
<p>The Iris algorithms that drive <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> and
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> are complex and depend
on a number of different elements of the input cubes being consistent across
all input cubes.
If this consistency is not maintained then the
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> or
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> process can fail in a
seemingly arbitrary manner.</p>
<p>The methods <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a> and
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a>
were introduced to Iris to help you locate differences in input cubes
that prevent the input cubes merging or concatenating.
Nevertheless, certain difficulties with using
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> and
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> occur frequently.
This section describes these common difficulties, why they arise and
what you can do to avoid them.</p>
<div class="section" id="id1">
<h3><span class="section-number">9.3.1. </span>Merge<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p id="merge-issues-attrs-mismatch"><strong>Attributes Mismatch</strong></p>
<p>Differences in the <a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.attributes" title="iris.cube.Cube.attributes"><code class="xref py py-data docutils literal notranslate"><span class="pre">attributes</span></code></a> the input cubes probably
cause the greatest amount of merge-related difficulties.
In recognition of this, Iris has a helper function,
<a class="reference internal" href="../iris/iris/experimental/equalise_cubes.html#iris.experimental.equalise_cubes.equalise_attributes" title="iris.experimental.equalise_cubes.equalise_attributes"><code class="xref py py-func docutils literal notranslate"><span class="pre">equalise_attributes()</span></code></a>, to equalise
attributes differences in the input cubes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The functionality provided by <a class="reference internal" href="../iris/iris/util.html#iris.util.describe_diff" title="iris.util.describe_diff"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.util.describe_diff()</span></code></a> and
<a class="reference internal" href="../iris/iris/cube.html#iris.cube.Cube.is_compatible" title="iris.cube.Cube.is_compatible"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iris.cube.Cube.is_compatible()</span></code></a> are <strong>not</strong> designed to give user
indication of whether two cubes can be merged.</p>
</div>
<p>To demonstrate using <a class="reference internal" href="../iris/iris/experimental/equalise_cubes.html#iris.experimental.equalise_cubes.equalise_attributes" title="iris.experimental.equalise_cubes.equalise_attributes"><code class="xref py py-func docutils literal notranslate"><span class="pre">equalise_attributes()</span></code></a>,
let’s return to our non-merging list of input cubes from the merge_cube example
from earlier.
We’ll call <a class="reference internal" href="../iris/iris/experimental/equalise_cubes.html#iris.experimental.equalise_cubes.equalise_attributes" title="iris.experimental.equalise_cubes.equalise_attributes"><code class="xref py py-func docutils literal notranslate"><span class="pre">equalise_attributes()</span></code></a> on the
input cubes before merging the input cubes using <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge_cube" title="iris.cube.CubeList.merge_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_cube()</span></code></a>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">iris.experimental.equalise_cubes</span> <span class="kn">import</span> <span class="n">equalise_attributes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">2: air_temperature / (kelvin)          (y: 4; x: 5)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{&#39;Conventions&#39;: &#39;CF-1.5&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge_cube</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
    <span class="k">raise</span> <span class="n">iris</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">MergeError</span><span class="p">(</span><span class="n">msgs</span><span class="p">)</span>
<span class="gr">iris.exceptions.MergeError</span>: <span class="n">failed to merge into a single cube.</span>
<span class="go">  cube.attributes keys differ: &#39;Conventions&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">equalise_attributes</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>
<span class="go">{}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge_cube</span><span class="p">())</span>
<span class="go">air_temperature / (kelvin)          (z: 3; y: 4; x: 5)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          z                           x     -     -</span>
<span class="go">          y                           -     x     -</span>
<span class="go">          x                           -     -     x</span>
</pre></div>
</div>
<p><strong>Incomplete Data</strong></p>
<p>Merging input cubes with inconsistent dimension lengths can cause misleading results.
This is a common problem when merging cubes generated by different ensemble members in a model run.</p>
<p>The misleading results cause the merged cube to gain an anonymous leading dimension.
All the merged coordinates appear as auxiliary coordinates on the anonymous leading dimension.
This is shown in the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
<span class="go">surface_temperature / (K)           (-- : 5494; latitude: 325; longitude: 432)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          latitude                      -               x               -</span>
<span class="go">          longitude                     -               -               x</span>
<span class="go">     Auxiliary coordinates:</span>
<span class="go">          forecast_month                x               -               -</span>
<span class="go">          forecast_period               x               -               -</span>
<span class="go">          forecast_reference_time       x               -               -</span>
<span class="go">          realization                   x               -               -</span>
<span class="go">          time                          x               -               -</span>
</pre></div>
</div>
<p><strong>Merging Duplicate Cubes</strong></p>
<p>The Iris load process does not merge duplicate cubes (two or more identical cubes in
the input cubes) by default.
This behaviour can be changed by setting the <code class="docutils literal notranslate"><span class="pre">unique</span></code> keyword argument
to <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>Merging duplicate cubes can cause misleading results. Let’s demonstrate these
behaviours and misleading results with the following example.
In this example we have three input cubes.
The first has a scalar <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate with value 1, the second has a
scalar <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate with value 2 and the third has a scalar <code class="docutils literal notranslate"><span class="pre">z</span></code>
coordinate with value 1.
The first and third cubes are thus identical.
We will demonstrate the effect of merging the input cubes with <code class="docutils literal notranslate"><span class="pre">unique=False</span></code>
(duplicate cubes allowed) and <code class="docutils literal notranslate"><span class="pre">unique=True</span></code> (duplicate cubes not allowed, which
is the default behaviour):</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">2: air_temperature / (kelvin)          (y: 4; x: 5)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="go">0: air_temperature / (kelvin)          (z: 2; y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (z: 2; y: 4; x: 5)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">merge</span><span class="p">())</span>  <span class="c1"># unique=True is the default.</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">iris.exceptions.DuplicateDataError</span>: <span class="n">failed to merge into a single cube.</span>
<span class="go">  Duplicate &#39;air_temperature&#39; cube, with scalar coordinates z=Cell(point=1, bound=None)</span>
</pre></div>
</div>
<p>Notice how merging the input cubes with duplicate cubes allowed produces a result
with <strong>four</strong> <cite>z</cite> coordinate values.
Closer inspection of these two resultant cubes demonstrates that the
scalar <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate with value 2 is found in both cubes.</p>
<p>Trying to merge the input cubes with duplicate cubes not allowed raises an
error highlighting the presence of the duplicate cube.</p>
<p><strong>Single value coordinates</strong></p>
<p>Coordinates containing only a single value can cause confusion when
combining input cubes. Remember:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">merge</span></code> process combines multiple input cubes into a
single resultant cube with new dimensions created from the
<strong>scalar</strong> <em>coordinate values</em> of the input cubes.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process combines multiple input cubes into a
single resultant cube with the same <em>number of dimensions</em> as the input cubes,
but with the length of one or more dimensions extended by <em>joining together
sequential</em> <strong>dimension</strong> <em>coordinates</em>.</p></li>
</ul>
<p>In Iris terminology a <strong>scalar</strong> coordinate is a
coordinate of length 1 <em>which does not describe a data dimension</em>.</p>
<p>Let’s look at two example cubes to demonstrate this.</p>
<p>If your cubes are similar to those below (the single value <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate
is not on a dimension) then use <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.merge" title="iris.cube.CubeList.merge"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge()</span></code></a> to
combine your cubes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          x                           x      -</span>
<span class="go">          y                           -      x</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          z: 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">air_temperature / (kelvin)          (y: 4; x: 5)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          x                           x      -</span>
<span class="go">          y                           -      x</span>
<span class="go">     Scalar coordinates:</span>
<span class="go">          z: 2</span>
</pre></div>
</div>
<p>If your cubes are similar to those below (the single value <code class="docutils literal notranslate"><span class="pre">z</span></code> coordinate is
associated with a dimension) then use <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate" title="iris.cube.CubeList.concatenate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate()</span></code></a> to
combine your cubes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (z: 1; y: 4; x: 5)</span>
<span class="go">1: air_temperature / (kelvin)          (z: 1; y: 4; x: 5)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3><span class="section-number">9.3.2. </span>Concatenate<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><strong>Time Units</strong></p>
<p>Differences in the units of the time coordinates of the input cubes probably cause
the greatest amount of concatenate-related difficulties.
In recognition of this, Iris has a helper function,
<a class="reference internal" href="../iris/iris/util.html#iris.util.unify_time_units" title="iris.util.unify_time_units"><code class="xref py py-func docutils literal notranslate"><span class="pre">unify_time_units()</span></code></a>, to apply a common time unit to all the input cubes.</p>
<p>To demonstrate using <a class="reference internal" href="../iris/iris/util.html#iris.util.unify_time_units" title="iris.util.unify_time_units"><code class="xref py py-func docutils literal notranslate"><span class="pre">unify_time_units()</span></code></a>,
let’s adapt our list of input cubes from the <code class="docutils literal notranslate"><span class="pre">concatenate_cube</span></code> example from earlier.
We’ll give the input cubes unequal time coordinate units and call
<a class="reference internal" href="../iris/iris/util.html#iris.util.unify_time_units" title="iris.util.unify_time_units"><code class="xref py py-func docutils literal notranslate"><span class="pre">unify_time_units()</span></code></a> on the input cubes before concatenating
the input cubes using <a class="reference internal" href="../iris/iris/cube.html#iris.cube.CubeList.concatenate_cube" title="iris.cube.CubeList.concatenate_cube"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concatenate_cube()</span></code></a>:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">iris.util</span> <span class="kn">import</span> <span class="n">unify_time_units</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>
<span class="go">0: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>
<span class="go">1: air_temperature / (kelvin)          (t: 28; y: 3; x: 4)</span>
<span class="go">2: air_temperature / (kelvin)          (t: 31; y: 3; x: 4)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="go">days since 1990-02-15</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="go">days since 1970-01-01</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">concatenate_cube</span><span class="p">())</span>
<span class="gt">Traceback (most recent call last):</span>
 <span class="c">...</span>
<span class="gr">ConcatenateError</span>: <span class="n">failed to concatenate into a single cube.</span>
<span class="go">  Dimension coordinates metadata differ: t != t</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">unify_time_units</span><span class="p">(</span><span class="n">cubes</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="go">days since 1990-02-15</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cubes</span><span class="o">.</span><span class="n">concatenate_cube</span><span class="p">())</span>
<span class="go">air_temperature / (kelvin)          (t: 90; y: 3; x: 4)</span>
<span class="go">     Dimension coordinates:</span>
<span class="go">          t                           x      -     -</span>
<span class="go">          y                           -      x     -</span>
<span class="go">          x                           -      -     x</span>
</pre></div>
</div>
<p><strong>Attributes Mismatch</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">concatenate</span></code> process is affected by attributes mismatch on input cubes
in the same way that the <code class="docutils literal notranslate"><span class="pre">merge</span></code> process is.
The <a class="reference internal" href="#merge-issues-attrs-mismatch"><span class="std std-ref">Attributes Mismatch</span></a> section earlier in this
chapter gives further information on attributes mismatch.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cube_statistics.html" title="10. Cube statistics"
             >next</a> |</li>
        <li class="right" >
          <a href="interpolation_and_regridding.html" title="8. Cube interpolation and regridding"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../examples/index.html">examples</a>|&nbsp;</li>
        <li><a href="../gallery.html">gallery</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Iris user guide</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer">
    <p style="text-align: left; float: left; margin: 0px; padding: 0 0 0 5px;">Documentation licensed under the <a href="http://reference.data.gov.uk/id/open-government-licence" rel="license">Open Government Licence</a></p>
        &copy; <a href="../copyright.html">British Crown Copyright</a> 2010 - 2019, Met Office
    </div>

    <!-- Include a version switcher to easily move between the documentation of different versions -->
    <script type=text/javascript src="/iris/docs/version_switch.js" async></script>

  </body>
</html>