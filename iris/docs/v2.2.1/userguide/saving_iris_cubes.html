
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>3. Saving Iris cubes &#8212; Iris 2.2.1dev0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="4. Navigating a cube" href="navigating_a_cube.html" />
    <link rel="prev" title="2. Loading Iris cubes" href="loading_iris_cubes.html" />
 
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE"> 

    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script type="text/javascript" src="https://docs.python.org/2/_static/copybutton.js"></script>

    <link rel="icon" type="image/png" sizes="32x32" href="../_static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../_static/favicon-16x16.png">

    <link href="https://fonts.googleapis.com/css?family=Alike|Noto+Sans" rel="stylesheet">

  </head><body>

<a href="https://github.com/SciTools/iris">
    <img class="github-forkme" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
         alt="Fork Iris on GitHub" />
</a>


<div class="header-content">
    <a href="../index.html">
        <img src="../_static/Iris7_1_trim_100.png" alt="Iris logo" />
    </a>
    <div class="strapline">
      <h1>
          Iris <span class="version">v2.2</span>
      </h1>
      <p>
         A powerful, format-agnostic, community-driven Python library for analysing and
         visualising Earth science data.
      </p>
    </div>
</div>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="navigating_a_cube.html" title="4. Navigating a cube"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="loading_iris_cubes.html" title="2. Loading Iris cubes"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../examples/index.html">examples</a>|&nbsp;</li>
        <li><a href="../gallery.html">gallery</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Iris user guide</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Saving Iris cubes</a><ul>
<li><a class="reference internal" href="#controlling-the-save-process">3.1. Controlling the save process</a></li>
<li><a class="reference internal" href="#customising-the-save-process">3.2. Customising the save process</a><ul>
<li><a class="reference internal" href="#netcdf">3.2.1. netCDF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bespoke-saver">3.3. Bespoke Saver</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="loading_iris_cubes.html"
                        title="previous chapter">2. Loading Iris cubes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="navigating_a_cube.html"
                        title="next chapter">4. Navigating a cube</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/userguide/saving_iris_cubes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="saving-iris-cubes">
<span id="id1"></span><h1>3. Saving Iris cubes<a class="headerlink" href="#saving-iris-cubes" title="Permalink to this headline">¶</a></h1>
<p>Iris supports the saving of cubes and cube lists to:</p>
<ul class="simple">
<li><p>CF netCDF (1.5)</p></li>
<li><p>GRIB (edition 2)</p></li>
<li><p>Met Office PP</p></li>
</ul>
<p>The <a class="reference internal" href="../iris/iris.html#iris.save" title="iris.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.save()</span></code></a> function saves one or more cubes to a file.</p>
<p>If the filename includes a supported suffix then Iris will use the correct saver
and the keyword argument <cite>saver</cite> is not required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">iris</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">sample_data_path</span><span class="p">(</span><span class="s1">&#39;uk_hires.pp&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cubes</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iris</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cubes</span><span class="p">,</span> <span class="s1">&#39;/tmp/uk_hires.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Saving a cube whose data has been loaded lazily
(if <cite>cube.has_lazy_data()</cite> returns <cite>True</cite>) to the same file it expects
to load data from will cause both the data in-memory and the data on
disk to be lost.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">load_cube</span><span class="p">(</span><span class="s1">&#39;somefile.nc&#39;</span><span class="p">)</span>
<span class="c1"># The next line causes data loss in &#39;somefile.nc&#39; and the cube.</span>
<span class="n">iris</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="s1">&#39;somefile.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In general, overwriting a file which is the source for any lazily loaded
data can result in corruption. Users should proceed with caution when
attempting to overwrite an existing file.</p>
</div>
<div class="section" id="controlling-the-save-process">
<h2>3.1. Controlling the save process<a class="headerlink" href="#controlling-the-save-process" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../iris/iris.html#iris.save" title="iris.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.save()</span></code></a> function passes all other keywords through to the saver function defined, or automatically set from the file extension.  This enables saver specific functionality to be called.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Save a cube to PP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iris</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;myfile.pp&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Save a cube list to a PP file, appending to the contents of the file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># if it already exists</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iris</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cubes</span><span class="p">,</span> <span class="s2">&quot;myfile.pp&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Save a cube to netCDF, defaults to NETCDF4 file format</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iris</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;myfile.nc&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Save a cube list to netCDF, using the NETCDF3_CLASSIC storage option</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iris</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cubes</span><span class="p">,</span> <span class="s2">&quot;myfile.nc&quot;</span><span class="p">,</span> <span class="n">netcdf_format</span><span class="o">=</span><span class="s2">&quot;NETCDF3_CLASSIC&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>See</p>
<ul class="simple">
<li><p><a class="reference internal" href="../iris/iris/fileformats/netcdf.html#iris.fileformats.netcdf.save" title="iris.fileformats.netcdf.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.netcdf.save()</span></code></a></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.grib.save_grib2()</span></code></p></li>
<li><p><a class="reference internal" href="../iris/iris/fileformats/pp.html#iris.fileformats.pp.save" title="iris.fileformats.pp.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.fileformats.pp.save()</span></code></a></p></li>
</ul>
<p>for more details on supported arguments for the individual savers.</p>
</div>
<div class="section" id="customising-the-save-process">
<h2>3.2. Customising the save process<a class="headerlink" href="#customising-the-save-process" title="Permalink to this headline">¶</a></h2>
<p>When saving to GRIB or PP, the save process may be intercepted between the translation step and the file writing.  This enables customisation of the output messages, based on Cube metadata if required, over and above the translations supplied by Iris.</p>
<p>For example, a GRIB2 message with a particular known long_name may need to be saved to a specific parameter code and type of statistical process.  This can be achieved by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tweaked_messages</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cube</span><span class="p">,</span> <span class="n">grib_message</span> <span class="ow">in</span> <span class="n">iris</span><span class="o">.</span><span class="n">fileformats</span><span class="o">.</span><span class="n">grib</span><span class="o">.</span><span class="n">as_pairs</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
        <span class="c1"># post process the GRIB2 message, prior to saving</span>
        <span class="k">if</span> <span class="n">cube</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;carefully_customised_precipitation_amount&#39;</span><span class="p">:</span>
            <span class="n">gribapi</span><span class="o">.</span><span class="n">grib_set_long</span><span class="p">(</span><span class="n">grib_message</span><span class="p">,</span> <span class="s2">&quot;typeOfStatisticalProcess&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">gribapi</span><span class="o">.</span><span class="n">grib_set_long</span><span class="p">(</span><span class="n">grib_message</span><span class="p">,</span> <span class="s2">&quot;parameterCategory&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">gribapi</span><span class="o">.</span><span class="n">grib_set_long</span><span class="p">(</span><span class="n">grib_message</span><span class="p">,</span> <span class="s2">&quot;parameterNumber&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">grib_message</span>
<span class="n">iris</span><span class="o">.</span><span class="n">fileformats</span><span class="o">.</span><span class="n">grib</span><span class="o">.</span><span class="n">save_messages</span><span class="p">(</span><span class="n">tweaked_messages</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;/tmp/agrib2.grib2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly a PP field may need to be written out with a specific value for LBEXP.  This can be achieved by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tweaked_fields</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cube</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">iris</span><span class="o">.</span><span class="n">fileformats</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">save_pairs_from_cube</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
        <span class="c1"># post process the PP field, prior to saving</span>
        <span class="k">if</span> <span class="n">cube</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;air_pressure&#39;</span><span class="p">:</span>
            <span class="n">field</span><span class="o">.</span><span class="n">lbexp</span> <span class="o">=</span> <span class="s1">&#39;meaxp&#39;</span>
        <span class="k">elif</span> <span class="n">cube</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;air_density&#39;</span><span class="p">:</span>
            <span class="n">field</span><span class="o">.</span><span class="n">lbexp</span> <span class="o">=</span> <span class="s1">&#39;meaxr&#39;</span>
        <span class="k">yield</span> <span class="n">field</span>
<span class="n">iris</span><span class="o">.</span><span class="n">fileformats</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">save_fields</span><span class="p">(</span><span class="n">tweaked_fields</span><span class="p">(</span><span class="n">cubes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;/tmp/app.pp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="netcdf">
<h3>3.2.1. netCDF<a class="headerlink" href="#netcdf" title="Permalink to this headline">¶</a></h3>
<p>NetCDF is a flexible container for metadata and cube metadata is closely related to the CF for netCDF semantics.  This means that cube metadata is well represented in netCDF files, closely resembling the in memory metadata representation.
Thus there is no provision for similar save customisation functionality for netCDF saving, all customisations should be applied to the cube prior to saving to netCDF.</p>
</div>
</div>
<div class="section" id="bespoke-saver">
<h2>3.3. Bespoke Saver<a class="headerlink" href="#bespoke-saver" title="Permalink to this headline">¶</a></h2>
<p>A bespoke saver may be written to support an alternative file format.  This can be provided to the <a class="reference internal" href="../iris/iris.html#iris.save" title="iris.save"><code class="xref py py-func docutils literal notranslate"><span class="pre">iris.save()</span></code></a>  function, enabling Iris to write to a different file format.
Such a custom saver will need be written to meet the needs of the file format and to handle the metadata translation from cube metadata effectively.</p>
<p>Implementing a bespoke saver is out of scope for the user guide.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="navigating_a_cube.html" title="4. Navigating a cube"
             >next</a> |</li>
        <li class="right" >
          <a href="loading_iris_cubes.html" title="2. Loading Iris cubes"
             >previous</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../examples/index.html">examples</a>|&nbsp;</li>
        <li><a href="../gallery.html">gallery</a>|&nbsp;</li>
        <li><a href="../contents.html">contents</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Iris user guide</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer">
    <p style="text-align: left; float: left; margin: 0px; padding: 0 0 0 5px;">Documentation licensed under the <a href="http://reference.data.gov.uk/id/open-government-licence" rel="license">Open Government Licence</a></p>
        &copy; <a href="../copyright.html">British Crown Copyright</a> 2010 - 2019, Met Office
    </div>

    <!-- Include a version switcher to easily move between the documentation of different versions -->
    <script type=text/javascript src="/iris/docs/version_switch.js" async></script>

  </body>
</html>