

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cartopy.crs &mdash; cartopy 0.9.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="cartopy 0.9.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
 

     <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
     <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">

     <link rel="stylesheet" href="../../_static/layout.css" type="text/css" />
     <!-- Point to the *latest* version switcher. This will allow the latest versions to appear on older documentation. -->
     <script type="text/javascript" src="http://scitools.org.uk/cartopy/docs/latest/_static/version_switch.js"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../cartopy_outline.html" title="Module outline"
             accesskey="O">outline</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../gallery.html">gallery</a>|&nbsp;</li>
        

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="../../index.html">
<img src="../../_static/cartopy.png" 
border="0" alt="Cartopy" style="margin-left: -60px;"/>
</a>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
        <!-- add an empty div to clear the logo on the right. -->
        <div style="float: right; right:0px; height: 140px; width:100px; display: block;"></div>
        
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for cartopy.crs</h1><div class="highlight"><pre>
<span class="c"># (C) British Crown Copyright 2011 - 2012, Met Office</span>
<span class="c">#</span>
<span class="c"># This file is part of cartopy.</span>
<span class="c">#</span>
<span class="c"># cartopy is free software: you can redistribute it and/or modify it under</span>
<span class="c"># the terms of the GNU Lesser General Public License as published by the</span>
<span class="c"># Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># cartopy is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU Lesser General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c"># along with cartopy.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The crs module defines Coordinate Reference Systems and the transformations</span>
<span class="sd">between them.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractproperty</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">sgeom</span>
<span class="kn">from</span> <span class="nn">shapely.geometry.polygon</span> <span class="kn">import</span> <span class="n">LinearRing</span>
<span class="kn">from</span> <span class="nn">shapely.prepared</span> <span class="kn">import</span> <span class="n">prep</span>

<span class="kn">from</span> <span class="nn">cartopy._crs</span> <span class="kn">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">Geocentric</span><span class="p">,</span> <span class="n">Geodetic</span><span class="p">,</span> <span class="n">Globe</span><span class="p">,</span> <span class="n">PROJ4_RELEASE</span>
<span class="kn">import</span> <span class="nn">cartopy.trace</span>


<span class="n">__document_these__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;CRS&#39;</span><span class="p">,</span> <span class="s">&#39;Geocentric&#39;</span><span class="p">,</span> <span class="s">&#39;Geodetic&#39;</span><span class="p">,</span> <span class="s">&#39;Globe&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="RotatedGeodetic"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.RotatedGeodetic">[docs]</a><span class="k">class</span> <span class="nc">RotatedGeodetic</span><span class="p">(</span><span class="n">CRS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a rotated latitude/longitude coordinate system with spherical</span>
<span class="sd">    topology and geographical distance.</span>

<span class="sd">    Coordinates are measured in degrees.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a RotatedGeodetic CRS.</span>

<span class="sd">        Args:</span>

<span class="sd">            * pole_longitude - Pole longitude position, in unrotated degrees.</span>
<span class="sd">            * pole_latitude - Pole latitude position, in unrotated degrees.</span>

<span class="sd">        Kwargs:</span>

<span class="sd">            * globe - An optional :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      Defaults to a &quot;WGS84&quot; datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;ob_tran&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;o_proj&#39;</span><span class="p">,</span> <span class="s">&#39;latlon&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;o_lon_p&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;o_lat_p&#39;</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">pole_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s">&#39;WGS84&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RotatedGeodetic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Projection"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.Projection">[docs]</a><span class="k">class</span> <span class="nc">Projection</span><span class="p">(</span><span class="n">CRS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a projected coordinate system with flat topology and Euclidean</span>
<span class="sd">    distance.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="n">_method_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;Point&#39;</span><span class="p">:</span> <span class="s">&#39;_project_point&#39;</span><span class="p">,</span>
        <span class="s">&#39;LineString&#39;</span><span class="p">:</span> <span class="s">&#39;_project_line_string&#39;</span><span class="p">,</span>
        <span class="s">&#39;LinearRing&#39;</span><span class="p">:</span> <span class="s">&#39;_project_linear_ring&#39;</span><span class="p">,</span>
        <span class="s">&#39;Polygon&#39;</span><span class="p">:</span> <span class="s">&#39;_project_polygon&#39;</span><span class="p">,</span>
        <span class="s">&#39;MultiPoint&#39;</span><span class="p">:</span> <span class="s">&#39;_project_multipoint&#39;</span><span class="p">,</span>
        <span class="s">&#39;MultiLineString&#39;</span><span class="p">:</span> <span class="s">&#39;_project_multiline&#39;</span><span class="p">,</span>
        <span class="s">&#39;MultiPolygon&#39;</span><span class="p">:</span> <span class="s">&#39;_project_multipolygon&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cw_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw_boundary</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cw_boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="k">return</span> <span class="n">boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ccw_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccw_boundary</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">coords</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccw_boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="k">return</span> <span class="n">boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">domain</span>

    <span class="k">def</span> <span class="nf">_as_mpl_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">cartopy.mpl.geoaxes</span> <span class="kn">as</span> <span class="nn">geoaxes</span>
        <span class="k">return</span> <span class="n">geoaxes</span><span class="o">.</span><span class="n">GeoAxes</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;map_projection&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>

<div class="viewcode-block" id="Projection.project_geometry"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.Projection.project_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">project_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Projects the given geometry into this projection.</span>

<span class="sd">        :param geometry: The geometry to (re-)project.</span>
<span class="sd">        :param src_crs: The source CRS, or geodetic CRS if None.</span>
<span class="sd">        :rtype: Shapely geometry.</span>

<span class="sd">        If src_crs is None, the source CRS is assumed to be a geodetic</span>
<span class="sd">        version of the target CRS.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">src_crs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">src_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Source CRS must be an instance of CRS&#39;</span>
                            <span class="s">&#39; or one of its subclasses, or None.&#39;</span><span class="p">)</span>
        <span class="n">geom_type</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">geom_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unsupported geometry &#39;</span>
                             <span class="s">&#39;type {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_type</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_project_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_project_line_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">project_linear</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_project_linear_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linear_ring</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Projects the given LinearRing from the src_crs into this CRS and</span>
<span class="sd">        returns the resultant LinearRing or MultiLineString.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># 1) Resolve the initial lines into projected segments</span>
        <span class="c"># 1abc</span>
        <span class="c"># def23ghi</span>
        <span class="c"># jkl41</span>
        <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">project_linear</span><span class="p">(</span><span class="n">linear_ring</span><span class="p">,</span>
                                                         <span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c"># 2) Simplify the segments where appropriate.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Stitch together segments which are close to continuous.</span>
            <span class="c"># This is important when:</span>
            <span class="c"># 1) The first source point projects into the map and the</span>
            <span class="c"># ring has been cut by the boundary.</span>
            <span class="c"># Continuing the example from above this gives:</span>
            <span class="c">#   def23ghi</span>
            <span class="c">#   jkl41abc</span>
            <span class="c"># 2) The cut ends of segments are too close to reliably</span>
            <span class="c"># place into an order along the boundary.</span>

            <span class="c"># Threshold for whether a point is close enough to be the same</span>
            <span class="c"># point as another.</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-5</span>

            <span class="n">line_strings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span>
            <span class="n">any_modified</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">atol</span><span class="o">=</span><span class="n">threshold</span><span class="p">):</span>
                        <span class="n">last_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                        <span class="n">first_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">combo</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">last_coords</span> <span class="o">+</span> <span class="n">first_coords</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span>
                        <span class="k">del</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">line_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
                        <span class="n">modified</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">any_modified</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">any_modified</span><span class="p">:</span>
                <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">line_strings</span><span class="p">)</span>

        <span class="c"># 3) Check for a single resulting ring.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">multi_line_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
            <span class="n">result_geometry</span> <span class="o">=</span> <span class="n">LinearRing</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result_geometry</span> <span class="o">=</span> <span class="n">multi_line_string</span>

        <span class="k">return</span> <span class="n">result_geometry</span>

    <span class="k">def</span> <span class="nf">_project_multipoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">geoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_point</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_project_multiline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_line_string</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_project_multipolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_polygon</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_project_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the projected polygon(s) derived from the given polygon.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Determine orientation of polygon.</span>
        <span class="c"># TODO: Consider checking the internal rings have the opposite</span>
        <span class="c"># orientation to the external rings?</span>
        <span class="k">if</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">is_geodetic</span><span class="p">():</span>
            <span class="n">is_ccw</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_ccw</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">is_ccw</span>

        <span class="c"># Project the polygon exterior/interior rings.</span>
        <span class="c"># Each source ring will result in either a ring, or one or more</span>
        <span class="c"># lines.</span>
        <span class="n">rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">multi_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">src_ring</span> <span class="ow">in</span> <span class="p">[</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">interiors</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_linear_ring</span><span class="p">(</span><span class="n">src_ring</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span> <span class="o">==</span> <span class="s">&#39;LinearRing&#39;</span><span class="p">:</span>
                <span class="n">rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">multi_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

        <span class="c"># Convert any lines to rings by attaching them to the boundary.</span>
        <span class="k">if</span> <span class="n">multi_lines</span><span class="p">:</span>
            <span class="n">rings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attach_lines_to_boundary</span><span class="p">(</span><span class="n">multi_lines</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">))</span>

        <span class="c"># Resolve all the inside vs. outside rings, and convert to the</span>
        <span class="c"># final MultiPolygon.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rings_to_multi_polygon</span><span class="p">(</span><span class="n">rings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_lines_to_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_line_strings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of LinearRings by attaching the ends of the given lines</span>
<span class="sd">        to the boundary, paying attention to the traversal directions of the</span>
<span class="sd">        lines and boundary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Accumulate all the boundary and segment end points, along with</span>
        <span class="c"># their distance along the boundary.</span>
        <span class="n">edge_things</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Get the boundary as a LineString of the correct orientation</span>
        <span class="c"># so we can compute distances along it.</span>
        <span class="k">if</span> <span class="n">is_ccw</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ccw_boundary</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cw_boundary</span>

        <span class="k">def</span> <span class="nf">boundary_distance</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">boundary</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">))</span>

        <span class="c"># Squash all the LineStrings into a single list.</span>
        <span class="n">line_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">multi_line_string</span> <span class="ow">in</span> <span class="n">multi_line_strings</span><span class="p">:</span>
            <span class="n">line_strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span>

        <span class="c"># Record the positions of all the segment ends</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
            <span class="n">first_dist</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_Thing</span><span class="p">(</span><span class="n">first_dist</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
            <span class="n">last_dist</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_Thing</span><span class="p">(</span><span class="n">last_dist</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">&#39;last&#39;</span><span class="p">,</span> <span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="c"># Record the positions of all the boundary vertices</span>
        <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">boundary</span><span class="o">.</span><span class="n">coords</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_Thing</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="c"># Order everything as if walking around the boundary.</span>
        <span class="c"># NB. We make line end-points take precedence over boundary points</span>
        <span class="c"># to ensure that end-points are still found and followed when they</span>
        <span class="c"># coincide.</span>
        <span class="n">edge_things</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">thing</span><span class="p">:</span> <span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">thing</span><span class="o">.</span><span class="n">kind</span><span class="p">))</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span>
            <span class="k">print</span> <span class="s">&#39;Edge things&#39;</span>
            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;   &#39;</span><span class="p">,</span> <span class="n">thing</span>

        <span class="n">to_do</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">line_string</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_strings</span><span class="p">)}</span>
        <span class="n">done</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">to_do</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">line_string</span> <span class="o">=</span> <span class="n">to_do</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">sys</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="k">print</span>
                <span class="k">print</span> <span class="s">&#39;Processing: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line_string</span><span class="p">)</span>
            <span class="n">filter_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">kind</span> <span class="ow">or</span>
                                   <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">or</span>
                                   <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;last&#39;</span><span class="p">)</span>
            <span class="n">edge_things</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">filter_fn</span><span class="p">,</span> <span class="n">edge_things</span><span class="p">)</span>

            <span class="n">added_linestring</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="c"># Find the distance of the last point</span>
                <span class="n">d_last</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;   d_last:&#39;</span><span class="p">,</span> <span class="n">d_last</span>
                <span class="n">next_thing</span> <span class="o">=</span> <span class="n">_find_gt</span><span class="p">(</span><span class="n">edge_things</span><span class="p">,</span> <span class="n">d_last</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;   next_thing:&#39;</span><span class="p">,</span> <span class="n">next_thing</span>
                <span class="k">if</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;   adding boundary point&#39;</span>
                    <span class="n">boundary_point</span> <span class="o">=</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">combined_coords</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span>
                                       <span class="p">[(</span><span class="n">boundary_point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">boundary_point</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span>
                    <span class="n">line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">combined_coords</span><span class="p">)</span>
                    <span class="c"># XXX</span>
                    <span class="c">#edge_things.remove(next_thing)</span>
                <span class="k">elif</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;   close loop&#39;</span>
                    <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_string</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;   adding line&#39;</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">line_to_append</span> <span class="o">=</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="c"># XXX pelson: I think this if statement can be removed</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">to_do</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">to_do</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">coords_to_append</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_to_append</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;last&#39;</span><span class="p">:</span>
                        <span class="n">coords_to_append</span> <span class="o">=</span> <span class="n">coords_to_append</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="nb">list</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span>
                                                    <span class="n">coords_to_append</span><span class="p">))</span>

                    <span class="c"># Catch getting stuck in an infinite loop by checking that</span>
                    <span class="c"># linestring only added once</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_linestring</span><span class="p">:</span>
                        <span class="n">added_linestring</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Unidentified problem with &#39;</span>
                                           <span class="s">&#39;geometry, linestring being &#39;</span>
                                           <span class="s">&#39;re-added&#39;</span><span class="p">)</span>

        <span class="c"># filter out any non-valid linear rings</span>
        <span class="n">done</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">linear_ring</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">linear_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>

        <span class="c"># XXX Is the last point in each ring actually the same as the first?</span>
        <span class="n">linear_rings</span> <span class="o">=</span> <span class="p">[</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">done</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;   DONE&#39;</span>

        <span class="k">return</span> <span class="n">linear_rings</span>

    <span class="k">def</span> <span class="nf">_rings_to_multi_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">):</span>
        <span class="n">exterior_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">interior_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ring</span><span class="o">.</span><span class="n">is_ccw</span> <span class="o">!=</span> <span class="n">is_ccw</span><span class="p">:</span>
                <span class="n">interior_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exterior_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>

        <span class="n">polygon_bits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Turn all the exterior rings into polygon definitions,</span>
        <span class="c"># &quot;slurping up&quot; any interior rings they contain.</span>
        <span class="k">for</span> <span class="n">exterior_ring</span> <span class="ow">in</span> <span class="n">exterior_rings</span><span class="p">:</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">exterior_ring</span><span class="p">)</span>
            <span class="n">prep_polygon</span> <span class="o">=</span> <span class="n">prep</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">interior_ring</span> <span class="ow">in</span> <span class="n">interior_rings</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">prep_polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">):</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                    <span class="n">interior_rings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
            <span class="n">polygon_bits</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">exterior_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                 <span class="p">[</span><span class="n">ring</span><span class="o">.</span><span class="n">coords</span> <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">holes</span><span class="p">]))</span>

        <span class="c"># Any left over &quot;interior&quot; rings need &quot;inverting&quot; with respect</span>
        <span class="c"># to the boundary.</span>
        <span class="k">if</span> <span class="n">interior_rings</span><span class="p">:</span>
            <span class="n">boundary_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">boundary_poly</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">x3</span> <span class="o">-=</span> <span class="n">bx</span>
            <span class="n">y3</span> <span class="o">-=</span> <span class="n">by</span>
            <span class="n">x4</span> <span class="o">+=</span> <span class="n">bx</span>
            <span class="n">y4</span> <span class="o">+=</span> <span class="n">by</span>
            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">interior_rings</span><span class="p">:</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span>
                    <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">x1</span> <span class="o">-=</span> <span class="n">bx</span>
                    <span class="n">y1</span> <span class="o">-=</span> <span class="n">by</span>
                    <span class="n">x2</span> <span class="o">+=</span> <span class="n">bx</span>
                    <span class="n">y2</span> <span class="o">+=</span> <span class="n">by</span>
                    <span class="n">box</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x4</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">y4</span><span class="p">))</span>

                    <span class="c"># Invert the polygon</span>
                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

                    <span class="c"># Intersect the inverted polygon with the boundary</span>
                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">boundary_poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
                        <span class="n">polygon_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">polygon_bits</span><span class="p">:</span>
            <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">polygon_bits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">multi_poly</span>

<div class="viewcode-block" id="Projection.quick_vertices_transform"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.Projection.quick_vertices_transform">[docs]</a>    <span class="k">def</span> <span class="nf">quick_vertices_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Where possible, return a vertices array transformed to this CRS from</span>
<span class="sd">        the given vertices array of shape ``(n, 2)`` and the source CRS.</span>

<span class="sd">        .. important::</span>

<span class="sd">            This method may return None to indicate that the vertices cannot</span>
<span class="sd">            be transformed quickly, and a more complex geometry transformation</span>
<span class="sd">            is required (see :meth:`cartopy.crs.Projection.project_geometry`).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">src_crs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">x_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
            <span class="n">y_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">return_value</span> <span class="o">=</span> <span class="n">vertices</span>

        <span class="k">return</span> <span class="n">return_value</span>

</div></div>
<span class="k">class</span> <span class="nc">_RectangularProjection</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract superclass of projections with a rectangular domain which</span>
<span class="sd">    is symmetric about the origin.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">half_width</span><span class="p">,</span> <span class="n">half_height</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span> <span class="o">=</span> <span class="n">half_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span> <span class="o">=</span> <span class="n">half_height</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># XXX Should this be a LinearRing?</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_CylindricalProjection</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract class which denotes cylindrical projections where we</span>
<span class="sd">    want to allow x values to wrap around.</span>

<span class="sd">    &quot;&quot;&quot;</span>


<div class="viewcode-block" id="PlateCarree"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.PlateCarree">[docs]</a><span class="k">class</span> <span class="nc">PlateCarree</span><span class="p">(</span><span class="n">_CylindricalProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;eqc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="mf">6378137.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="mf">6378137.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">90</span>
        <span class="c"># Set the threshold around 0.5 if the x max is 180.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">/</span> <span class="mf">360.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                                          <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="k">def</span> <span class="nf">_bbox_and_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_plate_carree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a pair of (xmin, xmax) pairs and an offset which can be used</span>
<span class="sd">        for identification of whether data in ``other_plate_carree`` needs</span>
<span class="sd">        to be transformed to wrap appropriately.</span>

<span class="sd">        &gt;&gt;&gt; import cartopy.crs as ccrs</span>
<span class="sd">        &gt;&gt;&gt; src = ccrs.PlateCarree(central_longitude=10)</span>
<span class="sd">        &gt;&gt;&gt; bboxes, offset = ccrs.PlateCarree()._bbox_and_offset(src)</span>
<span class="sd">        &gt;&gt;&gt; print bboxes</span>
<span class="sd">        [[-180.0, -170.0], [-170.0, 180.0]]</span>
<span class="sd">        &gt;&gt;&gt; print offset</span>
<span class="sd">        10.0</span>

<span class="sd">        The returned values are longitudes in ``other_plate_carree``&#39;s</span>
<span class="sd">        coordinate system.</span>

<span class="sd">        .. important::</span>

<span class="sd">            The two CRSs must be identical in every way, other than their</span>
<span class="sd">            central longitudes. No checking of this is done.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span><span class="p">[</span><span class="s">&#39;lon_0&#39;</span><span class="p">]</span>
        <span class="n">other_lon_0</span> <span class="o">=</span> <span class="n">other_plate_carree</span><span class="o">.</span><span class="n">proj4_params</span><span class="p">[</span><span class="s">&#39;lon_0&#39;</span><span class="p">]</span>

        <span class="n">lon_0_offset</span> <span class="o">=</span> <span class="n">other_lon_0</span> <span class="o">-</span> <span class="n">self_lon_0</span>

        <span class="n">lon_lower_bound_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon_lower_bound_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">other_plate_carree</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lon_0_offset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lon_lower_bound_1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">lon_lower_bound_1</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span><span class="p">])</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[[</span><span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span><span class="p">],</span>
                <span class="p">[</span><span class="n">lon_lower_bound_1</span><span class="p">,</span> <span class="n">lon_lower_bound_0</span><span class="p">]]</span>

        <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">lon_0_offset</span>

    <span class="k">def</span> <span class="nf">quick_vertices_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">,</span>
                             <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">quick_vertices_transform</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>

        <span class="c"># Optimise the PlateCarree -&gt; PlateCarree case where no</span>
        <span class="c"># wrapping or interpolation needs to take place.</span>
        <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">PlateCarree</span><span class="p">):</span>
            <span class="n">self_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">src_params</span> <span class="o">=</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">proj4_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">self_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">),</span> <span class="n">src_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">)</span>

            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">potential</span> <span class="o">=</span> <span class="p">(</span><span class="n">self_params</span> <span class="o">==</span> <span class="n">src_params</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">potential</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">src_crs</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bboxes</span><span class="p">,</span> <span class="n">proj_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_and_offset</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span>
                <span class="n">x_lim</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">y_lim</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
                    <span class="c"># Arbitrarily choose the number of moduli to look</span>
                    <span class="c"># above and below the -180-&gt;180 range. If data is beyond</span>
                    <span class="c"># this range, we&#39;re not going to transform it quickly.</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">mod</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="n">proj_offset</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="n">return_value</span> <span class="o">=</span> <span class="n">vertices</span> <span class="o">+</span> <span class="p">[[</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">return_value</span>

</div>
<div class="viewcode-block" id="TransverseMercator"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.TransverseMercator">[docs]</a><span class="k">class</span> <span class="nc">TransverseMercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Transverse Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The true longitude of the central meridian in</span>
<span class="sd">                                  degrees. Defaults to 0.</span>
<span class="sd">            * central_latitude - The true latitude of the planar origin in</span>
<span class="sd">                                 degrees. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from the planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from the planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * scale_factor - Scale factor at the central meridian. Defaults</span>
<span class="sd">                             to 1.</span>
<span class="sd">            * globe - An instance of :class:`cartopy.crs.Globe`. If omitted, a</span>
<span class="sd">                      default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;tmerc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">2e7</span><span class="p">,</span> <span class="mf">2e7</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">1e7</span><span class="p">,</span> <span class="mf">1e7</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OSGB"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.OSGB">[docs]</a><span class="k">class</span> <span class="nc">OSGB</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OSGB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span>
                                   <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.9996012717</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="o">=</span><span class="mi">400000</span><span class="p">,</span>
                                   <span class="n">false_northing</span><span class="o">=-</span><span class="mi">100000</span><span class="p">,</span>
                                   <span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s">&#39;OSGB36&#39;</span><span class="p">,</span> <span class="n">ellipse</span><span class="o">=</span><span class="s">&#39;airy&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">7e5</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">13e5</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OSNI"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.OSNI">[docs]</a><span class="k">class</span> <span class="nc">OSNI</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="mf">6377340.189</span><span class="p">,</span>
                      <span class="n">semiminor_axis</span><span class="o">=</span><span class="mf">6356034.447938534</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OSNI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">8</span><span class="p">,</span>
                                   <span class="n">central_latitude</span><span class="o">=</span><span class="mf">53.5</span><span class="p">,</span>
                                   <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.000035</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
                                   <span class="n">false_northing</span><span class="o">=</span><span class="mi">250000</span><span class="p">,</span>
                                   <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">18814.9667</span><span class="p">,</span> <span class="mf">386062.3293</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">11764.8481</span><span class="p">,</span> <span class="mf">464720.9559</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="EuroPP"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.EuroPP">[docs]</a><span class="k">class</span> <span class="nc">EuroPP</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    UTM Zone 32 projection for EuroPP domain.</span>

<span class="sd">    Ellipsoid is International 1924, Datum is ED50.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;tmerc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="mf">0.9996</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;x_0&#39;</span><span class="p">,</span> <span class="mi">1750000</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;y_0&#39;</span><span class="p">,</span> <span class="mi">1500000</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;zone&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="s">&#39;intl&#39;</span><span class="p">,</span> <span class="n">towgs84</span><span class="o">=</span><span class="s">&#39;-87,-98,-121&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EuroPP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mf">3.19e6</span><span class="p">,</span> <span class="mf">3.8e6</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.19e6</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.8e6</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e4</span>

</div>
<div class="viewcode-block" id="Mercator"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Mercator">[docs]</a><span class="k">class</span> <span class="nc">Mercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">min_latitude</span><span class="o">=-</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">max_latitude</span><span class="o">=</span><span class="mf">84.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - the central longitude. Defaults to 0.</span>
<span class="sd">            * min_latitude - the maximum southerly extent of the projection.</span>
<span class="sd">                             Defaults to -80 degrees.</span>
<span class="sd">            * max_latitude - the maximum northerly extent of the projection.</span>
<span class="sd">                             Defaults to 84 degrees.</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;merc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Mercator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c"># Calculate limits.</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">Geodetic</span><span class="p">(),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">]),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">min_latitude</span><span class="p">,</span> <span class="n">max_latitude</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">720</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Mercator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;_ylimits&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;_xlimits&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_ylimits</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_xlimits</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span>

</div>
<div class="viewcode-block" id="LambertCylindrical"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.LambertCylindrical">[docs]</a><span class="k">class</span> <span class="nc">LambertCylindrical</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;cea&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LambertCylindrical</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span>
                                                 <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span>

</div>
<div class="viewcode-block" id="LambertConformal"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.LambertConformal">[docs]</a><span class="k">class</span> <span class="nc">LambertConformal</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Lambert Conformal conic projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=-</span><span class="mf">96.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">39.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">secant_latitudes</span><span class="o">=</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=-</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The central longitude. Defaults to 0.</span>
<span class="sd">            * central_latitude - The central latitude. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * secant_latitudes - The two latitudes of secant intersection.</span>
<span class="sd">                                 Defaults to (33, 45).</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>
<span class="sd">            * cutoff - Latitude of map cutoff.</span>
<span class="sd">                       The map extends to infinity opposite the central pole</span>
<span class="sd">                       so we must cut off the map drawing before then.</span>
<span class="sd">                       A value of 0 will draw half the globe. Defaults to -30.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;lcc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">secant_latitudes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">secant_latitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;lat_2&#39;</span><span class="p">,</span> <span class="n">secant_latitudes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LambertConformal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c"># are we north or south polar?</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">secant_latitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">secant_latitudes</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">poliest_sec</span> <span class="o">=</span> <span class="n">secant_latitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">poliest_sec</span> <span class="o">=</span> <span class="n">secant_latitudes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plat</span> <span class="o">=</span> <span class="mi">90</span> <span class="k">if</span> <span class="n">poliest_sec</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">90</span>

        <span class="c"># bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">plat</span><span class="p">]</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">central_longitude</span> <span class="o">-</span> <span class="mi">180</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
                                <span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">lats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cutoff</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plat</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LambertConformal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&quot;cutoff&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>

</div>
<div class="viewcode-block" id="Miller"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Miller">[docs]</a><span class="k">class</span> <span class="nc">Miller</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;mill&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="c"># XXX How can we derive the vertical limit of 131.98?</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Miller</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">131.98</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span>

</div>
<div class="viewcode-block" id="RotatedPole"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.RotatedPole">[docs]</a><span class="k">class</span> <span class="nc">RotatedPole</span><span class="p">(</span><span class="n">_CylindricalProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;ob_tran&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;o_proj&#39;</span><span class="p">,</span> <span class="s">&#39;latlon&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;o_lon_p&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;o_lat_p&#39;</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">pole_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RotatedPole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span>

</div>
<div class="viewcode-block" id="Gnomonic"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Gnomonic">[docs]</a><span class="k">class</span> <span class="nc">Gnomonic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;gnom&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Gnomonic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="mf">5e7</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Stereographic"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Stereographic">[docs]</a><span class="k">class</span> <span class="nc">Stereographic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">true_scale_latitude</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;stere&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">true_scale_latitude</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="n">true_scale_latitude</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c"># TODO: Factor this out, particularly if there are other places using</span>
        <span class="c"># it (currently: Stereographic &amp; Geostationary). (#340)</span>
        <span class="k">def</span> <span class="nf">ellipse</span><span class="p">(</span><span class="n">semimajor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">semiminor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">semimajor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">semiminor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
            <span class="n">coords</span> <span class="o">+=</span> <span class="p">([</span><span class="n">easting</span><span class="p">],</span> <span class="p">[</span><span class="n">northing</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">coords</span>

        <span class="c"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="mf">6378137.0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="mf">6356752.3142</span><span class="p">)</span>

        <span class="c"># Note: The magic number has been picked to maintain consistent</span>
        <span class="c"># behaviour with a wgs84 globe. There is no guarantee that the scaling</span>
        <span class="c"># should even be linear.</span>
        <span class="n">x_axis_offset</span> <span class="o">=</span> <span class="mf">5e7</span> <span class="o">/</span> <span class="mf">6378137.</span>
        <span class="n">y_axis_offset</span> <span class="o">=</span> <span class="mf">5e7</span> <span class="o">/</span> <span class="mf">6356752.3142</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">x_axis_offset</span> <span class="o">+</span> <span class="n">false_easting</span><span class="p">,</span>
                          <span class="n">a</span> <span class="o">*</span> <span class="n">x_axis_offset</span> <span class="o">+</span> <span class="n">false_easting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="n">y_axis_offset</span> <span class="o">+</span> <span class="n">false_northing</span><span class="p">,</span>
                          <span class="n">b</span> <span class="o">*</span> <span class="n">y_axis_offset</span> <span class="o">+</span> <span class="n">false_northing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">exterior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">ellipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>

</div>
<div class="viewcode-block" id="NorthPolarStereo"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.NorthPolarStereo">[docs]</a><span class="k">class</span> <span class="nc">NorthPolarStereo</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NorthPolarStereo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SouthPolarStereo"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.SouthPolarStereo">[docs]</a><span class="k">class</span> <span class="nc">SouthPolarStereo</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SouthPolarStereo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">central_latitude</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Orthographic"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Orthographic">[docs]</a><span class="k">class</span> <span class="nc">Orthographic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;ortho&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Orthographic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="mf">6.4e6</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">_WarpedRectangularProjection</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span>
                                                           <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c"># Obtain boundary points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">geodetic_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                     <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                     <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>


<div class="viewcode-block" id="Mollweide"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Mollweide">[docs]</a><span class="k">class</span> <span class="nc">Mollweide</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;moll&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Mollweide</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                                        <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e5</span>

</div>
<div class="viewcode-block" id="Robinson"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Robinson">[docs]</a><span class="k">class</span> <span class="nc">Robinson</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># Warn when using Robinson with proj4 4.8 due to discontinuity at</span>
        <span class="c"># 40 deg N introduced by incomplete fix to issue #113 (see</span>
        <span class="c"># https://trac.osgeo.org/proj/ticket/113).</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\d\.\d&quot;</span><span class="p">,</span> <span class="n">PROJ4_RELEASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">proj4_version</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">if</span> <span class="mf">4.8</span> <span class="o">&lt;=</span> <span class="n">proj4_version</span> <span class="o">&lt;</span> <span class="mf">4.9</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;The Robinson projection in the v4.8.x series &#39;</span>
                              <span class="s">&#39;of Proj.4 contains a discontinuity at &#39;</span>
                              <span class="s">&#39;40 deg latitude. Use this projection with &#39;</span>
                              <span class="s">&#39;caution.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Cannot determine Proj.4 version. The Robinson &#39;</span>
                          <span class="s">&#39;projection may be unreliable and should be used &#39;</span>
                          <span class="s">&#39;with caution.&#39;</span><span class="p">)</span>

        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;robin&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Robinson</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                                       <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e4</span>

    <span class="k">def</span> <span class="nf">transform_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture and handle any input NaNs, else invoke parent function,</span>
<span class="sd">        :meth:`_WarpedRectangularProjection.transform_point`.</span>

<span class="sd">        Needed because input NaNs can trigger a fatal error in the underlying</span>
<span class="sd">        implementation of the Robinson projection.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Although the original can in fact translate (nan, lat) into</span>
<span class="sd">            (nan, y-value), this patched version doesn&#39;t support that.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Robinson</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture and handle NaNs in input points -- else as parent function,</span>
<span class="sd">        :meth:`_WarpedRectangularProjection.transform_points`.</span>

<span class="sd">        Needed because input NaNs can trigger a fatal error in the underlying</span>
<span class="sd">        implementation of the Robinson projection.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Although the original can in fact translate (nan, lat) into</span>
<span class="sd">            (nan, y-value), this patched version doesn&#39;t support that.</span>
<span class="sd">            Instead, we invalidate any of the points that contain a NaN.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_point_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">input_point_nans</span> <span class="o">|=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">handle_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">input_point_nans</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle_nans</span><span class="p">:</span>
            <span class="c"># Remove NaN points from input data to avoid the error.</span>
            <span class="n">x</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">y</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">z</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Robinson</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle_nans</span><span class="p">:</span>
            <span class="c"># Result always has shape (N, 3).</span>
            <span class="c"># Blank out each (whole) point where we had a NaN in the input.</span>
            <span class="n">result</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="InterruptedGoodeHomolosine"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.InterruptedGoodeHomolosine">[docs]</a><span class="k">class</span> <span class="nc">InterruptedGoodeHomolosine</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;igh&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InterruptedGoodeHomolosine</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span>
                                                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c"># Obtain boundary points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">31</span>
        <span class="n">geodetic_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>

        <span class="c"># Right boundary</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                               <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c"># Top boundary</span>
        <span class="n">interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">interrupted_lons</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c"># Left boundary</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                               <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c"># Bottom boundary</span>
        <span class="n">interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">interrupted_lons</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c"># Close loop</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span>
                                           <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2e4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>

</div>
<div class="viewcode-block" id="Geostationary"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Geostationary">[docs]</a><span class="k">class</span> <span class="nc">Geostationary</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;proj&#39;</span><span class="p">,</span> <span class="s">&#39;geos&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;lat_0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">satellite_height</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Geostationary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c"># TODO: Factor this out, particularly if there are other places using</span>
        <span class="c"># it (currently: Stereographic &amp; Geostationary). (#340)</span>
        <span class="k">def</span> <span class="nf">ellipse</span><span class="p">(</span><span class="n">semimajor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">semiminor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">semimajor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">semiminor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
            <span class="n">coords</span> <span class="o">+=</span> <span class="p">([</span><span class="n">easting</span><span class="p">],</span> <span class="p">[</span><span class="n">northing</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">coords</span>

        <span class="c"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="mf">6378137.0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="mf">6378137.0</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">satellite_height</span><span class="p">)</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">ellipse</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.02</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span>

</div>
<span class="k">class</span> <span class="nc">_Thing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;_Thing(</span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">, </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_find_gt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="c"># TODO: Fix the problem of co-incident boundary &amp; line points</span>
        <span class="c">#if v.distance &gt;= x:</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../cartopy_outline.html" title="Module outline"
             >outline</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../gallery.html">gallery</a>|&nbsp;</li>
        

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
    <p style="text-align: left; float: left; margin: 0px; padding: 0 0 0 5px;">Documentation licensed under the <a href="http://reference.data.gov.uk/id/open-government-licence" rel="license">Open Government Licence</a></p>
        &copy; <a href="../../copyright.html">British Crown Copyright</a> 2011 - 2013, Met Office
    </div>


  </body>
</html>