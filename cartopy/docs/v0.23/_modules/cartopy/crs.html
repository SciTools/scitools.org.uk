
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cartopy.crs &#8212; cartopy 0.23.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=2753bf86"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/cartopy/crs';</script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">

    <!-- Point to the *latest* version switcher. This will allow the latest versions to appear on older documentation. -->
    <script type="text/javascript" src="https://scitools.org.uk/cartopy/docs/latest/_static/version_switch.js"></script>

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/cartopy.png" class="logo__image only-light" alt="cartopy 0.23.0 documentation - Home"/>
    <script>document.write(`<img src="../../_static/cartopy.png" class="logo__image only-dark" alt="cartopy 0.23.0 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../gallery/index.html">
                        Gallery
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installing.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../whatsnew/index.html">
                        What’s new
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SciTools/cartopy" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../gallery/index.html">
                        Gallery
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installing.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../whatsnew/index.html">
                        What’s new
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SciTools/cartopy" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">cartopy.crs</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for cartopy.crs</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright Crown and Cartopy Contributors</span>
<span class="c1">#</span>
<span class="c1"># This file is part of Cartopy and is released under the BSD 3-clause license.</span>
<span class="c1"># See LICENSE in the root of the repository for full licensing details.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The crs module defines Coordinate Reference Systems and the transformations</span>
<span class="sd">between them.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Transformer</span>
<span class="kn">from</span> <span class="nn">pyproj.exceptions</span> <span class="kn">import</span> <span class="n">ProjError</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sgeom</span>
<span class="kn">from</span> <span class="nn">shapely.prepared</span> <span class="kn">import</span> <span class="n">prep</span>

<span class="kn">import</span> <span class="nn">cartopy.trace</span>


<span class="k">try</span><span class="p">:</span>
    <span class="c1"># https://github.com/pyproj4/pyproj/pull/912</span>
    <span class="kn">from</span> <span class="nn">pyproj.crs</span> <span class="kn">import</span> <span class="n">CustomConstructorCRS</span> <span class="k">as</span> <span class="n">_CRS</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">CRS</span> <span class="k">as</span> <span class="n">_CRS</span>

<span class="n">__document_these__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRS&#39;</span><span class="p">,</span> <span class="s1">&#39;Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Geodetic&#39;</span><span class="p">,</span> <span class="s1">&#39;Globe&#39;</span><span class="p">]</span>

<span class="n">WGS84_SEMIMAJOR_AXIS</span> <span class="o">=</span> <span class="mf">6378137.0</span>
<span class="n">WGS84_SEMIMINOR_AXIS</span> <span class="o">=</span> <span class="mf">6356752.3142</span>


<span class="c1"># Cache the transformer creation method</span>
<span class="nd">@lru_cache</span>
<span class="k">def</span> <span class="nf">_get_transformer_from_crs</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">tgt_crs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">tgt_crs</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_safe_pj_transform</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">tgt_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">_get_transformer_from_crs</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">tgt_crs</span><span class="p">)</span>

    <span class="c1"># if a projection is essentially 2d there</span>
    <span class="c1"># should be no harm in setting its z to 0</span>
    <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="c1"># pyproj implicitly converts size-1 arrays to scalars, which is</span>
        <span class="c1"># deprecated in numpy 1.25, but *also* handles the future error</span>
        <span class="c1"># see https://github.com/numpy/numpy/pull/10615</span>
        <span class="c1"># and https://github.com/SciTools/cartopy/pull/2194</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Conversion of an array with ndim &gt; 0&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">errcheck</span><span class="o">=</span><span class="n">trap</span><span class="p">)</span>


<div class="viewcode-block" id="Globe">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Globe.html#cartopy.crs.Globe">[docs]</a>
<span class="k">class</span> <span class="nc">Globe</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define an ellipsoid and, optionally, how to relate it to the real world.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ellipse</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">,</span>
                 <span class="n">semimajor_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">semiminor_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">flattening</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inverse_flattening</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">towgs84</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nadgrids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        datum</span>
<span class="sd">            Proj &quot;datum&quot; definition. Defaults to None.</span>
<span class="sd">        ellipse</span>
<span class="sd">            Proj &quot;ellps&quot; definition. Defaults to &#39;WGS84&#39;.</span>
<span class="sd">        semimajor_axis</span>
<span class="sd">            Semimajor axis of the spheroid / ellipsoid.  Defaults to None.</span>
<span class="sd">        semiminor_axis</span>
<span class="sd">            Semiminor axis of the ellipsoid.  Defaults to None.</span>
<span class="sd">        flattening</span>
<span class="sd">            Flattening of the ellipsoid.  Defaults to None.</span>
<span class="sd">        inverse_flattening</span>
<span class="sd">            Inverse flattening of the ellipsoid.  Defaults to None.</span>
<span class="sd">        towgs84</span>
<span class="sd">            Passed through to the Proj definition.  Defaults to None.</span>
<span class="sd">        nadgrids</span>
<span class="sd">            Passed through to the Proj definition.  Defaults to None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span> <span class="n">datum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span> <span class="o">=</span> <span class="n">ellipse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="o">=</span> <span class="n">semimajor_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="o">=</span> <span class="n">semiminor_axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flattening</span> <span class="o">=</span> <span class="n">flattening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inverse_flattening</span> <span class="o">=</span> <span class="n">inverse_flattening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">towgs84</span> <span class="o">=</span> <span class="n">towgs84</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nadgrids</span> <span class="o">=</span> <span class="n">nadgrids</span>

<div class="viewcode-block" id="Globe.to_proj4_params">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Globe.html#cartopy.crs.Globe.to_proj4_params">[docs]</a>
    <span class="k">def</span> <span class="nf">to_proj4_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an OrderedDict of key value pairs which represents this globe</span>
<span class="sd">        in terms of proj params.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;datum&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;ellps&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">semimajor_axis</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">semiminor_axis</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flattening</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_flattening</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;towgs84&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">towgs84</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;nadgrids&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nadgrids</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">proj4_params</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CRS">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.CRS.html#cartopy.crs.CRS">[docs]</a>
<span class="k">class</span> <span class="nc">CRS</span><span class="p">(</span><span class="n">_CRS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a Coordinate Reference System using proj. The :class:`cartopy.crs.CRS`</span>
<span class="sd">    class is the very core of cartopy, all coordinate reference systems in cartopy</span>
<span class="sd">    have :class:`~cartopy.crs.CRS` as a parent class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Whether this projection can handle ellipses.</span>
    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        proj4_params: iterable of key-value pairs</span>
<span class="sd">            The proj4 parameters required to define the</span>
<span class="sd">            desired CRS.  The parameters should not describe</span>
<span class="sd">            the desired elliptic model, instead create an</span>
<span class="sd">            appropriate Globe instance. The ``proj4_params``</span>
<span class="sd">            parameters will override any parameters that the</span>
<span class="sd">            Globe defines.</span>
<span class="sd">        globe: :class:`~cartopy.crs.Globe` instance, optional</span>
<span class="sd">            If omitted, the default Globe instance will be created.</span>
<span class="sd">            See :class:`~cartopy.crs.Globe` for details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="p">)</span>

        <span class="c1"># for compatibility with pyproj.CRS and rasterio.crs.CRS</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proj4_params</span> <span class="o">=</span> <span class="n">proj4_params</span><span class="o">.</span><span class="n">to_wkt</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># handle PROJ JSON</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span>
            <span class="s2">&quot;proj&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">proj4_params</span> <span class="ow">and</span>
            <span class="s2">&quot;init&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">proj4_params</span>
        <span class="p">):</span>
            <span class="n">proj4_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot have &#39;globe&#39; with string params.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles_ellipses</span><span class="p">:</span>
                <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">,</span>
                              <span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles_ellipses</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="n">a</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span> <span class="ow">or</span> <span class="n">globe</span><span class="o">.</span><span class="n">ellipse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s1"> projection &#39;</span>
                              <span class="s1">&#39;does not handle elliptical globes.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proj4_params</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span> <span class="o">=</span> <span class="n">proj4_params</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proj4_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">to_proj4_params</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proj4_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">)</span>

            <span class="n">init_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj4_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                        <span class="n">init_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s1">.16</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">):</span>
                        <span class="n">init_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s1">.8</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">init_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">init_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">init_items</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; +no_defs&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CRS</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">:</span>
            <span class="c1"># Fast path Cartopy&#39;s CRS</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># For everything else, we let pyproj handle the comparison</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hash the CRS based on its proj4_init string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the __reduce__ method used when pickling or performing deepcopy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CRS</span><span class="p">:</span>
            <span class="c1"># State can be reproduced by the proj4_params and globe inputs.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Produces a stateless instance of this class (e.g. an empty tuple).</span>
            <span class="c1"># The state will then be added via __getstate__ and __setstate__.</span>
            <span class="c1"># We are forced to this approach because a CRS does not store</span>
            <span class="c1"># the constructor keyword arguments in its state.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the full state of this instance for reconstruction</span>
<span class="sd">        in ``__setstate__``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># remove pyproj specific attrs</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;srs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_local&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Remove the proj4 instance and the proj4_init string, which can</span>
        <span class="c1"># be re-created (in __setstate__) from the other arguments.</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;proj4&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;proj4_init&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;proj4_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take the dictionary created by ``__getstate__`` and passes it</span>
<span class="sd">        through to this implementation&#39;s __init__ method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Strip out the key state items for a CRS instance.</span>
        <span class="n">CRS_state</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;proj4_params&#39;</span><span class="p">,</span> <span class="s1">&#39;globe&#39;</span><span class="p">]}</span>
        <span class="c1"># Put everything else directly into the dict of the instance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1"># Call the init of this class to ensure that the projection is</span>
        <span class="c1"># properly initialised with proj4.</span>
        <span class="n">CRS</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">CRS_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_as_mpl_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cast this CRS instance into a :class:`matplotlib.axes.Axes` using</span>
<span class="sd">        the Matplotlib ``_as_mpl_transform`` interface.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># lazy import mpl.geoaxes (and therefore matplotlib) as mpl</span>
        <span class="c1"># is only an optional dependency</span>
        <span class="kn">import</span> <span class="nn">cartopy.mpl.geoaxes</span> <span class="k">as</span> <span class="nn">geoaxes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">geoaxes</span><span class="o">.</span><span class="n">GeoAxes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Axes should be an instance of GeoAxes, got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">geoaxes</span><span class="o">.</span><span class="n">InterProjectionTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">transData</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">proj4_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proj4_params</span><span class="p">)</span>

<div class="viewcode-block" id="CRS.as_geocentric">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.CRS.html#cartopy.crs.CRS.as_geocentric">[docs]</a>
    <span class="k">def</span> <span class="nf">as_geocentric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new Geocentric CRS with the same ellipse/datum as this</span>
<span class="sd">        CRS.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CRS</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s2">&quot;https://proj.org/schemas/v0.2/projjson.schema.json&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;GeodeticCRS&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                <span class="s2">&quot;datum&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">to_json_dict</span><span class="p">(),</span>
                <span class="s2">&quot;coordinate_system&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;Cartesian&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Geocentric X&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;abbreviation&quot;</span><span class="p">:</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;geocentricX&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;metre&quot;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Geocentric Y&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;abbreviation&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;geocentricY&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;metre&quot;</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Geocentric Z&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;abbreviation&quot;</span><span class="p">:</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;geocentricZ&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;metre&quot;</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CRS.as_geodetic">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.CRS.html#cartopy.crs.CRS.as_geodetic">[docs]</a>
    <span class="k">def</span> <span class="nf">as_geodetic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new Geodetic CRS with the same ellipse/datum as this</span>
<span class="sd">        CRS.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CRS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodetic_crs</span><span class="o">.</span><span class="n">srs</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">is_geodetic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_geographic</span>

<div class="viewcode-block" id="CRS.transform_point">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.CRS.html#cartopy.crs.CRS.transform_point">[docs]</a>
    <span class="k">def</span> <span class="nf">transform_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        transform_point(x, y, src_crs)</span>

<span class="sd">        Transform the given float64 coordinate pair, in the given source</span>
<span class="sd">        coordinate system (``src_crs``), to this coordinate system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x</span>
<span class="sd">            the x coordinate, in ``src_crs`` coordinates, to transform</span>
<span class="sd">        y</span>
<span class="sd">            the y coordinate, in ``src_crs`` coordinates, to transform</span>
<span class="sd">        src_crs</span>
<span class="sd">            instance of :class:`CRS` that represents the coordinate</span>
<span class="sd">            system of ``x`` and ``y``.</span>
<span class="sd">        trap</span>
<span class="sd">            Whether proj errors for &quot;latitude or longitude exceeded limits&quot; and</span>
<span class="sd">            &quot;tolerance condition error&quot; should be trapped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (x, y) in this coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
            <span class="n">src_crs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span><span class="p">]),</span> <span class="n">trap</span><span class="o">=</span><span class="n">trap</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="CRS.transform_points">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.CRS.html#cartopy.crs.CRS.transform_points">[docs]</a>
    <span class="k">def</span> <span class="nf">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        transform_points(src_crs, x, y[, z])</span>

<span class="sd">        Transform the given coordinates, in the given source</span>
<span class="sd">        coordinate system (``src_crs``), to this coordinate system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        src_crs</span>
<span class="sd">            instance of :class:`CRS` that represents the</span>
<span class="sd">            coordinate system of ``x``, ``y`` and ``z``.</span>
<span class="sd">        x</span>
<span class="sd">            the x coordinates (array), in ``src_crs`` coordinates,</span>
<span class="sd">            to transform.  May be 1 or 2 dimensional.</span>
<span class="sd">        y</span>
<span class="sd">            the y coordinates (array), in ``src_crs`` coordinates,</span>
<span class="sd">            to transform.  Its shape must match that of x.</span>
<span class="sd">        z: optional</span>
<span class="sd">            the z coordinates (array), in ``src_crs`` coordinates, to</span>
<span class="sd">            transform.  Defaults to None.</span>
<span class="sd">            If supplied, its shape must match that of x.</span>
<span class="sd">        trap</span>
<span class="sd">            Whether proj errors for &quot;latitude or longitude exceeded limits&quot; and</span>
<span class="sd">            &quot;tolerance condition error&quot; should be trapped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Array of shape ``x.shape + (3, )`` in this coordinate system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x and y arrays must be 1 or 2 dimensional&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x and y arrays must have the same length&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">z</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x, y and z arrays must be 1 or 2 &#39;</span>
                                 <span class="s1">&#39;dimensional&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">z</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x, y, and z arrays must have the same &#39;</span>
                                 <span class="s1">&#39;length&#39;</span><span class="p">)</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">npts</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">npts</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">src_crs</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">_CylindricalProjection</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_geodetic</span><span class="p">()):</span>
                <span class="c1"># convert from [0,360] to [-180,180]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">to_180</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">)</span>
                <span class="n">x</span><span class="p">[</span><span class="n">to_180</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="n">to_180</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">result</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">_safe_pj_transform</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="n">trap</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ProjError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;latitude&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">or</span>
                    <span class="s2">&quot;longitude&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">or</span>
                    <span class="s2">&quot;outside of projection domain&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">or</span>
                    <span class="s2">&quot;tolerance condition error&quot;</span> <span class="ow">in</span> <span class="n">msg</span>
                <span class="p">):</span>
                    <span class="n">result</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">trap</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">result_shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="CRS.transform_vectors">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.CRS.html#cartopy.crs.CRS.transform_vectors">[docs]</a>
    <span class="k">def</span> <span class="nf">transform_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_proj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        transform_vectors(src_proj, x, y, u, v)</span>

<span class="sd">        Transform the given vector components, with coordinates in the</span>
<span class="sd">        given source coordinate system (``src_proj``), to this coordinate</span>
<span class="sd">        system. The vector components must be given relative to the</span>
<span class="sd">        source projection&#39;s coordinate reference system (grid eastward and</span>
<span class="sd">        grid northward).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        src_proj</span>
<span class="sd">            The :class:`CRS.Projection` that represents the coordinate system</span>
<span class="sd">            the vectors are defined in.</span>
<span class="sd">        x</span>
<span class="sd">            The x coordinates of the vectors in the source projection.</span>
<span class="sd">        y</span>
<span class="sd">            The y coordinates of the vectors in the source projection.</span>
<span class="sd">        u</span>
<span class="sd">            The grid-eastward components of the vectors.</span>
<span class="sd">        v</span>
<span class="sd">            The grid-northward components of the vectors.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">            x, y, u and v may be 1 or 2 dimensional, but must all have matching</span>
<span class="sd">            shapes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            ut, vt: The transformed vector components.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">           The algorithm used to transform vectors is an approximation</span>
<span class="sd">           rather than an exact transform, but the accuracy should be</span>
<span class="sd">           good enough for visualization purposes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x, y, u and v arrays must be the same shape&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x, y, u and v must be 1 or 2 dimensional&#39;</span><span class="p">)</span>
        <span class="c1"># Transform the coordinates to the target projection.</span>
        <span class="n">proj_xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">src_proj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">target_x</span><span class="p">,</span> <span class="n">target_y</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">proj_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Rotate the input vectors to the projection.</span>
        <span class="c1">#</span>
        <span class="c1"># 1: Find the magnitude and direction of the input vectors.</span>
        <span class="n">vector_magnitudes</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">vector_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="c1"># 2: Find a point in the direction of the original vector that is</span>
        <span class="c1">#    a small distance away from the base point of the vector (near</span>
        <span class="c1">#    the poles the point may have to be in the opposite direction</span>
        <span class="c1">#    to be valid).</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">360000.</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">src_proj</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">factor</span>
        <span class="n">x_perturbations</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">vector_angles</span><span class="p">)</span>
        <span class="n">y_perturbations</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">vector_angles</span><span class="p">)</span>
        <span class="c1"># 3: Handle points that are invalid. These come from picking a new</span>
        <span class="c1">#    point that is outside the domain of the CRS. The first step is</span>
        <span class="c1">#    to apply the native transform to the input coordinates to make</span>
        <span class="c1">#    sure they are in the appropriate range. Then detect all the</span>
        <span class="c1">#    coordinates where the perturbation takes the point out of the</span>
        <span class="c1">#    valid x-domain and fix them. After that do the same for points</span>
        <span class="c1">#    that are outside the valid y-domain, which may reintroduce some</span>
        <span class="c1">#    points outside of the valid x-domain</span>
        <span class="n">proj_xyz</span> <span class="o">=</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">src_proj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">source_x</span><span class="p">,</span> <span class="n">source_y</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">proj_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1">#    Detect all the coordinates where the perturbation takes the point</span>
        <span class="c1">#    outside of the valid x-domain, and reverse the direction of the</span>
        <span class="c1">#    perturbation to fix this.</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
        <span class="n">invalid_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
            <span class="n">source_x</span> <span class="o">+</span> <span class="n">x_perturbations</span> <span class="o">&lt;</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span>
            <span class="n">source_x</span> <span class="o">+</span> <span class="n">x_perturbations</span> <span class="o">&gt;</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_x</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">x_perturbations</span><span class="p">[</span><span class="n">invalid_x</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">y_perturbations</span><span class="p">[</span><span class="n">invalid_x</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1">#    Do the same for coordinates where the perturbation takes the point</span>
        <span class="c1">#    outside of the valid y-domain. This may reintroduce some points</span>
        <span class="c1">#    that will be outside the x-domain when the perturbation is</span>
        <span class="c1">#    applied.</span>
        <span class="n">invalid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
            <span class="n">source_y</span> <span class="o">+</span> <span class="n">y_perturbations</span> <span class="o">&lt;</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span>
            <span class="n">source_y</span> <span class="o">+</span> <span class="n">y_perturbations</span> <span class="o">&gt;</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_y</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">x_perturbations</span><span class="p">[</span><span class="n">invalid_y</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">y_perturbations</span><span class="p">[</span><span class="n">invalid_y</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1">#    Keep track of the points where the perturbation direction was</span>
        <span class="c1">#    reversed.</span>
        <span class="n">reversed_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">invalid_x</span><span class="p">,</span> <span class="n">invalid_y</span><span class="p">)</span>
        <span class="c1">#    See if there were any points where we cannot reverse the direction</span>
        <span class="c1">#    of the perturbation to get the perturbed point within the valid</span>
        <span class="c1">#    domain of the projection, and issue a warning if there are.</span>
        <span class="n">problem_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
            <span class="n">source_x</span> <span class="o">+</span> <span class="n">x_perturbations</span> <span class="o">&lt;</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps</span><span class="p">,</span>
            <span class="n">source_x</span> <span class="o">+</span> <span class="n">x_perturbations</span> <span class="o">&gt;</span> <span class="n">src_proj</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">problem_points</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Some vectors at source domain corners &#39;</span>
                          <span class="s1">&#39;may not have been transformed correctly&#39;</span><span class="p">)</span>
        <span class="c1"># 4: Transform this set of points to the projection coordinates and</span>
        <span class="c1">#    find the angle between the base point and the perturbed point</span>
        <span class="c1">#    in the projection coordinates (reversing the direction at any</span>
        <span class="c1">#    points where the original was reversed in step 3).</span>
        <span class="n">proj_xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">src_proj</span><span class="p">,</span>
                                         <span class="n">source_x</span> <span class="o">+</span> <span class="n">x_perturbations</span><span class="p">,</span>
                                         <span class="n">source_y</span> <span class="o">+</span> <span class="n">y_perturbations</span><span class="p">)</span>
        <span class="n">target_x_perturbed</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">target_y_perturbed</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">projected_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">target_y_perturbed</span> <span class="o">-</span> <span class="n">target_y</span><span class="p">,</span>
                                      <span class="n">target_x_perturbed</span> <span class="o">-</span> <span class="n">target_x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reversed_vectors</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">projected_angles</span><span class="p">[</span><span class="n">reversed_vectors</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="c1"># 5: Form the projected vector components, preserving the magnitude</span>
        <span class="c1">#    of the original vectors.</span>
        <span class="n">projected_u</span> <span class="o">=</span> <span class="n">vector_magnitudes</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">projected_angles</span><span class="p">)</span>
        <span class="n">projected_v</span> <span class="o">=</span> <span class="n">vector_magnitudes</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">projected_angles</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">projected_u</span><span class="p">,</span> <span class="n">projected_v</span></div>
</div>



<div class="viewcode-block" id="Geodetic">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Geodetic.html#cartopy.crs.Geodetic">[docs]</a>
<span class="k">class</span> <span class="nc">Geodetic</span><span class="p">(</span><span class="n">CRS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a latitude/longitude coordinate system with spherical topology,</span>
<span class="sd">    geographical distance and coordinates are measured in degrees.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        globe: A :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            Defaults to a &quot;WGS84&quot; datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;lonlat&#39;</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="p">)</span></div>


    <span class="c1"># XXX Implement fwd such as Basemap&#39;s Geod.</span>
    <span class="c1"># Would be used in the tissot example.</span>
    <span class="c1"># Could come from https://geographiclib.sourceforge.io</span>


<div class="viewcode-block" id="Geocentric">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Geocentric.html#cartopy.crs.Geocentric">[docs]</a>
<span class="k">class</span> <span class="nc">Geocentric</span><span class="p">(</span><span class="n">CRS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a Geocentric coordinate system, where x, y, z are Cartesian</span>
<span class="sd">    coordinates from the center of the Earth.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        globe: A :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            Defaults to a &quot;WGS84&quot; datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;geocent&#39;</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="RotatedGeodetic">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.RotatedGeodetic.html#cartopy.crs.RotatedGeodetic">[docs]</a>
<span class="k">class</span> <span class="nc">RotatedGeodetic</span><span class="p">(</span><span class="n">CRS</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a rotated latitude/longitude coordinate system with spherical</span>
<span class="sd">    topology and geographical distance.</span>

<span class="sd">    Coordinates are measured in degrees.</span>

<span class="sd">    The class uses proj to perform an ob_tran operation, using the</span>
<span class="sd">    pole_longitude to set a lon_0 then performing two rotations based on</span>
<span class="sd">    pole_latitude and central_rotated_longitude.</span>
<span class="sd">    This is equivalent to setting the new pole to a location defined by</span>
<span class="sd">    the pole_latitude and pole_longitude values in the GeogCRS defined by</span>
<span class="sd">    globe, then rotating this new CRS about it&#39;s pole using the</span>
<span class="sd">    central_rotated_longitude value.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">,</span>
                 <span class="n">central_rotated_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pole_longitude</span>
<span class="sd">            Pole longitude position, in unrotated degrees.</span>
<span class="sd">        pole_latitude</span>
<span class="sd">            Pole latitude position, in unrotated degrees.</span>
<span class="sd">        central_rotated_longitude: optional</span>
<span class="sd">            Longitude rotation about the new pole, in degrees.  Defaults to 0.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            A :class:`cartopy.crs.Globe`.  Defaults to a &quot;WGS84&quot; datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_tran&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;latlon&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lon_p&#39;</span><span class="p">,</span> <span class="n">central_rotated_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lat_p&#39;</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">pole_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">))]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="Projection">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Projection.html#cartopy.crs.Projection">[docs]</a>
<span class="k">class</span> <span class="nc">Projection</span><span class="p">(</span><span class="n">CRS</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a projected coordinate system with flat topology and Euclidean</span>
<span class="sd">    distance.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_method_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Point&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_point&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LineString&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_line_string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LinearRing&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_linear_ring&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_polygon&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MultiPoint&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_multipoint&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MultiLineString&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_multiline&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_multipolygon&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># Whether or not this projection can handle wrapped coordinates</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_of_use</span><span class="p">:</span>
            <span class="c1"># Convert lat/lon bounds to projected bounds.</span>
            <span class="c1"># Geographic area of the entire dataset referenced to WGS 84</span>
            <span class="c1"># NB. We can&#39;t use a polygon transform at this stage because</span>
            <span class="c1"># that relies on the existence of the map boundary... the very</span>
            <span class="c1"># thing we&#39;re trying to work out! ;-)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_of_use</span><span class="o">.</span><span class="n">west</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_of_use</span><span class="o">.</span><span class="n">east</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_of_use</span><span class="o">.</span><span class="n">south</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_of_use</span><span class="o">.</span><span class="n">north</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x1</span><span class="p">])</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y0</span><span class="p">])</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_threshold&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="nd">@threshold</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">t</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cw_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw_boundary</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cw_boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="k">return</span> <span class="n">boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ccw_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccw_boundary</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccw_boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="k">return</span> <span class="n">boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">domain</span>

    <span class="k">def</span> <span class="nf">is_geodetic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_determine_longitude_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">):</span>
        <span class="c1"># In new proj, using exact limits will wrap-around, so subtract a</span>
        <span class="c1"># small epsilon:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="n">minlon</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span>
        <span class="n">maxlon</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span>
        <span class="k">if</span> <span class="n">central_longitude</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxlon</span> <span class="o">-=</span> <span class="n">epsilon</span>
        <span class="k">elif</span> <span class="n">central_longitude</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">minlon</span> <span class="o">+=</span> <span class="n">epsilon</span>
        <span class="k">return</span> <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">escape</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># As matplotlib is not a core cartopy dependency, don&#39;t error</span>
            <span class="c1"># if it&#39;s not available.</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="c1"># We can&#39;t return an SVG of the CRS, so let Jupyter fall back to</span>
            <span class="c1"># a default repr by returning None.</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Produce a visual repr of the Projection instance.</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                               <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="c1"># &quot;Rewind&quot; the buffer to the start and return it as an svg string.</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">svg</span><span class="si">}</span><span class="s1">&lt;pre&gt;</span><span class="si">{</span><span class="n">escape</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s1">&lt;/pre&gt;&#39;</span>

    <span class="k">def</span> <span class="nf">_as_mpl_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">cartopy.mpl.geoaxes</span> <span class="k">as</span> <span class="nn">geoaxes</span>
        <span class="k">return</span> <span class="n">geoaxes</span><span class="o">.</span><span class="n">GeoAxes</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>

<div class="viewcode-block" id="Projection.project_geometry">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Projection.html#cartopy.crs.Projection.project_geometry">[docs]</a>
    <span class="k">def</span> <span class="nf">project_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Project the given geometry into this projection.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        geometry</span>
<span class="sd">            The geometry to (re-)project.</span>
<span class="sd">        src_crs: optional</span>
<span class="sd">            The source CRS.  Defaults to None.</span>

<span class="sd">            If src_crs is None, the source CRS is assumed to be a geodetic</span>
<span class="sd">            version of the target CRS.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        geometry</span>
<span class="sd">            The projected result (a shapely geometry).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">src_crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">src_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Source CRS must be an instance of CRS&#39;</span>
                            <span class="s1">&#39; or one of its subclasses, or None.&#39;</span><span class="p">)</span>
        <span class="n">geom_type</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">geom_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unsupported geometry type </span><span class="si">{</span><span class="n">geom_type</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_project_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_project_line_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">project_linear</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_project_linear_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linear_ring</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Project the given LinearRing from the src_crs into this CRS and</span>
<span class="sd">        returns a list of LinearRings and a single MultiLineString.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># 1) Resolve the initial lines into projected segments</span>
        <span class="c1"># 1abc</span>
        <span class="c1"># def23ghi</span>
        <span class="c1"># jkl41</span>
        <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">project_linear</span><span class="p">(</span><span class="n">linear_ring</span><span class="p">,</span>
                                                         <span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Threshold for whether a point is close enough to be the same</span>
        <span class="c1"># point as another.</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-5</span>

        <span class="c1"># 2) Simplify the segments where appropriate.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_line_string</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Stitch together segments which are close to continuous.</span>
            <span class="c1"># This is important when:</span>
            <span class="c1"># 1) The first source point projects into the map and the</span>
            <span class="c1"># ring has been cut by the boundary.</span>
            <span class="c1"># Continuing the example from above this gives:</span>
            <span class="c1">#   def23ghi</span>
            <span class="c1">#   jkl41abc</span>
            <span class="c1"># 2) The cut ends of segments are too close to reliably</span>
            <span class="c1"># place into an order along the boundary.</span>

            <span class="n">line_strings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">multi_line_string</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
            <span class="n">any_modified</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="n">first_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">line_strings</span><span class="p">])</span>
                <span class="n">last_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">line_strings</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distance matrix:&#39;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">first_coord</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">last_coord</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">atol</span><span class="o">=</span><span class="n">threshold</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Joining together </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
                        <span class="n">last_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                        <span class="n">first_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">combo</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">last_coords</span> <span class="o">+</span> <span class="n">first_coords</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span>
                        <span class="k">del</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">line_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
                        <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">any_modified</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">any_modified</span><span class="p">:</span>
                <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">line_strings</span><span class="p">)</span>

        <span class="c1"># 3) Check for rings that have been created by the projection stage.</span>
        <span class="n">rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">multi_line_string</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">atol</span><span class="o">=</span><span class="n">threshold</span><span class="p">):</span>
                <span class="n">result_geometry</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_geometry</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c1"># If we found any rings, then we should re-create the multi-line str.</span>
        <span class="k">if</span> <span class="n">rings</span><span class="p">:</span>
            <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">line_strings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rings</span><span class="p">,</span> <span class="n">multi_line_string</span>

    <span class="k">def</span> <span class="nf">_project_multipoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">geoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_point</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_project_multiline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_line_string</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_project_multipolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_polygon</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_project_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the projected polygon(s) derived from the given polygon.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine orientation of polygon.</span>
        <span class="c1"># TODO: Consider checking the internal rings have the opposite</span>
        <span class="c1"># orientation to the external rings?</span>
        <span class="k">if</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">is_geodetic</span><span class="p">():</span>
            <span class="n">is_ccw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_ccw</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">is_ccw</span>
        <span class="c1"># Project the polygon exterior/interior rings.</span>
        <span class="c1"># Each source ring will result in either a ring, or one or more</span>
        <span class="c1"># lines.</span>
        <span class="n">rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">multi_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">src_ring</span> <span class="ow">in</span> <span class="p">[</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">interiors</span><span class="p">):</span>
            <span class="n">p_rings</span><span class="p">,</span> <span class="n">p_mline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_linear_ring</span><span class="p">(</span><span class="n">src_ring</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p_rings</span><span class="p">:</span>
                <span class="n">rings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p_rings</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_mline</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">multi_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_mline</span><span class="p">)</span>

        <span class="c1"># Convert any lines to rings by attaching them to the boundary.</span>
        <span class="k">if</span> <span class="n">multi_lines</span><span class="p">:</span>
            <span class="n">rings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attach_lines_to_boundary</span><span class="p">(</span><span class="n">multi_lines</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">))</span>

        <span class="c1"># Resolve all the inside vs. outside rings, and convert to the</span>
        <span class="c1"># final MultiPolygon.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rings_to_multi_polygon</span><span class="p">(</span><span class="n">rings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_lines_to_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_line_strings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of LinearRings by attaching the ends of the given lines</span>
<span class="sd">        to the boundary, paying attention to the traversal directions of the</span>
<span class="sd">        lines and boundary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">debug_plot_edges</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Accumulate all the boundary and segment end points, along with</span>
        <span class="c1"># their distance along the boundary.</span>
        <span class="n">edge_things</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the boundary as a LineString of the correct orientation</span>
        <span class="c1"># so we can compute distances along it.</span>
        <span class="k">if</span> <span class="n">is_ccw</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ccw_boundary</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cw_boundary</span>

        <span class="k">def</span> <span class="nf">boundary_distance</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">boundary</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">))</span>

        <span class="c1"># Squash all the LineStrings into a single list.</span>
        <span class="n">line_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">multi_line_string</span> <span class="ow">in</span> <span class="n">multi_line_strings</span><span class="p">:</span>
            <span class="n">line_strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">multi_line_string</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>

        <span class="c1"># Record the positions of all the segment ends</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
            <span class="n">first_dist</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">first_dist</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
            <span class="n">last_dist</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">last_dist</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="c1"># Record the positions of all the boundary vertices</span>
        <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">boundary</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
            <span class="n">current_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="c1"># Reset the current figure so we don&#39;t upset anything.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">current_fig</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Order everything as if walking around the boundary.</span>
        <span class="c1"># NB. We make line end-points take precedence over boundary points</span>
        <span class="c1"># to ensure that end-points are still found and followed when they</span>
        <span class="c1"># coincide.</span>
        <span class="n">edge_things</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">thing</span><span class="p">:</span> <span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">thing</span><span class="o">.</span><span class="n">kind</span><span class="p">))</span>
        <span class="n">remaining_ls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">line_strings</span><span class="p">))</span>

        <span class="n">prev_thing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">edge_thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prev_thing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">edge_thing</span><span class="o">.</span><span class="n">kind</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">prev_thing</span><span class="o">.</span><span class="n">kind</span> <span class="ow">and</span>
                    <span class="n">edge_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">prev_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">edge_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Insert a edge boundary point in between this geometry.</span>
                <span class="n">mid_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge_thing</span><span class="o">.</span><span class="n">distance</span> <span class="o">+</span> <span class="n">prev_thing</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">mid_dist</span><span class="p">)</span>
                <span class="n">new_thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">mid_dist</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mid_point</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Artificially insert boundary: </span><span class="si">{</span><span class="n">new_thing</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">edge_things</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">edge_thing</span><span class="p">)</span>
                <span class="n">edge_things</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">new_thing</span><span class="p">)</span>
                <span class="n">prev_thing</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prev_thing</span> <span class="o">=</span> <span class="n">edge_thing</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Edge things&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">filter_last</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">kind</span> <span class="ow">or</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span>

        <span class="n">edge_things</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">filter_last</span><span class="p">,</span> <span class="n">edge_things</span><span class="p">))</span>

        <span class="n">processed_ls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">remaining_ls</span><span class="p">:</span>
            <span class="c1"># Rename line_string to current_ls</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">current_ls</span> <span class="o">=</span> <span class="n">remaining_ls</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">sys</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">current_ls</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">added_linestring</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Find out how far around this linestring&#39;s last</span>
                <span class="c1"># point is on the boundary. We will use this to find</span>
                <span class="c1"># the next point on the boundary.</span>
                <span class="n">d_last</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;   d_last: </span><span class="si">{</span><span class="n">d_last</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">next_thing</span> <span class="o">=</span> <span class="n">_find_first_ge</span><span class="p">(</span><span class="n">edge_things</span><span class="p">,</span> <span class="n">d_last</span><span class="p">)</span>
                <span class="c1"># Remove this boundary point from the edge.</span>
                <span class="n">edge_things</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">next_thing</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   next_thing:&#39;</span><span class="p">,</span> <span class="n">next_thing</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="c1"># We&#39;ve just got a boundary point, add it, and keep going.</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   adding boundary point&#39;</span><span class="p">)</span>
                    <span class="n">boundary_point</span> <span class="o">=</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">combined_coords</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span>
                                       <span class="p">[(</span><span class="n">boundary_point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">boundary_point</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span>
                    <span class="n">current_ls</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">combined_coords</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="c1"># We&#39;ve gone all the way around and are now back at the</span>
                    <span class="c1"># first boundary thing.</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   close loop&#39;</span><span class="p">)</span>
                    <span class="n">processed_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_ls</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   adding line&#39;</span><span class="p">)</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">line_to_append</span> <span class="o">=</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">remaining_ls</span><span class="p">:</span>
                        <span class="n">remaining_ls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">coords_to_append</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_to_append</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

                    <span class="c1"># Build up the linestring.</span>
                    <span class="n">current_ls</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span>
                                                  <span class="n">coords_to_append</span><span class="p">)</span>

                    <span class="c1"># Catch getting stuck in an infinite loop by checking that</span>
                    <span class="c1"># linestring only added once.</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_linestring</span><span class="p">:</span>
                        <span class="n">added_linestring</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unidentified problem with &#39;</span>
                                           <span class="s1">&#39;geometry, linestring being &#39;</span>
                                           <span class="s1">&#39;re-added. Please raise an issue.&#39;</span><span class="p">)</span>

        <span class="c1"># filter out any non-valid linear rings</span>
        <span class="k">def</span> <span class="nf">makes_valid_ring</span><span class="p">(</span><span class="n">line_string</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># When sgeom.LinearRing is passed a LineString of length 3,</span>
                <span class="c1"># if the first and last coordinate are equal, a LinearRing</span>
                <span class="c1"># with 3 coordinates will be created. This object will cause</span>
                <span class="c1"># a segfault when evaluated.</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">line_string</span><span class="o">.</span><span class="n">is_valid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">line_string</span><span class="o">.</span><span class="n">is_valid</span>

        <span class="n">linear_rings</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">line_string</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line_string</span> <span class="ow">in</span> <span class="n">processed_ls</span>
            <span class="k">if</span> <span class="n">makes_valid_ring</span><span class="p">(</span><span class="n">line_string</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   DONE&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">linear_rings</span>

    <span class="k">def</span> <span class="nf">_rings_to_multi_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">):</span>
        <span class="n">exterior_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">interior_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ring</span><span class="o">.</span><span class="n">is_ccw</span> <span class="o">!=</span> <span class="n">is_ccw</span><span class="p">:</span>
                <span class="n">interior_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exterior_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>

        <span class="n">polygon_bits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Turn all the exterior rings into polygon definitions,</span>
        <span class="c1"># &quot;slurping up&quot; any interior rings they contain.</span>
        <span class="k">for</span> <span class="n">exterior_ring</span> <span class="ow">in</span> <span class="n">exterior_rings</span><span class="p">:</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">exterior_ring</span><span class="p">)</span>
            <span class="n">prep_polygon</span> <span class="o">=</span> <span class="n">prep</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">interior_ring</span> <span class="ow">in</span> <span class="n">interior_rings</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">prep_polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">):</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                    <span class="n">interior_rings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">polygon</span><span class="o">.</span><span class="n">crosses</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">):</span>
                    <span class="c1"># Likely that we have an invalid geometry such as</span>
                    <span class="c1"># that from #509 or #537.</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                    <span class="n">interior_rings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
            <span class="n">polygon_bits</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">exterior_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                 <span class="p">[</span><span class="n">ring</span><span class="o">.</span><span class="n">coords</span> <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">holes</span><span class="p">]))</span>

        <span class="c1"># Any left over &quot;interior&quot; rings need &quot;inverting&quot; with respect</span>
        <span class="c1"># to the boundary.</span>
        <span class="k">if</span> <span class="n">interior_rings</span><span class="p">:</span>
            <span class="n">boundary_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">boundary_poly</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">x3</span> <span class="o">-=</span> <span class="n">bx</span>
            <span class="n">y3</span> <span class="o">-=</span> <span class="n">by</span>
            <span class="n">x4</span> <span class="o">+=</span> <span class="n">bx</span>
            <span class="n">y4</span> <span class="o">+=</span> <span class="n">by</span>
            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">interior_rings</span><span class="p">:</span>
                <span class="c1"># Use shapely buffer in an attempt to fix invalid geometries</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_empty</span> <span class="ow">and</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span>
                    <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">x1</span> <span class="o">-=</span> <span class="n">bx</span>
                    <span class="n">y1</span> <span class="o">-=</span> <span class="n">by</span>
                    <span class="n">x2</span> <span class="o">+=</span> <span class="n">bx</span>
                    <span class="n">y2</span> <span class="o">+=</span> <span class="n">by</span>
                    <span class="n">box</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x4</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">y4</span><span class="p">))</span>

                    <span class="c1"># Invert the polygon</span>
                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

                    <span class="c1"># Intersect the inverted polygon with the boundary</span>
                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">boundary_poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
                        <span class="n">polygon_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">polygon_bits</span><span class="p">:</span>
            <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">polygon_bits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">multi_poly</span>

<div class="viewcode-block" id="Projection.quick_vertices_transform">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.Projection.html#cartopy.crs.Projection.quick_vertices_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">quick_vertices_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Where possible, return a vertices array transformed to this CRS from</span>
<span class="sd">        the given vertices array of shape ``(n, 2)`` and the source CRS.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">            This method may return None to indicate that the vertices cannot</span>
<span class="sd">            be transformed quickly, and a more complex geometry transformation</span>
<span class="sd">            is required (see :meth:`cartopy.crs.Projection.project_geometry`).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vertices</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vertices</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">src_crs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Extend the limits a tiny amount to allow for precision mistakes</span>
            <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.e-10</span>
            <span class="n">x_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span>
            <span class="n">y_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">vertices</span></div>
</div>



<span class="k">class</span> <span class="nc">_RectangularProjection</span><span class="p">(</span><span class="n">Projection</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract superclass of projections with a rectangular domain which</span>
<span class="sd">    is symmetric about the origin.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">half_width</span><span class="p">,</span> <span class="n">half_height</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span> <span class="o">=</span> <span class="n">half_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span> <span class="o">=</span> <span class="n">half_height</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_CylindricalProjection</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract class which denotes cylindrical projections where we</span>
<span class="sd">    want to allow x values to wrap around.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_ellipse_boundary</span><span class="p">(</span><span class="n">semimajor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">semiminor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">201</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a projection boundary using an ellipse.</span>

<span class="sd">    This type of boundary is used by several projections.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Clockwise boundary.</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">semimajor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">semiminor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
    <span class="n">coords</span> <span class="o">+=</span> <span class="p">([</span><span class="n">easting</span><span class="p">],</span> <span class="p">[</span><span class="n">northing</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">coords</span>


<div class="viewcode-block" id="PlateCarree">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.PlateCarree">[docs]</a>
<span class="k">class</span> <span class="nc">PlateCarree</span><span class="p">(</span><span class="n">_CylindricalProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;eqc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)),</span>
                        <span class="p">(</span><span class="s1">&#39;vto_meter&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="c1"># Set the threshold around 0.5 if the x max is 180.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">/</span> <span class="mi">360</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bbox_and_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_plate_carree</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a pair of (xmin, xmax) pairs and an offset which can be used</span>
<span class="sd">        for identification of whether data in ``other_plate_carree`` needs</span>
<span class="sd">        to be transformed to wrap appropriately.</span>

<span class="sd">        &gt;&gt;&gt; import cartopy.crs as ccrs</span>
<span class="sd">        &gt;&gt;&gt; src = ccrs.PlateCarree(central_longitude=10)</span>
<span class="sd">        &gt;&gt;&gt; bboxes, offset = ccrs.PlateCarree()._bbox_and_offset(src)</span>
<span class="sd">        &gt;&gt;&gt; print(bboxes)</span>
<span class="sd">        [[-180, -170.0], [-170.0, 180]]</span>
<span class="sd">        &gt;&gt;&gt; print(offset)</span>
<span class="sd">        10.0</span>

<span class="sd">        The returned values are longitudes in ``other_plate_carree``&#39;s</span>
<span class="sd">        coordinate system.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">            The two CRSs must be identical in every way, other than their</span>
<span class="sd">            central longitudes. No checking of this is done.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
        <span class="n">other_lon_0</span> <span class="o">=</span> <span class="n">other_plate_carree</span><span class="o">.</span><span class="n">proj4_params</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>

        <span class="n">lon_0_offset</span> <span class="o">=</span> <span class="n">other_lon_0</span> <span class="o">-</span> <span class="n">self_lon_0</span>

        <span class="n">lon_lower_bound_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon_lower_bound_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">other_plate_carree</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lon_0_offset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lon_lower_bound_1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">lon_lower_bound_1</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span><span class="p">])</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[[</span><span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span><span class="p">],</span>
                <span class="p">[</span><span class="n">lon_lower_bound_1</span><span class="p">,</span> <span class="n">lon_lower_bound_0</span><span class="p">]]</span>

        <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">lon_0_offset</span>

    <span class="k">def</span> <span class="nf">quick_vertices_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">quick_vertices_transform</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>

        <span class="c1"># Optimise the PlateCarree -&gt; PlateCarree case where no</span>
        <span class="c1"># wrapping or interpolation needs to take place.</span>
        <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">PlateCarree</span><span class="p">):</span>
            <span class="n">self_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">src_params</span> <span class="o">=</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">proj4_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">self_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">),</span> <span class="n">src_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">)</span>

            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">potential</span> <span class="o">=</span> <span class="p">(</span><span class="n">self_params</span> <span class="o">==</span> <span class="n">src_params</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">potential</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">src_crs</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bboxes</span><span class="p">,</span> <span class="n">proj_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_and_offset</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span>
                <span class="n">x_lim</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
                    <span class="c1"># Arbitrarily choose the number of moduli to look</span>
                    <span class="c1"># above and below the -180-&gt;180 range. If data is beyond</span>
                    <span class="c1"># this range, we&#39;re not going to transform it quickly.</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">mod</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="n">proj_offset</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="n">return_value</span> <span class="o">=</span> <span class="n">vertices</span> <span class="o">+</span> <span class="p">[[</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">return_value</span></div>



<div class="viewcode-block" id="TransverseMercator">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.TransverseMercator">[docs]</a>
<span class="k">class</span> <span class="nc">TransverseMercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Transverse Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The true longitude of the central meridian in degrees.</span>
<span class="sd">            Defaults to 0.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The true latitude of the planar origin in degrees. Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        scale_factor: optional</span>
<span class="sd">            Scale factor at the central meridian. Defaults to 1.</span>

<span class="sd">        globe: optional</span>
<span class="sd">            An instance of :class:`cartopy.crs.Globe`. If omitted, a default</span>
<span class="sd">            globe is created.</span>

<span class="sd">        approx: optional</span>
<span class="sd">            Whether to use Proj&#39;s approximate projection (True), or the new</span>
<span class="sd">            Extended Transverse Mercator code (False). Defaults to True, but</span>
<span class="sd">            will change to False in the next release.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;tmerc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">approx</span><span class="p">:</span>
            <span class="n">proj4_params</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;approx&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">2e7</span><span class="p">,</span> <span class="mf">2e7</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">1e7</span><span class="p">,</span> <span class="mf">1e7</span><span class="p">)</span></div>



<div class="viewcode-block" id="OSGB">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.OSGB">[docs]</a>
<span class="k">class</span> <span class="nc">OSGB</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span>
                         <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.9996012717</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="mi">400000</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=-</span><span class="mi">100000</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s1">&#39;OSGB36&#39;</span><span class="p">,</span> <span class="n">ellipse</span><span class="o">=</span><span class="s1">&#39;airy&#39;</span><span class="p">),</span>
                         <span class="n">approx</span><span class="o">=</span><span class="n">approx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">7e5</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">13e5</span><span class="p">)</span></div>



<div class="viewcode-block" id="OSNI">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.OSNI">[docs]</a>
<span class="k">class</span> <span class="nc">OSNI</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="mf">6377340.189</span><span class="p">,</span>
                      <span class="n">semiminor_axis</span><span class="o">=</span><span class="mf">6356034.447938534</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">8</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">53.5</span><span class="p">,</span>
                         <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.000035</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">250000</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">,</span> <span class="n">approx</span><span class="o">=</span><span class="n">approx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">18814.9667</span><span class="p">,</span> <span class="mf">386062.3293</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">11764.8481</span><span class="p">,</span> <span class="mf">464720.9559</span><span class="p">)</span></div>



<div class="viewcode-block" id="UTM">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.UTM">[docs]</a>
<span class="k">class</span> <span class="nc">UTM</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Universal Transverse Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">southern_hemisphere</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zone</span>
<span class="sd">            The numeric zone of the UTM required.</span>
<span class="sd">        southern_hemisphere: optional</span>
<span class="sd">            Set to True if the zone is in the southern hemisphere. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            An instance of :class:`cartopy.crs.Globe`. If omitted, a default</span>
<span class="sd">            globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;utm&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;zone&#39;</span><span class="p">,</span> <span class="n">zone</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">southern_hemisphere</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;south&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">easting</span> <span class="o">=</span> <span class="mf">5e5</span>
        <span class="c1"># allow 50% overflow</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">easting</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">easting</span> <span class="o">+</span> <span class="n">easting</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">northing</span> <span class="o">=</span> <span class="mf">1e7</span>
        <span class="c1"># allow 50% overflow</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">northing</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">northing</span> <span class="o">+</span> <span class="n">northing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="EuroPP">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EuroPP">[docs]</a>
<span class="k">class</span> <span class="nc">EuroPP</span><span class="p">(</span><span class="n">UTM</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    UTM Zone 32 projection for EuroPP domain.</span>

<span class="sd">    Ellipsoid is International 1924, Datum is ED50.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="s1">&#39;intl&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4e6</span><span class="p">,</span> <span class="mf">2e6</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">4e6</span><span class="p">,</span> <span class="mf">7.9e6</span><span class="p">)</span></div>



<div class="viewcode-block" id="Mercator">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Mercator">[docs]</a>
<span class="k">class</span> <span class="nc">Mercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">min_latitude</span><span class="o">=-</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">max_latitude</span><span class="o">=</span><span class="mf">84.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latitude_true_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        min_latitude: optional</span>
<span class="sd">            The maximum southerly extent of the projection. Defaults</span>
<span class="sd">            to -80 degrees.</span>
<span class="sd">        max_latitude: optional</span>
<span class="sd">            The maximum northerly extent of the projection. Defaults</span>
<span class="sd">            to 84 degrees.</span>
<span class="sd">        globe: A :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>
<span class="sd">        latitude_true_scale: optional</span>
<span class="sd">            The latitude where the scale is 1. Defaults to 0 degrees.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        scale_factor: optional</span>
<span class="sd">            Scale factor at natural origin. Defaults to unused.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Only one of ``latitude_true_scale`` and ``scale_factor`` should</span>
<span class="sd">        be included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>

        <span class="c1"># If it&#39;s None, we don&#39;t pass it to Proj4, in which case its default</span>
        <span class="c1"># of 0.0 will be used.</span>
        <span class="k">if</span> <span class="n">latitude_true_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="n">latitude_true_scale</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">latitude_true_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It does not make sense to provide both &#39;</span>
                                 <span class="s1">&#39;&quot;scale_factor&quot; and &quot;latitude_true_scale&quot;. &#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;k_0&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Need to have x/y limits defined for the initial hash which</span>
        <span class="c1"># gets used within transform_points for caching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Calculate limits.</span>
        <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_longitude_bounds</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">)</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span><span class="p">]),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">min_latitude</span><span class="p">,</span> <span class="n">max_latitude</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">720</span><span class="p">,</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;_y_limits&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;_x_limits&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_y_limits</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_x_limits</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<span class="c1"># Define a specific instance of a Mercator projection, the Google mercator.</span>
<span class="n">Mercator</span><span class="o">.</span><span class="n">GOOGLE</span> <span class="o">=</span> <span class="n">Mercator</span><span class="p">(</span><span class="n">min_latitude</span><span class="o">=-</span><span class="mf">85.0511287798066</span><span class="p">,</span>
                           <span class="n">max_latitude</span><span class="o">=</span><span class="mf">85.0511287798066</span><span class="p">,</span>
                           <span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">,</span>
                                       <span class="n">semiminor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">,</span>
                                       <span class="n">nadgrids</span><span class="o">=</span><span class="s1">&#39;@null&#39;</span><span class="p">))</span>
<span class="c1"># Deprecated form</span>
<span class="n">GOOGLE_MERCATOR</span> <span class="o">=</span> <span class="n">Mercator</span><span class="o">.</span><span class="n">GOOGLE</span>


<div class="viewcode-block" id="LambertCylindrical">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.LambertCylindrical">[docs]</a>
<span class="k">class</span> <span class="nc">LambertCylindrical</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;cea&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">))]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="LambertConformal">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.LambertConformal">[docs]</a>
<span class="k">class</span> <span class="nc">LambertConformal</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Lambert Conformal conic projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=-</span><span class="mf">96.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">39.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">standard_parallels</span><span class="o">=</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=-</span><span class="mi">30</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The central longitude. Defaults to -96.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The central latitude. Defaults to 39.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        standard_parallels: optional</span>
<span class="sd">            Standard parallel latitude(s). Defaults to (33, 45).</span>
<span class="sd">        globe: optional</span>
<span class="sd">            A :class:`cartopy.crs.Globe`. If omitted, a default globe is</span>
<span class="sd">            created.</span>
<span class="sd">        cutoff: optional</span>
<span class="sd">            Latitude of map cutoff.</span>
<span class="sd">            The map extends to infinity opposite the central pole</span>
<span class="sd">            so we must cut off the map drawing before then.</span>
<span class="sd">            A value of 0 will draw half the globe. Defaults to -30.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;lcc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>

        <span class="n">n_parallels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">standard_parallels</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n_parallels</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;1 or 2 standard parallels must be specified. &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;Got </span><span class="si">{</span><span class="n">n_parallels</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">standard_parallels</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">n_parallels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Compute whether this projection is at the &quot;north pole&quot; or the</span>
        <span class="c1"># &quot;south pole&quot; (after the central lon/lat have been taken into</span>
        <span class="c1"># account).</span>
        <span class="k">if</span> <span class="n">n_parallels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plat</span> <span class="o">=</span> <span class="mi">90</span> <span class="k">if</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Which pole are the parallels closest to? That is the direction</span>
            <span class="c1"># that the cone converges.</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">poliest_sec</span> <span class="o">=</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">poliest_sec</span> <span class="o">=</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">plat</span> <span class="o">=</span> <span class="mi">90</span> <span class="k">if</span> <span class="n">poliest_sec</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">90</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">cutoff</span><span class="p">))</span>
        <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plat</span>
        <span class="k">if</span> <span class="n">plat</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
            <span class="c1"># Ensure clockwise</span>
            <span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span>
                                     <span class="n">central_longitude</span> <span class="o">-</span> <span class="mi">180</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">central_longitude</span> <span class="o">-</span> <span class="mi">180</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
                                     <span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<div class="viewcode-block" id="LambertAzimuthalEqualArea">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.LambertAzimuthalEqualArea">[docs]</a>
<span class="k">class</span> <span class="nc">LambertAzimuthalEqualArea</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Lambert Azimuthal Equal-Area projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The central latitude. Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            A :class:`cartopy.crs.Globe`. If omitted, a default globe is</span>
<span class="sd">            created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;laea&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_major_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>

        <span class="c1"># Find the antipode, and shift it a small amount in latitude to</span>
        <span class="c1"># approximate the extent of the projection:</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">central_latitude</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="o">-</span><span class="n">central_latitude</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">PlateCarree</span><span class="p">(</span><span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">))</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">1.9999</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">false_northing</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<div class="viewcode-block" id="Miller">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Miller">[docs]</a>
<span class="k">class</span> <span class="nc">Miller</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">,</span> <span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span>

        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;mill&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="c1"># See Snyder, 1987. Eqs (11-1) and (11-2) substituting maximums of</span>
        <span class="c1"># (lambda-lambda0)=180 and phi=90 to get limits.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">2.303412543376391</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="RotatedPole">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.RotatedPole">[docs]</a>
<span class="k">class</span> <span class="nc">RotatedPole</span><span class="p">(</span><span class="n">_CylindricalProjection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A rotated latitude/longitude projected coordinate system</span>
<span class="sd">    with cylindrical topology and projected distance.</span>

<span class="sd">    Coordinates are measured in projection metres.</span>

<span class="sd">    The class uses proj to perform an ob_tran operation, using the</span>
<span class="sd">    pole_longitude to set a lon_0 then performing two rotations based on</span>
<span class="sd">    pole_latitude and central_rotated_longitude.</span>
<span class="sd">    This is equivalent to setting the new pole to a location defined by</span>
<span class="sd">    the pole_latitude and pole_longitude values in the GeogCRS defined by</span>
<span class="sd">    globe, then rotating this new CRS about it&#39;s pole using the</span>
<span class="sd">    central_rotated_longitude value.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span>
                 <span class="n">central_rotated_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pole_longitude: optional</span>
<span class="sd">            Pole longitude position, in unrotated degrees. Defaults to 0.</span>
<span class="sd">        pole_latitude: optional</span>
<span class="sd">            Pole latitude position, in unrotated degrees. Defaults to 0.</span>
<span class="sd">        central_rotated_longitude: optional</span>
<span class="sd">            Longitude rotation about the new pole, in degrees. Defaults to 0.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            An optional :class:`cartopy.crs.Globe`. Defaults to a &quot;WGS84&quot;</span>
<span class="sd">            datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_tran&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;latlon&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lon_p&#39;</span><span class="p">,</span> <span class="n">central_rotated_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lat_p&#39;</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">pole_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">))]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="Gnomonic">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Gnomonic">[docs]</a>
<span class="k">class</span> <span class="nc">Gnomonic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;gnom&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="mf">5e7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span></div>



<div class="viewcode-block" id="Stereographic">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Stereographic">[docs]</a>
<span class="k">class</span> <span class="nc">Stereographic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">true_scale_latitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">scale_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;stere&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">true_scale_latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">central_latitude</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;&quot;true_scale_latitude&quot; parameter is only used &#39;</span>
                              <span class="s1">&#39;for polar stereographic projections. Consider &#39;</span>
                              <span class="s1">&#39;the use of &quot;scale_factor&quot; instead.&#39;</span><span class="p">,</span>
                              <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="n">true_scale_latitude</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">scale_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">true_scale_latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It does not make sense to provide both &#39;</span>
                                 <span class="s1">&#39;&quot;scale_factor&quot; and &quot;true_scale_latitude&quot;. &#39;</span>
                                 <span class="s1">&#39;Ignoring &quot;scale_factor&quot;.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;k_0&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_major_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_minor_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMINOR_AXIS</span><span class="p">)</span>

        <span class="c1"># Note: The magic number has been picked to maintain consistent</span>
        <span class="c1"># behaviour with a wgs84 globe. There is no guarantee that the scaling</span>
        <span class="c1"># should even be linear.</span>
        <span class="n">x_axis_offset</span> <span class="o">=</span> <span class="mf">5e7</span> <span class="o">/</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span>
        <span class="n">y_axis_offset</span> <span class="o">=</span> <span class="mf">5e7</span> <span class="o">/</span> <span class="n">WGS84_SEMIMINOR_AXIS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">x_axis_offset</span> <span class="o">+</span> <span class="n">false_easting</span><span class="p">,</span>
                          <span class="n">a</span> <span class="o">*</span> <span class="n">x_axis_offset</span> <span class="o">+</span> <span class="n">false_easting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="n">y_axis_offset</span> <span class="o">+</span> <span class="n">false_northing</span><span class="p">,</span>
                          <span class="n">b</span> <span class="o">*</span> <span class="n">y_axis_offset</span> <span class="o">+</span> <span class="n">false_northing</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-3</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<div class="viewcode-block" id="NorthPolarStereo">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.NorthPolarStereo">[docs]</a>
<span class="k">class</span> <span class="nc">NorthPolarStereo</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">true_scale_latitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">true_scale_latitude</span><span class="o">=</span><span class="n">true_scale_latitude</span><span class="p">,</span>  <span class="c1"># None is +90</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="SouthPolarStereo">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.SouthPolarStereo">[docs]</a>
<span class="k">class</span> <span class="nc">SouthPolarStereo</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">true_scale_latitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">central_latitude</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">true_scale_latitude</span><span class="o">=</span><span class="n">true_scale_latitude</span><span class="p">,</span>  <span class="c1"># None is -90</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>



<div class="viewcode-block" id="Orthographic">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Orthographic">[docs]</a>
<span class="k">class</span> <span class="nc">Orthographic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;ortho&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_major_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>

        <span class="c1"># To stabilise the projection of geometries, we reduce the boundary by</span>
        <span class="c1"># a tiny fraction at the cost of the extreme edges.</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">0.99999</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">0.99999</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.02</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<span class="k">class</span> <span class="nc">_WarpedRectangularProjection</span><span class="p">(</span><span class="n">Projection</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">false_easting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proj4_params</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">false_northing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">proj4_params</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Obtain boundary points</span>
        <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_longitude_bounds</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlon</span>
        <span class="n">lat</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlon</span>
        <span class="n">lat</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlon</span>
        <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>


<div class="viewcode-block" id="Aitoff">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Aitoff">[docs]</a>
<span class="k">class</span> <span class="nc">Aitoff</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Aitoff projection.</span>

<span class="sd">    This projection is a modified azimuthal equidistant projection, balancing</span>
<span class="sd">    shape and scale distortion. There are no standard lines and only the</span>
<span class="sd">    central point is free of distortion.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: float, optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: float, optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">            .. note::</span>
<span class="sd">                This projection does not handle elliptical globes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;aitoff&#39;</span><span class="p">),</span>
                       <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                         <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span></div>



<span class="k">class</span> <span class="nc">_Eckert</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert projection.</span>

<span class="sd">    This class implements all the methods common to the Eckert family of</span>
<span class="sd">    projections.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: float, optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: float, optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">            .. note::</span>
<span class="sd">                This projection does not handle elliptical globes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proj_name</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                         <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span>


<div class="viewcode-block" id="EckertI">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EckertI">[docs]</a>
<span class="k">class</span> <span class="nc">EckertI</span><span class="p">(</span><span class="n">_Eckert</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert I projection.</span>

<span class="sd">    This projection is pseudocylindrical, but not equal-area. Both meridians</span>
<span class="sd">    and parallels are straight lines. Its equal-area pair is :class:`EckertII`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_proj_name</span> <span class="o">=</span> <span class="s1">&#39;eck1&#39;</span></div>



<div class="viewcode-block" id="EckertII">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EckertII">[docs]</a>
<span class="k">class</span> <span class="nc">EckertII</span><span class="p">(</span><span class="n">_Eckert</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert II projection.</span>

<span class="sd">    This projection is pseudocylindrical, and equal-area. Both meridians and</span>
<span class="sd">    parallels are straight lines. Its non-equal-area pair with equally-spaced</span>
<span class="sd">    parallels is :class:`EckertI`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_proj_name</span> <span class="o">=</span> <span class="s1">&#39;eck2&#39;</span></div>



<div class="viewcode-block" id="EckertIII">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EckertIII">[docs]</a>
<span class="k">class</span> <span class="nc">EckertIII</span><span class="p">(</span><span class="n">_Eckert</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert III projection.</span>

<span class="sd">    This projection is pseudocylindrical, but not equal-area. Parallels are</span>
<span class="sd">    equally-spaced straight lines, while meridians are elliptical arcs up to</span>
<span class="sd">    semicircles on the edges. Its equal-area pair is :class:`EckertIV`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_proj_name</span> <span class="o">=</span> <span class="s1">&#39;eck3&#39;</span></div>



<div class="viewcode-block" id="EckertIV">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EckertIV">[docs]</a>
<span class="k">class</span> <span class="nc">EckertIV</span><span class="p">(</span><span class="n">_Eckert</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert IV projection.</span>

<span class="sd">    This projection is pseudocylindrical, and equal-area. Parallels are</span>
<span class="sd">    unequally-spaced straight lines, while meridians are elliptical arcs up to</span>
<span class="sd">    semicircles on the edges. Its non-equal-area pair with equally-spaced</span>
<span class="sd">    parallels is :class:`EckertIII`.</span>

<span class="sd">    It is commonly used for world maps.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_proj_name</span> <span class="o">=</span> <span class="s1">&#39;eck4&#39;</span></div>



<div class="viewcode-block" id="EckertV">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EckertV">[docs]</a>
<span class="k">class</span> <span class="nc">EckertV</span><span class="p">(</span><span class="n">_Eckert</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert V projection.</span>

<span class="sd">    This projection is pseudocylindrical, but not equal-area. Parallels are</span>
<span class="sd">    equally-spaced straight lines, while meridians are sinusoidal arcs. Its</span>
<span class="sd">    equal-area pair is :class:`EckertVI`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_proj_name</span> <span class="o">=</span> <span class="s1">&#39;eck5&#39;</span></div>



<div class="viewcode-block" id="EckertVI">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EckertVI">[docs]</a>
<span class="k">class</span> <span class="nc">EckertVI</span><span class="p">(</span><span class="n">_Eckert</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Eckert VI projection.</span>

<span class="sd">    This projection is pseudocylindrical, and equal-area. Parallels are</span>
<span class="sd">    unequally-spaced straight lines, while meridians are sinusoidal arcs. Its</span>
<span class="sd">    non-equal-area pair with equally-spaced parallels is :class:`EckertV`.</span>

<span class="sd">    It is commonly used for world maps.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_proj_name</span> <span class="o">=</span> <span class="s1">&#39;eck6&#39;</span></div>



<div class="viewcode-block" id="EqualEarth">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EqualEarth">[docs]</a>
<span class="k">class</span> <span class="nc">EqualEarth</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Equal Earth projection.</span>

<span class="sd">    This projection is pseudocylindrical, and equal area. Parallels are</span>
<span class="sd">    unequally-spaced straight lines, while meridians are equally-spaced arcs.</span>

<span class="sd">    It is intended for world maps.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    To use this projection, you must be using Proj 5.2.0 or newer.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Bojan Šavrič, Tom Patterson &amp; Bernhard Jenny (2018)</span>
<span class="sd">    The Equal Earth map projection,</span>
<span class="sd">    International Journal of Geographical Information Science,</span>
<span class="sd">    DOI: 10.1080/13658816.2018.1504949</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: float, optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: float, optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;eqearth&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                         <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span></div>



<div class="viewcode-block" id="Hammer">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Hammer">[docs]</a>
<span class="k">class</span> <span class="nc">Hammer</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Hammer projection.</span>

<span class="sd">    This projection is a modified `.LambertAzimuthalEqualArea` projection,</span>
<span class="sd">    similar to `.Aitoff`, and intended to reduce distortion in the outer</span>
<span class="sd">    meridians compared to `.Mollweide`. There are no standard lines and only</span>
<span class="sd">    the central point is free of distortion.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: float, optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: float, optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">            .. note::</span>
<span class="sd">                This projection does not handle elliptical globes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;hammer&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                         <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span></div>



<div class="viewcode-block" id="Mollweide">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Mollweide">[docs]</a>
<span class="k">class</span> <span class="nc">Mollweide</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Mollweide projection.</span>

<span class="sd">    This projection is pseudocylindrical, and equal area. Parallels are</span>
<span class="sd">    unequally-spaced straight lines, while meridians are elliptical arcs up to</span>
<span class="sd">    semicircles on the edges. Poles are points.</span>

<span class="sd">    It is commonly used for world maps, or interrupted with several central</span>
<span class="sd">    meridians.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: float, optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: float, optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">            .. note::</span>
<span class="sd">                This projection does not handle elliptical globes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                         <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span></div>



<div class="viewcode-block" id="Robinson">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Robinson">[docs]</a>
<span class="k">class</span> <span class="nc">Robinson</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Robinson projection.</span>

<span class="sd">    This projection is pseudocylindrical, and a compromise that is neither</span>
<span class="sd">    equal-area nor conformal. Parallels are unequally-spaced straight lines,</span>
<span class="sd">    and meridians are curved lines of no particular form.</span>

<span class="sd">    It is commonly used for &quot;visually-appealing&quot; world maps.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: float, optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: float, optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">            .. note::</span>
<span class="sd">                This projection does not handle elliptical globes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                         <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                         <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e4</span>

    <span class="k">def</span> <span class="nf">transform_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture and handle any input NaNs, else invoke parent function,</span>
<span class="sd">        :meth:`_WarpedRectangularProjection.transform_point`.</span>

<span class="sd">        Needed because input NaNs can trigger a fatal error in the underlying</span>
<span class="sd">        implementation of the Robinson projection.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">            Although the original can in fact translate (nan, lat) into</span>
<span class="sd">            (nan, y-value), this patched version doesn&#39;t support that.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="n">trap</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture and handle NaNs in input points -- else as parent function,</span>
<span class="sd">        :meth:`_WarpedRectangularProjection.transform_points`.</span>

<span class="sd">        Needed because input NaNs can trigger a fatal error in the underlying</span>
<span class="sd">        implementation of the Robinson projection.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">            Although the original can in fact translate (nan, lat) into</span>
<span class="sd">            (nan, y-value), this patched version doesn&#39;t support that.</span>
<span class="sd">            Instead, we invalidate any of the points that contain a NaN.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_point_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">input_point_nans</span> <span class="o">|=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">handle_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">input_point_nans</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle_nans</span><span class="p">:</span>
            <span class="c1"># Remove NaN points from input data to avoid the error.</span>
            <span class="n">x</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">y</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">z</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">trap</span><span class="o">=</span><span class="n">trap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle_nans</span><span class="p">:</span>
            <span class="c1"># Result always has shape (N, 3).</span>
            <span class="c1"># Blank out each (whole) point where we had a NaN in the input.</span>
            <span class="n">result</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="InterruptedGoodeHomolosine">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.InterruptedGoodeHomolosine">[docs]</a>
<span class="k">class</span> <span class="nc">InterruptedGoodeHomolosine</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Composite equal-area projection emphasizing either land or</span>
<span class="sd">    ocean features.</span>

<span class="sd">    Original Reference:</span>
<span class="sd">        Goode, J. P., 1925: The Homolosine Projection: A new device for</span>
<span class="sd">        portraying the Earth&#39;s surface entire. Annals of the</span>
<span class="sd">        Association of American Geographers, 15:3, 119-125,</span>
<span class="sd">        DOI: 10.1080/00045602509356949</span>

<span class="sd">    A central_longitude value of -160 is recommended for the oceanic view.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">emphasis</span><span class="o">=</span><span class="s1">&#39;land&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude : float, optional</span>
<span class="sd">            The central longitude, by default 0</span>
<span class="sd">        globe : :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default Globe object is created, by default None</span>
<span class="sd">        emphasis : str, optional</span>
<span class="sd">            Options &#39;land&#39; and &#39;ocean&#39; are available, by default &#39;land&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">emphasis</span> <span class="o">==</span> <span class="s1">&#39;land&#39;</span><span class="p">:</span>
            <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;igh&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">emphasis</span> <span class="o">==</span> <span class="s1">&#39;ocean&#39;</span><span class="p">:</span>
            <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;igh_o&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;`emphasis` needs to be either </span><span class="se">\&#39;</span><span class="s1">land</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">ocean</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_longitude_bounds</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">)</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-10</span>

        <span class="c1"># Obtain boundary points</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">31</span>
        <span class="k">if</span> <span class="n">emphasis</span> <span class="o">==</span> <span class="s1">&#39;land&#39;</span><span class="p">:</span>
            <span class="n">top_interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,)</span>
            <span class="n">bottom_interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="mf">80.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">emphasis</span> <span class="o">==</span> <span class="s1">&#39;ocean&#39;</span><span class="p">:</span>
            <span class="n">top_interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">)</span>
            <span class="n">bottom_interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="mf">90.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_interrupted_lons</span> <span class="o">+</span> <span class="n">bottom_interrupted_lons</span><span class="p">))</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span>
            <span class="mi">1</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_interrupted_lons</span> <span class="o">+</span> <span class="n">bottom_interrupted_lons</span><span class="p">))</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span>
            <span class="mi">1</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Left boundary</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlon</span>
        <span class="n">lats</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>

        <span class="c1"># Top boundary</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">top_interrupted_lons</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="n">epsilon</span> <span class="o">+</span> <span class="n">central_longitude</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">+</span> <span class="n">central_longitude</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>

        <span class="c1"># Right boundary</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlon</span>
        <span class="n">lats</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>

        <span class="c1"># Bottom boundary</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">bottom_interrupted_lons</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">+</span> <span class="n">central_longitude</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="n">epsilon</span> <span class="o">+</span> <span class="n">central_longitude</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">end</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">+=</span> <span class="n">n</span>

        <span class="c1"># Close loop</span>
        <span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlon</span>
        <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">2e4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<span class="k">class</span> <span class="nc">_Satellite</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sweep_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="n">projection</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">satellite_height</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">sweep_axis</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;sweep&#39;</span><span class="p">,</span> <span class="n">sweep_axis</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.02</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>


<div class="viewcode-block" id="Geostationary">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Geostationary">[docs]</a>
<span class="k">class</span> <span class="nc">Geostationary</span><span class="p">(</span><span class="n">_Satellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A view appropriate for satellites in Geostationary Earth orbit.</span>

<span class="sd">    Perspective view looking directly down from above a point on the equator.</span>

<span class="sd">    In this projection, the projected coordinates are scanning angles measured</span>
<span class="sd">    from the satellite looking directly downward, multiplied by the height of</span>
<span class="sd">    the satellite.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sweep_axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        satellite_height: float, optional</span>
<span class="sd">            The height of the satellite. Defaults to 35785831 metres</span>
<span class="sd">            (true geostationary orbit).</span>
<span class="sd">        false_easting:</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing:</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>
<span class="sd">        sweep_axis: &#39;x&#39; or &#39;y&#39;, optional. Defaults to &#39;y&#39;.</span>
<span class="sd">            Controls which axis is scanned first, and thus which angle is</span>
<span class="sd">            applied first. The default is appropriate for Meteosat, while</span>
<span class="sd">            &#39;x&#39; should be used for GOES.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span>
            <span class="n">satellite_height</span><span class="o">=</span><span class="n">satellite_height</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
            <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">,</span>
            <span class="n">sweep_axis</span><span class="o">=</span><span class="n">sweep_axis</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_major_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_minor_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMINOR_AXIS</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">satellite_height</span><span class="p">)</span>

        <span class="c1"># To find the bound we trace around where the line from the satellite</span>
        <span class="c1"># is tangent to the surface. This involves trigonometry on a sphere</span>
        <span class="c1"># centered at the satellite. The two scanning angles form two legs of</span>
        <span class="c1"># triangle on this sphere--the hypotenuse &quot;c&quot; (angle arc) is controlled</span>
        <span class="c1"># by distance from center to the edge of the ellipse being seen.</span>

        <span class="c1"># This is one of the angles in the spherical triangle and used to</span>
        <span class="c1"># rotate around and &quot;scan&quot; the boundary</span>
        <span class="n">angleA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>  <span class="c1"># Clockwise boundary.</span>

        <span class="c1"># Convert the angle around center to the proper value to use in the</span>
        <span class="c1"># parametric form of an ellipse</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angleA</span><span class="p">))</span>

        <span class="c1"># Given the position on the ellipse, what is the distance from center</span>
        <span class="c1"># to the ellipse--and thus the tangent point</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">))</span>
        <span class="n">sat_dist</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">h</span>

        <span class="c1"># Using this distance, solve for sin and tan of c in the triangle that</span>
        <span class="c1"># includes the satellite, Earth center, and tangent point--we need to</span>
        <span class="c1"># figure out the location of this tangent point on the elliptical</span>
        <span class="c1"># cross-section through the Earth towards the satellite, where the</span>
        <span class="c1"># major axis is a and the minor is r. With the ellipse centered on the</span>
        <span class="c1"># Earth and the satellite on the y-axis (at y = a + h = sat_dist), the</span>
        <span class="c1"># equation for an ellipse and some calculus gives us the tangent point</span>
        <span class="c1"># (x0, y0) as:</span>
        <span class="c1"># y0 = a**2 / sat_dist</span>
        <span class="c1"># x0 = r * np.sqrt(1 - a**2 / sat_dist**2)</span>
        <span class="c1"># which gives:</span>
        <span class="c1"># sin_c = x0 / np.hypot(x0, sat_dist - y0)</span>
        <span class="c1"># tan_c = x0 / (sat_dist - y0)</span>
        <span class="c1"># A bit of algebra combines these to give directly:</span>
        <span class="n">sin_c</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sat_dist</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">r</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">tan_c</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sat_dist</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Using Napier&#39;s rules for right spherical triangles R2 and R6,</span>
        <span class="c1"># (See https://en.wikipedia.org/wiki/Spherical_trigonometry), we can</span>
        <span class="c1"># solve for arc angles b and a, which are our x and y scanning angles,</span>
        <span class="c1"># respectively.</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleA</span><span class="p">)</span> <span class="o">*</span> <span class="n">tan_c</span><span class="p">),</span>  <span class="c1"># R6</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angleA</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin_c</span><span class="p">)])</span>  <span class="c1"># R2</span>

        <span class="c1"># Need to multiply scanning angles by satellite height to get to the</span>
        <span class="c1"># actual native coordinates for the projection.</span>
        <span class="n">coords</span> <span class="o">*=</span> <span class="n">h</span>
        <span class="n">coords</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">false_easting</span><span class="p">],</span> <span class="p">[</span><span class="n">false_northing</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_boundary</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span></div>



<div class="viewcode-block" id="NearsidePerspective">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.NearsidePerspective">[docs]</a>
<span class="k">class</span> <span class="nc">NearsidePerspective</span><span class="p">(</span><span class="n">_Satellite</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perspective view looking directly down from above a point on the globe.</span>

<span class="sd">    In this projection, the projected coordinates are x and y measured from</span>
<span class="sd">    the origin of a plane tangent to the Earth directly below the perspective</span>
<span class="sd">    point (e.g. a satellite).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_handles_ellipses</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: float, optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        central_latitude: float, optional</span>
<span class="sd">            The central latitude. Defaults to 0.</span>
<span class="sd">        satellite_height: float, optional</span>
<span class="sd">            The height of the satellite. Defaults to 35785831 meters</span>
<span class="sd">            (true geostationary orbit).</span>
<span class="sd">        false_easting:</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing:</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: :class:`cartopy.crs.Globe`, optional</span>
<span class="sd">            If omitted, a default globe is created.</span>

<span class="sd">            .. note::</span>
<span class="sd">                This projection does not handle elliptical globes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;nsper&#39;</span><span class="p">,</span>
            <span class="n">satellite_height</span><span class="o">=</span><span class="n">satellite_height</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
            <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
            <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_major_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span>

        <span class="n">h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">satellite_height</span><span class="p">)</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_boundary</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span></div>



<div class="viewcode-block" id="AlbersEqualArea">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.AlbersEqualArea">[docs]</a>
<span class="k">class</span> <span class="nc">AlbersEqualArea</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Albers Equal Area projection</span>

<span class="sd">    This projection is conic and equal-area, and is commonly used for maps of</span>
<span class="sd">    the conterminous United States.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">standard_parallels</span><span class="o">=</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The central latitude. Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        standard_parallels: optional</span>
<span class="sd">            The one or two latitudes of correct scale. Defaults to (20, 50).</span>
<span class="sd">        globe: optional</span>
<span class="sd">            A :class:`cartopy.crs.Globe`. If omitted, a default globe is</span>
<span class="sd">            created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;aea&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">standard_parallels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># bounds</span>
        <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_longitude_bounds</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">103</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">lats</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lats</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<div class="viewcode-block" id="AzimuthalEquidistant">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.AzimuthalEquidistant">[docs]</a>
<span class="k">class</span> <span class="nc">AzimuthalEquidistant</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Azimuthal Equidistant projection</span>

<span class="sd">    This projection provides accurate angles about and distances through the</span>
<span class="sd">    central position. Other angles, distances, or areas may be distorted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The true longitude of the central meridian in degrees.</span>
<span class="sd">            Defaults to 0.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The true latitude of the planar origin in degrees.</span>
<span class="sd">            Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            An instance of :class:`cartopy.crs.Globe`. If omitted, a default</span>
<span class="sd">            globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;aeqd&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_major_metre</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">semi_minor_metre</span> <span class="ow">or</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<div class="viewcode-block" id="Sinusoidal">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.Sinusoidal">[docs]</a>
<span class="k">class</span> <span class="nc">Sinusoidal</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Sinusoidal projection.</span>

<span class="sd">    This projection is equal-area.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            A :class:`cartopy.crs.Globe`. If omitted, a default globe is</span>
<span class="sd">            created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;sinu&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Obtain boundary points</span>
        <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_longitude_bounds</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlon</span>
        <span class="n">lat</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlon</span>
        <span class="n">lat</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlon</span>
        <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<span class="c1"># MODIS data products use a Sinusoidal projection of a spherical Earth</span>
<span class="c1"># https://modis-land.gsfc.nasa.gov/GCTP.html</span>
<span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span> <span class="o">=</span> <span class="n">Sinusoidal</span><span class="p">(</span><span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">semimajor_axis</span><span class="o">=</span><span class="mf">6371007.181</span><span class="p">,</span>
                                          <span class="n">semiminor_axis</span><span class="o">=</span><span class="mf">6371007.181</span><span class="p">))</span>


<div class="viewcode-block" id="EquidistantConic">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.EquidistantConic">[docs]</a>
<span class="k">class</span> <span class="nc">EquidistantConic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Equidistant Conic projection.</span>

<span class="sd">    This projection is conic and equidistant, and the scale is true along all</span>
<span class="sd">    meridians and along one or two specified standard parallels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">standard_parallels</span><span class="o">=</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The central longitude. Defaults to 0.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The true latitude of the planar origin in degrees. Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from planar origin in metres. Defaults to 0.</span>
<span class="sd">        standard_parallels: optional</span>
<span class="sd">            The one or two latitudes of correct scale. Defaults to (20, 50).</span>
<span class="sd">        globe: optional</span>
<span class="sd">            A :class:`cartopy.crs.Globe`. If omitted, a default globe is</span>
<span class="sd">            created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;eqdc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">standard_parallels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># bounds</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">103</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_longitude_bounds</span><span class="p">(</span><span class="n">central_longitude</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minlon</span><span class="p">,</span> <span class="n">maxlon</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">lats</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lats</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<div class="viewcode-block" id="ObliqueMercator">
<a class="viewcode-back" href="../../reference/projections.html#cartopy.crs.ObliqueMercator">[docs]</a>
<span class="k">class</span> <span class="nc">ObliqueMercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Oblique Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_wrappable</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">azimuth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        central_longitude: optional</span>
<span class="sd">            The true longitude of the central meridian in degrees.</span>
<span class="sd">            Defaults to 0.</span>
<span class="sd">        central_latitude: optional</span>
<span class="sd">            The true latitude of the planar origin in degrees. Defaults to 0.</span>
<span class="sd">        false_easting: optional</span>
<span class="sd">            X offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        false_northing: optional</span>
<span class="sd">            Y offset from the planar origin in metres. Defaults to 0.</span>
<span class="sd">        scale_factor: optional</span>
<span class="sd">            Scale factor at the central meridian. Defaults to 1.</span>
<span class="sd">        azimuth: optional</span>
<span class="sd">            Azimuth of centerline clockwise from north at the center point of</span>
<span class="sd">            the centre line. Defaults to 0.</span>
<span class="sd">        globe: optional</span>
<span class="sd">            An instance of :class:`cartopy.crs.Globe`. If omitted, a default</span>
<span class="sd">            globe is created.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The &#39;Rotated Mercator&#39; projection can be achieved using Oblique</span>
<span class="sd">        Mercator with `azimuth` ``=90``.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span> <span class="mi">90</span><span class="p">):</span>
            <span class="c1"># Exactly 90 causes coastline &#39;folding&#39;.</span>
            <span class="n">azimuth</span> <span class="o">-=</span> <span class="mf">1e-3</span>

        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;omerc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lonc&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Couple limits to those of Mercator - delivers acceptable plots, and</span>
        <span class="c1">#  Mercator has been through much more scrutiny.</span>
        <span class="n">mercator</span> <span class="o">=</span> <span class="n">Mercator</span><span class="p">(</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">,</span>
            <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
            <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
            <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">mercator</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">mercator</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">mercator</span><span class="o">.</span><span class="n">threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>



<span class="k">class</span> <span class="nc">_BoundaryPoint</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A representation for a geometric object which is</span>
<span class="sd">        connected to the boundary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distance: float</span>
<span class="sd">            The distance along the boundary that this object</span>
<span class="sd">            can be found.</span>
<span class="sd">        kind: bool</span>
<span class="sd">            Whether this object represents a point from the</span>
<span class="sd">            pre-computed boundary.</span>
<span class="sd">        data: point or namedtuple</span>
<span class="sd">            The actual data that this boundary object represents.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;_BoundaryPoint(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s1">)&#39;</span>


<span class="k">def</span> <span class="nf">_find_first_ge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">distance</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>
    <span class="c1"># We&#39;ve gone all the way around, so pick the first point again.</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<div class="viewcode-block" id="epsg">
<a class="viewcode-back" href="../../reference/generated/cartopy.crs.epsg.html#cartopy.crs.epsg">[docs]</a>
<span class="k">def</span> <span class="nf">epsg</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the projection which corresponds to the given EPSG code.</span>

<span class="sd">    The EPSG code must correspond to a &quot;projected coordinate system&quot;,</span>
<span class="sd">    so EPSG codes such as 4326 (WGS-84) which define a &quot;geodetic coordinate</span>
<span class="sd">    system&quot; will not work.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">        The conversion is performed by pyproj.CRS.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">cartopy._epsg</span>
    <span class="k">return</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">_epsg</span><span class="o">.</span><span class="n">_EPSGProjection</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © <a href="../../copyright.html">Copyright</a> 2011 - 2018 British Crown Copyright, 2018 - 2024 Cartopy contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>