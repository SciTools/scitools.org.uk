<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cartopy.crs &#8212; cartopy 0.15.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.15.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="cartopy 0.15.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
 

     <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
     <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">

     <link rel="stylesheet" href="../../_static/layout.css" type="text/css" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../cartopy_outline.html" title="Module outline"
             accesskey="O">outline</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../gallery.html">gallery</a>|&nbsp;</li>
        

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a href="../../index.html">
<img src="../../_static/cartopy.png" 
border="0" alt="Cartopy" style="margin-left: -60px;"/>
</a>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
        <!-- add an empty div to clear the logo on the right. -->
        <div style="float: right; right:0px; height: 140px; width:100px; display: block;"></div>
        
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cartopy.crs</h1><div class="highlight"><pre>
<span></span><span class="c1"># (C) British Crown Copyright 2011 - 2016, Met Office</span>
<span class="c1">#</span>
<span class="c1"># This file is part of cartopy.</span>
<span class="c1">#</span>
<span class="c1"># cartopy is free software: you can redistribute it and/or modify it under</span>
<span class="c1"># the terms of the GNU Lesser General Public License as published by the</span>
<span class="c1"># Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># cartopy is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with cartopy.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The crs module defines Coordinate Reference Systems and the transformations</span>
<span class="sd">between them.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractproperty</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sgeom</span>
<span class="kn">from</span> <span class="nn">shapely.prepared</span> <span class="k">import</span> <span class="n">prep</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">cartopy._crs</span> <span class="k">import</span> <span class="n">CRS</span><span class="p">,</span> <span class="n">Geocentric</span><span class="p">,</span> <span class="n">Geodetic</span><span class="p">,</span> <span class="n">Globe</span><span class="p">,</span> <span class="n">PROJ4_VERSION</span>
<span class="kn">import</span> <span class="nn">cartopy.trace</span>


<span class="n">__document_these__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRS&#39;</span><span class="p">,</span> <span class="s1">&#39;Geocentric&#39;</span><span class="p">,</span> <span class="s1">&#39;Geodetic&#39;</span><span class="p">,</span> <span class="s1">&#39;Globe&#39;</span><span class="p">]</span>


<span class="n">WGS84_SEMIMAJOR_AXIS</span> <span class="o">=</span> <span class="mf">6378137.0</span>
<span class="n">WGS84_SEMIMINOR_AXIS</span> <span class="o">=</span> <span class="mf">6356752.3142</span>


<div class="viewcode-block" id="RotatedGeodetic"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.RotatedGeodetic">[docs]</a><span class="k">class</span> <span class="nc">RotatedGeodetic</span><span class="p">(</span><span class="n">CRS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a rotated latitude/longitude coordinate system with spherical</span>
<span class="sd">    topology and geographical distance.</span>

<span class="sd">    Coordinates are measured in degrees.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">,</span>
                 <span class="n">central_rotated_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a RotatedGeodetic CRS.</span>

<span class="sd">        The class uses proj4 to perform an ob_tran operation, using the</span>
<span class="sd">        pole_longitude to set a lon_0 then performing two rotations based on</span>
<span class="sd">        pole_latitude and central_rotated_longitude.</span>
<span class="sd">        This is equivalent to setting the new pole to a location defined by</span>
<span class="sd">        the pole_latitude and pole_longitude values in the GeogCRS defined by</span>
<span class="sd">        globe, then rotating this new CRS about it&#39;s pole using the</span>
<span class="sd">        central_rotated_longitude value.</span>

<span class="sd">        Args:</span>

<span class="sd">            * pole_longitude - Pole longitude position, in unrotated degrees.</span>
<span class="sd">            * pole_latitude - Pole latitude position, in unrotated degrees.</span>
<span class="sd">            * central_rotated_longitude - Longitude rotation about the new</span>
<span class="sd">                                          pole, in degrees.</span>

<span class="sd">        Kwargs:</span>

<span class="sd">            * globe - An optional :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      Defaults to a &quot;WGS84&quot; datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_tran&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;latlon&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lon_p&#39;</span><span class="p">,</span> <span class="n">central_rotated_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lat_p&#39;</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">pole_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">globe</span> <span class="ow">or</span> <span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RotatedGeodetic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>


<div class="viewcode-block" id="Projection"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.Projection">[docs]</a><span class="k">class</span> <span class="nc">Projection</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="n">CRS</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a projected coordinate system with flat topology and Euclidean</span>
<span class="sd">    distance.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_method_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Point&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_point&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LineString&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_line_string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LinearRing&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_linear_ring&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_polygon&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MultiPoint&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_multipoint&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MultiLineString&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_multiline&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">:</span> <span class="s1">&#39;_project_multipolygon&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractproperty</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cw_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cw_boundary</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cw_boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="k">return</span> <span class="n">boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ccw_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccw_boundary</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ccw_boundary</span> <span class="o">=</span> <span class="n">boundary</span>
        <span class="k">return</span> <span class="n">boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">domain</span>

    <span class="k">def</span> <span class="nf">_as_mpl_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">cartopy.mpl.geoaxes</span> <span class="k">as</span> <span class="nn">geoaxes</span>
        <span class="k">return</span> <span class="n">geoaxes</span><span class="o">.</span><span class="n">GeoAxes</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;map_projection&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>

<div class="viewcode-block" id="Projection.project_geometry"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.Projection.project_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">project_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Projects the given geometry into this projection.</span>

<span class="sd">        :param geometry: The geometry to (re-)project.</span>
<span class="sd">        :param src_crs: The source CRS, or geodetic CRS if None.</span>
<span class="sd">        :rtype: Shapely geometry.</span>

<span class="sd">        If src_crs is None, the source CRS is assumed to be a geodetic</span>
<span class="sd">        version of the target CRS.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">src_crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">src_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">CRS</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Source CRS must be an instance of CRS&#39;</span>
                            <span class="s1">&#39; or one of its subclasses, or None.&#39;</span><span class="p">)</span>
        <span class="n">geom_type</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">geom_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unsupported geometry &#39;</span>
                             <span class="s1">&#39;type </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom_type</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_project_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_project_line_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">project_linear</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_project_linear_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linear_ring</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Projects the given LinearRing from the src_crs into this CRS and</span>
<span class="sd">        returns a list of LinearRings and a single MultiLineString.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># 1) Resolve the initial lines into projected segments</span>
        <span class="c1"># 1abc</span>
        <span class="c1"># def23ghi</span>
        <span class="c1"># jkl41</span>
        <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">project_linear</span><span class="p">(</span><span class="n">linear_ring</span><span class="p">,</span>
                                                         <span class="n">src_crs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Threshold for whether a point is close enough to be the same</span>
        <span class="c1"># point as another.</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">5</span>

        <span class="c1"># 2) Simplify the segments where appropriate.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Stitch together segments which are close to continuous.</span>
            <span class="c1"># This is important when:</span>
            <span class="c1"># 1) The first source point projects into the map and the</span>
            <span class="c1"># ring has been cut by the boundary.</span>
            <span class="c1"># Continuing the example from above this gives:</span>
            <span class="c1">#   def23ghi</span>
            <span class="c1">#   jkl41abc</span>
            <span class="c1"># 2) The cut ends of segments are too close to reliably</span>
            <span class="c1"># place into an order along the boundary.</span>

            <span class="n">line_strings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span>
            <span class="n">any_modified</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="n">first_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">line_strings</span><span class="p">])</span>
                <span class="n">last_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">line_strings</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Distance matrix:&#39;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">first_coord</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">last_coord</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                              <span class="n">atol</span><span class="o">=</span><span class="n">threshold</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Joining together </span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                        <span class="n">last_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                        <span class="n">first_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">combo</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">last_coords</span> <span class="o">+</span> <span class="n">first_coords</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span>
                        <span class="k">del</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">line_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
                        <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">any_modified</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">any_modified</span><span class="p">:</span>
                <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">line_strings</span><span class="p">)</span>

        <span class="c1"># 3) Check for rings that have been created by the projection stage.</span>
        <span class="n">rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">multi_line_string</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">atol</span><span class="o">=</span><span class="n">threshold</span><span class="p">):</span>
                <span class="n">result_geometry</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_geometry</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c1"># If we found any rings, then we should re-create the multi-line str.</span>
        <span class="k">if</span> <span class="n">rings</span><span class="p">:</span>
            <span class="n">multi_line_string</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">line_strings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rings</span><span class="p">,</span> <span class="n">multi_line_string</span>

    <span class="k">def</span> <span class="nf">_project_multipoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">geoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_point</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_project_multiline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_line_string</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiLineString</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_project_multipolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">geoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_polygon</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">geoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">geoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_project_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the projected polygon(s) derived from the given polygon.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine orientation of polygon.</span>
        <span class="c1"># TODO: Consider checking the internal rings have the opposite</span>
        <span class="c1"># orientation to the external rings?</span>
        <span class="k">if</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">is_geodetic</span><span class="p">():</span>
            <span class="n">is_ccw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_ccw</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">is_ccw</span>
        <span class="c1"># Project the polygon exterior/interior rings.</span>
        <span class="c1"># Each source ring will result in either a ring, or one or more</span>
        <span class="c1"># lines.</span>
        <span class="n">rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">multi_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">src_ring</span> <span class="ow">in</span> <span class="p">[</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">interiors</span><span class="p">):</span>
            <span class="n">p_rings</span><span class="p">,</span> <span class="n">p_mline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_linear_ring</span><span class="p">(</span><span class="n">src_ring</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p_rings</span><span class="p">:</span>
                <span class="n">rings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p_rings</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_mline</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">multi_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_mline</span><span class="p">)</span>

        <span class="c1"># Convert any lines to rings by attaching them to the boundary.</span>
        <span class="k">if</span> <span class="n">multi_lines</span><span class="p">:</span>
            <span class="n">rings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attach_lines_to_boundary</span><span class="p">(</span><span class="n">multi_lines</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">))</span>

        <span class="c1"># Resolve all the inside vs. outside rings, and convert to the</span>
        <span class="c1"># final MultiPolygon.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rings_to_multi_polygon</span><span class="p">(</span><span class="n">rings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attach_lines_to_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multi_line_strings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of LinearRings by attaching the ends of the given lines</span>
<span class="sd">        to the boundary, paying attention to the traversal directions of the</span>
<span class="sd">        lines and boundary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">debug_plot_edges</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Accumulate all the boundary and segment end points, along with</span>
        <span class="c1"># their distance along the boundary.</span>
        <span class="n">edge_things</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the boundary as a LineString of the correct orientation</span>
        <span class="c1"># so we can compute distances along it.</span>
        <span class="k">if</span> <span class="n">is_ccw</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ccw_boundary</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cw_boundary</span>

        <span class="k">def</span> <span class="nf">boundary_distance</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">boundary</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">))</span>

        <span class="c1"># Squash all the LineStrings into a single list.</span>
        <span class="n">line_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">multi_line_string</span> <span class="ow">in</span> <span class="n">multi_line_strings</span><span class="p">:</span>
            <span class="n">line_strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">multi_line_string</span><span class="p">)</span>

        <span class="c1"># Record the positions of all the segment ends</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_strings</span><span class="p">):</span>
            <span class="n">first_dist</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">first_dist</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
            <span class="n">last_dist</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">last_dist</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="c1"># Record the positions of all the boundary vertices</span>
        <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">boundary</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="n">thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
            <span class="n">edge_things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
            <span class="n">current_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="c1"># Reset the current figure so we don&#39;t upset anything.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">current_fig</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Order everything as if walking around the boundary.</span>
        <span class="c1"># NB. We make line end-points take precedence over boundary points</span>
        <span class="c1"># to ensure that end-points are still found and followed when they</span>
        <span class="c1"># coincide.</span>
        <span class="n">edge_things</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">thing</span><span class="p">:</span> <span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">thing</span><span class="o">.</span><span class="n">kind</span><span class="p">))</span>
        <span class="n">remaining_ls</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">line_strings</span><span class="p">))</span>

        <span class="n">prev_thing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">edge_thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prev_thing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">edge_thing</span><span class="o">.</span><span class="n">kind</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">prev_thing</span><span class="o">.</span><span class="n">kind</span> <span class="ow">and</span>
                    <span class="n">edge_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">prev_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">edge_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Insert a edge boundary point in between this geometry.</span>
                <span class="n">mid_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge_thing</span><span class="o">.</span><span class="n">distance</span> <span class="o">+</span> <span class="n">prev_thing</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">mid_dist</span><span class="p">)</span>
                <span class="n">new_thing</span> <span class="o">=</span> <span class="n">_BoundaryPoint</span><span class="p">(</span><span class="n">mid_dist</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">mid_point</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Artificially insert boundary: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_thing</span><span class="p">))</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">edge_things</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">edge_thing</span><span class="p">)</span>
                <span class="n">edge_things</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">new_thing</span><span class="p">)</span>
                <span class="n">prev_thing</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prev_thing</span> <span class="o">=</span> <span class="n">edge_thing</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Edge things&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   &#39;</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">edge_things</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">processed_ls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">remaining_ls</span><span class="p">:</span>
            <span class="c1"># Rename line_string to current_ls</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">current_ls</span> <span class="o">=</span> <span class="n">remaining_ls</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">sys</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">current_ls</span><span class="p">))</span>

            <span class="c1"># We only want to consider boundary-points, the starts-and-ends of</span>
            <span class="c1"># all other line-strings, or the start-point of the current</span>
            <span class="c1"># line-string.</span>
            <span class="k">def</span> <span class="nf">filter_fn</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">kind</span> <span class="ow">or</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">or</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;last&#39;</span><span class="p">)</span>

            <span class="n">edge_things</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">filter_fn</span><span class="p">,</span> <span class="n">edge_things</span><span class="p">))</span>

            <span class="n">added_linestring</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Find out how far around this linestring&#39;s last</span>
                <span class="c1"># point is on the boundary. We will use this to find</span>
                <span class="c1"># the next point on the boundary.</span>
                <span class="n">d_last</span> <span class="o">=</span> <span class="n">boundary_distance</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   d_last: </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_last</span><span class="p">))</span>
                <span class="n">next_thing</span> <span class="o">=</span> <span class="n">_find_first_gt</span><span class="p">(</span><span class="n">edge_things</span><span class="p">,</span> <span class="n">d_last</span><span class="p">)</span>
                <span class="c1"># Remove this boundary point from the edge.</span>
                <span class="n">edge_things</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">next_thing</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   next_thing:&#39;</span><span class="p">,</span> <span class="n">next_thing</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">kind</span><span class="p">:</span>
                    <span class="c1"># We&#39;ve just got a boundary point, add it, and keep going.</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   adding boundary point&#39;</span><span class="p">)</span>
                    <span class="n">boundary_point</span> <span class="o">=</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span>
                    <span class="n">combined_coords</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span>
                                       <span class="p">[(</span><span class="n">boundary_point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">boundary_point</span><span class="o">.</span><span class="n">y</span><span class="p">)])</span>
                    <span class="n">current_ls</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">combined_coords</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span>
                    <span class="c1"># We&#39;ve gone all the way around and are now back at the</span>
                    <span class="c1"># first boundary thing.</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   close loop&#39;</span><span class="p">)</span>
                    <span class="n">processed_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_ls</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
                        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   adding line&#39;</span><span class="p">)</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">line_to_append</span> <span class="o">=</span> <span class="n">line_strings</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">remaining_ls</span><span class="p">:</span>
                        <span class="n">remaining_ls</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">coords_to_append</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_to_append</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">next_thing</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;last&#39;</span><span class="p">:</span>
                        <span class="n">coords_to_append</span> <span class="o">=</span> <span class="n">coords_to_append</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># Build up the linestring.</span>
                    <span class="n">current_ls</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="nb">list</span><span class="p">(</span><span class="n">current_ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span>
                                                   <span class="n">coords_to_append</span><span class="p">))</span>

                    <span class="c1"># Catch getting stuck in an infinite loop by checking that</span>
                    <span class="c1"># linestring only added once.</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">added_linestring</span><span class="p">:</span>
                        <span class="n">added_linestring</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">debug_plot_edges</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unidentified problem with &#39;</span>
                                           <span class="s1">&#39;geometry, linestring being &#39;</span>
                                           <span class="s1">&#39;re-added. Please raise an issue.&#39;</span><span class="p">)</span>

        <span class="c1"># filter out any non-valid linear rings</span>
        <span class="n">processed_ls</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_ring</span> <span class="k">for</span> <span class="n">linear_ring</span> <span class="ow">in</span> <span class="n">processed_ls</span> <span class="k">if</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">linear_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">linear_rings</span> <span class="o">=</span> <span class="p">[</span><span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">processed_ls</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   DONE&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">linear_rings</span>

    <span class="k">def</span> <span class="nf">_rings_to_multi_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rings</span><span class="p">,</span> <span class="n">is_ccw</span><span class="p">):</span>
        <span class="n">exterior_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">interior_rings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ring</span><span class="o">.</span><span class="n">is_ccw</span> <span class="o">!=</span> <span class="n">is_ccw</span><span class="p">:</span>
                <span class="n">interior_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exterior_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>

        <span class="n">polygon_bits</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Turn all the exterior rings into polygon definitions,</span>
        <span class="c1"># &quot;slurping up&quot; any interior rings they contain.</span>
        <span class="k">for</span> <span class="n">exterior_ring</span> <span class="ow">in</span> <span class="n">exterior_rings</span><span class="p">:</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">exterior_ring</span><span class="p">)</span>
            <span class="n">prep_polygon</span> <span class="o">=</span> <span class="n">prep</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">interior_ring</span> <span class="ow">in</span> <span class="n">interior_rings</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="n">prep_polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">):</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                    <span class="n">interior_rings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">polygon</span><span class="o">.</span><span class="n">crosses</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">):</span>
                    <span class="c1"># Likely that we have an invalid geometry such as</span>
                    <span class="c1"># that from #509 or #537.</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
                    <span class="n">interior_rings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">interior_ring</span><span class="p">)</span>
            <span class="n">polygon_bits</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">exterior_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
                                 <span class="p">[</span><span class="n">ring</span><span class="o">.</span><span class="n">coords</span> <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">holes</span><span class="p">]))</span>

        <span class="c1"># Any left over &quot;interior&quot; rings need &quot;inverting&quot; with respect</span>
        <span class="c1"># to the boundary.</span>
        <span class="k">if</span> <span class="n">interior_rings</span><span class="p">:</span>
            <span class="n">boundary_poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">boundary_poly</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">x3</span> <span class="o">-=</span> <span class="n">bx</span>
            <span class="n">y3</span> <span class="o">-=</span> <span class="n">by</span>
            <span class="n">x4</span> <span class="o">+=</span> <span class="n">bx</span>
            <span class="n">y4</span> <span class="o">+=</span> <span class="n">by</span>
            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">interior_rings</span><span class="p">:</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span>
                    <span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">x1</span> <span class="o">-=</span> <span class="n">bx</span>
                    <span class="n">y1</span> <span class="o">-=</span> <span class="n">by</span>
                    <span class="n">x2</span> <span class="o">+=</span> <span class="n">bx</span>
                    <span class="n">y2</span> <span class="o">+=</span> <span class="n">by</span>
                    <span class="n">box</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span>
                                    <span class="nb">max</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x4</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">y4</span><span class="p">))</span>

                    <span class="c1"># Invert the polygon</span>
                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

                    <span class="c1"># Intersect the inverted polygon with the boundary</span>
                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">boundary_poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
                        <span class="n">polygon_bits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">polygon_bits</span><span class="p">:</span>
            <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">polygon_bits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multi_poly</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">multi_poly</span>

<div class="viewcode-block" id="Projection.quick_vertices_transform"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.Projection.quick_vertices_transform">[docs]</a>    <span class="k">def</span> <span class="nf">quick_vertices_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Where possible, return a vertices array transformed to this CRS from</span>
<span class="sd">        the given vertices array of shape ``(n, 2)`` and the source CRS.</span>

<span class="sd">        .. important::</span>

<span class="sd">            This method may return None to indicate that the vertices cannot</span>
<span class="sd">            be transformed quickly, and a more complex geometry transformation</span>
<span class="sd">            is required (see :meth:`cartopy.crs.Projection.project_geometry`).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">src_crs</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">x_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
            <span class="n">y_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">return_value</span> <span class="o">=</span> <span class="n">vertices</span>

        <span class="k">return</span> <span class="n">return_value</span></div></div>


<span class="k">class</span> <span class="nc">_RectangularProjection</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract superclass of projections with a rectangular domain which</span>
<span class="sd">    is symmetric about the origin.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">half_width</span><span class="p">,</span> <span class="n">half_height</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span> <span class="o">=</span> <span class="n">half_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span> <span class="o">=</span> <span class="n">half_height</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># XXX Should this be a LinearRing?</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_width</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_half_height</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_CylindricalProjection</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract class which denotes cylindrical projections where we</span>
<span class="sd">    want to allow x values to wrap around.</span>

<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_ellipse_boundary</span><span class="p">(</span><span class="n">semimajor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">semiminor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">201</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a projection boundary using an ellipse.</span>

<span class="sd">    This type of boundary is used by several projections.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">semimajor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">semiminor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
    <span class="n">coords</span> <span class="o">+=</span> <span class="p">([</span><span class="n">easting</span><span class="p">],</span> <span class="p">[</span><span class="n">northing</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">coords</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<div class="viewcode-block" id="PlateCarree"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.PlateCarree">[docs]</a><span class="k">class</span> <span class="nc">PlateCarree</span><span class="p">(</span><span class="n">_CylindricalProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;eqc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">globe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">a_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">a_rad</span> <span class="o">*</span> <span class="mi">180</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">a_rad</span> <span class="o">*</span> <span class="mi">90</span>
        <span class="c1"># Set the threshold around 0.5 if the x max is 180.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">/</span> <span class="mf">360.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                                          <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="k">def</span> <span class="nf">_bbox_and_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_plate_carree</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a pair of (xmin, xmax) pairs and an offset which can be used</span>
<span class="sd">        for identification of whether data in ``other_plate_carree`` needs</span>
<span class="sd">        to be transformed to wrap appropriately.</span>

<span class="sd">        &gt;&gt;&gt; import cartopy.crs as ccrs</span>
<span class="sd">        &gt;&gt;&gt; src = ccrs.PlateCarree(central_longitude=10)</span>
<span class="sd">        &gt;&gt;&gt; bboxes, offset = ccrs.PlateCarree()._bbox_and_offset(src)</span>
<span class="sd">        &gt;&gt;&gt; print(bboxes)</span>
<span class="sd">        [[-180.0, -170.0], [-170.0, 180.0]]</span>
<span class="sd">        &gt;&gt;&gt; print(offset)</span>
<span class="sd">        10.0</span>

<span class="sd">        The returned values are longitudes in ``other_plate_carree``&#39;s</span>
<span class="sd">        coordinate system.</span>

<span class="sd">        .. important::</span>

<span class="sd">            The two CRSs must be identical in every way, other than their</span>
<span class="sd">            central longitudes. No checking of this is done.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
        <span class="n">other_lon_0</span> <span class="o">=</span> <span class="n">other_plate_carree</span><span class="o">.</span><span class="n">proj4_params</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>

        <span class="n">lon_0_offset</span> <span class="o">=</span> <span class="n">other_lon_0</span> <span class="o">-</span> <span class="n">self_lon_0</span>

        <span class="n">lon_lower_bound_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon_lower_bound_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">other_plate_carree</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lon_0_offset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lon_lower_bound_1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">lon_lower_bound_1</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span><span class="p">])</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[[</span><span class="n">lon_lower_bound_0</span><span class="p">,</span> <span class="n">lon_lower_bound_1</span><span class="p">],</span>
                <span class="p">[</span><span class="n">lon_lower_bound_1</span><span class="p">,</span> <span class="n">lon_lower_bound_0</span><span class="p">]]</span>

        <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">lon_0_offset</span>

    <span class="k">def</span> <span class="nf">quick_vertices_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">,</span>
                             <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">quick_vertices_transform</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>

        <span class="c1"># Optimise the PlateCarree -&gt; PlateCarree case where no</span>
        <span class="c1"># wrapping or interpolation needs to take place.</span>
        <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">PlateCarree</span><span class="p">):</span>
            <span class="n">self_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj4_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">src_params</span> <span class="o">=</span> <span class="n">src_crs</span><span class="o">.</span><span class="n">proj4_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">self_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">),</span> <span class="n">src_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">)</span>

            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">potential</span> <span class="o">=</span> <span class="p">(</span><span class="n">self_params</span> <span class="o">==</span> <span class="n">src_params</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">and</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">potential</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">src_crs</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bboxes</span><span class="p">,</span> <span class="n">proj_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bbox_and_offset</span><span class="p">(</span><span class="n">src_crs</span><span class="p">)</span>
                <span class="n">x_lim</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">y_lim</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
                    <span class="c1"># Arbitrarily choose the number of moduli to look</span>
                    <span class="c1"># above and below the -180-&gt;180 range. If data is beyond</span>
                    <span class="c1"># this range, we&#39;re not going to transform it quickly.</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">mod</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="n">proj_offset</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">x_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="n">return_value</span> <span class="o">=</span> <span class="n">vertices</span> <span class="o">+</span> <span class="p">[[</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">return_value</span></div>


<div class="viewcode-block" id="TransverseMercator"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.TransverseMercator">[docs]</a><span class="k">class</span> <span class="nc">TransverseMercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Transverse Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The true longitude of the central meridian in</span>
<span class="sd">                                  degrees. Defaults to 0.</span>
<span class="sd">            * central_latitude - The true latitude of the planar origin in</span>
<span class="sd">                                 degrees. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from the planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from the planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * scale_factor - Scale factor at the central meridian. Defaults</span>
<span class="sd">                             to 1.</span>
<span class="sd">            * globe - An instance of :class:`cartopy.crs.Globe`. If omitted, a</span>
<span class="sd">                      default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;tmerc&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">e7</span><span class="p">,</span> <span class="mi">2</span><span class="n">e7</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">e7</span><span class="p">,</span> <span class="mi">1</span><span class="n">e7</span><span class="p">)</span></div>


<div class="viewcode-block" id="OSGB"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.OSGB">[docs]</a><span class="k">class</span> <span class="nc">OSGB</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OSGB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mi">49</span><span class="p">,</span>
                                   <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.9996012717</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="o">=</span><span class="mi">400000</span><span class="p">,</span>
                                   <span class="n">false_northing</span><span class="o">=-</span><span class="mi">100000</span><span class="p">,</span>
                                   <span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="s1">&#39;OSGB36&#39;</span><span class="p">,</span> <span class="n">ellipse</span><span class="o">=</span><span class="s1">&#39;airy&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="n">e5</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="n">e5</span><span class="p">)</span></div>


<div class="viewcode-block" id="OSNI"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.OSNI">[docs]</a><span class="k">class</span> <span class="nc">OSNI</span><span class="p">(</span><span class="n">TransverseMercator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="mf">6377340.189</span><span class="p">,</span>
                      <span class="n">semiminor_axis</span><span class="o">=</span><span class="mf">6356034.447938534</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OSNI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mi">8</span><span class="p">,</span>
                                   <span class="n">central_latitude</span><span class="o">=</span><span class="mf">53.5</span><span class="p">,</span>
                                   <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.000035</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
                                   <span class="n">false_northing</span><span class="o">=</span><span class="mi">250000</span><span class="p">,</span>
                                   <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">18814.9667</span><span class="p">,</span> <span class="mf">386062.3293</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">11764.8481</span><span class="p">,</span> <span class="mf">464720.9559</span><span class="p">)</span></div>


<div class="viewcode-block" id="UTM"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.UTM">[docs]</a><span class="k">class</span> <span class="nc">UTM</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Universal Transverse Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">southern_hemisphere</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * zone - the numeric zone of the UTM required.</span>

<span class="sd">            * globe - An instance of :class:`cartopy.crs.Globe`. If omitted, a</span>
<span class="sd">                      default globe is created.</span>

<span class="sd">            * southern_hemisphere - set to True if the zone is in the southern</span>
<span class="sd">                                    hemisphere, defaults to False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;utm&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;zone&#39;</span><span class="p">,</span> <span class="n">zone</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">southern_hemisphere</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;south&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UTM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">easting</span> <span class="o">=</span> <span class="mi">5</span><span class="n">e5</span>
        <span class="c1"># allow 50% overflow</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">easting</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">easting</span> <span class="o">+</span> <span class="n">easting</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">northing</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e7</span>
        <span class="c1"># allow 50% overflow</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">northing</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">northing</span> <span class="o">+</span> <span class="n">northing</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="EuroPP"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.EuroPP">[docs]</a><span class="k">class</span> <span class="nc">EuroPP</span><span class="p">(</span><span class="n">UTM</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    UTM Zone 32 projection for EuroPP domain.</span>

<span class="sd">    Ellipsoid is International 1924, Datum is ED50.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="s1">&#39;intl&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EuroPP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4e6</span><span class="p">,</span> <span class="mi">2</span><span class="n">e6</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="n">e6</span><span class="p">,</span> <span class="mf">7.9e6</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mercator"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Mercator">[docs]</a><span class="k">class</span> <span class="nc">Mercator</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Mercator projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">min_latitude</span><span class="o">=-</span><span class="mf">80.0</span><span class="p">,</span> <span class="n">max_latitude</span><span class="o">=</span><span class="mf">84.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latitude_true_scale</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - the central longitude. Defaults to 0.</span>
<span class="sd">            * min_latitude - the maximum southerly extent of the projection.</span>
<span class="sd">                             Defaults to -80 degrees.</span>
<span class="sd">            * max_latitude - the maximum northerly extent of the projection.</span>
<span class="sd">                             Defaults to 84 degrees.</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>
<span class="sd">            * latitude_true_scale - the latitude where the scale is 1.</span>
<span class="sd">                                    Defaults to 0 degrees.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="n">latitude_true_scale</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Mercator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Calculate limits.</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">Geodetic</span><span class="p">(),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span>
                                                 <span class="mi">180</span><span class="p">])</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">min_latitude</span><span class="p">,</span> <span class="n">max_latitude</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">720</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Mercator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;_ylimits&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;_xlimits&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_ylimits</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_xlimits</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlimits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylimits</span></div>


<span class="c1"># Define a specific instance of a Mercator projection, the Google mercator.</span>
<span class="n">Mercator</span><span class="o">.</span><span class="n">GOOGLE</span> <span class="o">=</span> <span class="n">Mercator</span><span class="p">(</span><span class="n">min_latitude</span><span class="o">=-</span><span class="mf">85.0511287798066</span><span class="p">,</span>
                           <span class="n">max_latitude</span><span class="o">=</span><span class="mf">85.0511287798066</span><span class="p">,</span>
                           <span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">semimajor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">,</span>
                                       <span class="n">semiminor_axis</span><span class="o">=</span><span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">,</span>
                                       <span class="n">nadgrids</span><span class="o">=</span><span class="s1">&#39;@null&#39;</span><span class="p">))</span>
<span class="c1"># Deprecated form</span>
<span class="n">GOOGLE_MERCATOR</span> <span class="o">=</span> <span class="n">Mercator</span><span class="o">.</span><span class="n">GOOGLE</span>


<div class="viewcode-block" id="LambertCylindrical"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.LambertCylindrical">[docs]</a><span class="k">class</span> <span class="nc">LambertCylindrical</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;cea&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LambertCylindrical</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span>
                                                 <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span></div>


<div class="viewcode-block" id="LambertConformal"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.LambertConformal">[docs]</a><span class="k">class</span> <span class="nc">LambertConformal</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Lambert Conformal conic projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=-</span><span class="mf">96.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">39.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">secant_latitudes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=-</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The central longitude. Defaults to -96.</span>
<span class="sd">            * central_latitude - The central latitude. Defaults to 39.</span>
<span class="sd">            * false_easting - X offset from planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * standard_parallels - Standard parallel latitude(s).</span>
<span class="sd">                                   Defaults to (33, 45).</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>
<span class="sd">            * cutoff - Latitude of map cutoff.</span>
<span class="sd">                       The map extends to infinity opposite the central pole</span>
<span class="sd">                       so we must cut off the map drawing before then.</span>
<span class="sd">                       A value of 0 will draw half the globe. Defaults to -30.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;lcc&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">secant_latitudes</span> <span class="ow">and</span> <span class="n">standard_parallels</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;standard_parallels replaces secant_latitudes.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">secant_latitudes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;secant_latitudes has been deprecated in v0.12. &#39;</span>
                          <span class="s1">&#39;The standard_parallels keyword can be used as a &#39;</span>
                          <span class="s1">&#39;direct replacement.&#39;</span><span class="p">)</span>
            <span class="n">standard_parallels</span> <span class="o">=</span> <span class="n">secant_latitudes</span>
        <span class="k">elif</span> <span class="n">standard_parallels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The default. Put this as a keyword arg default once</span>
            <span class="c1"># secant_latitudes is removed completely.</span>
            <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>

        <span class="n">n_parallels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">standard_parallels</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n_parallels</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;1 or 2 standard parallels must be specified. &#39;</span>
                             <span class="s1">&#39;Got </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_parallels</span><span class="p">,</span>
                                                  <span class="n">standard_parallels</span><span class="p">))</span>

        <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">n_parallels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">LambertConformal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Compute whether this projection is at the &quot;north pole&quot; or the</span>
        <span class="c1"># &quot;south pole&quot; (after the central lon/lat have been taken into</span>
        <span class="c1"># account).</span>
        <span class="k">if</span> <span class="n">n_parallels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plat</span> <span class="o">=</span> <span class="mi">90</span> <span class="k">if</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Which pole are the parallels closest to? That is the direction</span>
            <span class="c1"># that the cone converges.</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">poliest_sec</span> <span class="o">=</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">poliest_sec</span> <span class="o">=</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">plat</span> <span class="o">=</span> <span class="mi">90</span> <span class="k">if</span> <span class="n">poliest_sec</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">90</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">plat</span><span class="p">]</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">central_longitude</span> <span class="o">-</span> <span class="mi">180</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">,</span>
                                <span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">lats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cutoff</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plat</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">plat</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
            <span class="c1"># Ensure clockwise</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LambertConformal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<div class="viewcode-block" id="LambertAzimuthalEqualArea"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.LambertAzimuthalEqualArea">[docs]</a><span class="k">class</span> <span class="nc">LambertAzimuthalEqualArea</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Lambert Azimuthal Equal-Area projection.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The central longitude. Defaults to 0.</span>
<span class="sd">            * central_latitude - The central latitude. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;laea&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">LambertAzimuthalEqualArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span>
                                                        <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMINOR_AXIS</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span> <span class="n">central_latitude</span> <span class="o">+</span> <span class="mf">0.01</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">PlateCarree</span><span class="p">())</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">1.9999</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">false_northing</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">3</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<div class="viewcode-block" id="Miller"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Miller">[docs]</a><span class="k">class</span> <span class="nc">Miller</span><span class="p">(</span><span class="n">_RectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;mill&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="n">globe</span> <span class="o">=</span> <span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># XXX How can we derive the vertical limit of 131.98?</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Miller</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">131.98</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span></div>


<div class="viewcode-block" id="RotatedPole"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.RotatedPole">[docs]</a><span class="k">class</span> <span class="nc">RotatedPole</span><span class="p">(</span><span class="n">_CylindricalProjection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a rotated latitude/longitude projected coordinate system</span>
<span class="sd">    with cylindrical topology and projected distance.</span>

<span class="sd">    Coordinates are measured in projection metres.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span>
                 <span class="n">central_rotated_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a RotatedPole CRS.</span>

<span class="sd">        The class uses proj4 to perform an ob_tran operation, using the</span>
<span class="sd">        pole_longitude to set a lon_0 then performing two rotations based on</span>
<span class="sd">        pole_latitude and central_rotated_longitude.</span>
<span class="sd">        This is equivalent to setting the new pole to a location defined by</span>
<span class="sd">        the pole_latitude and pole_longitude values in the GeogCRS defined by</span>
<span class="sd">        globe, then rotating this new CRS about it&#39;s pole using the</span>
<span class="sd">        central_rotated_longitude value.</span>

<span class="sd">        Args:</span>

<span class="sd">            * pole_longitude - Pole longitude position, in unrotated degrees.</span>
<span class="sd">            * pole_latitude - Pole latitude position, in unrotated degrees.</span>
<span class="sd">            * central_rotated_longitude - Longitude rotation about the new</span>
<span class="sd">                                          pole, in degrees.</span>

<span class="sd">        Kwargs:</span>

<span class="sd">            * globe - An optional :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      Defaults to a &quot;WGS84&quot; datum.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;ob_tran&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o_proj&#39;</span><span class="p">,</span> <span class="s1">&#39;latlon&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lon_p&#39;</span><span class="p">,</span> <span class="n">central_rotated_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;o_lat_p&#39;</span><span class="p">,</span> <span class="n">pole_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="mi">180</span> <span class="o">+</span> <span class="n">pole_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;to_meter&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RotatedPole</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span></div>


<div class="viewcode-block" id="Gnomonic"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Gnomonic">[docs]</a><span class="k">class</span> <span class="nc">Gnomonic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;gnom&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Gnomonic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="mi">5</span><span class="n">e7</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span><span class="o">.</span><span class="n">exterior</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stereographic"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Stereographic">[docs]</a><span class="k">class</span> <span class="nc">Stereographic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">true_scale_latitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;stere&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">true_scale_latitude</span><span class="p">:</span>
            <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="n">true_scale_latitude</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMINOR_AXIS</span><span class="p">)</span>

        <span class="c1"># Note: The magic number has been picked to maintain consistent</span>
        <span class="c1"># behaviour with a wgs84 globe. There is no guarantee that the scaling</span>
        <span class="c1"># should even be linear.</span>
        <span class="n">x_axis_offset</span> <span class="o">=</span> <span class="mi">5</span><span class="n">e7</span> <span class="o">/</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span>
        <span class="n">y_axis_offset</span> <span class="o">=</span> <span class="mi">5</span><span class="n">e7</span> <span class="o">/</span> <span class="n">WGS84_SEMIMINOR_AXIS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">*</span> <span class="n">x_axis_offset</span> <span class="o">+</span> <span class="n">false_easting</span><span class="p">,</span>
                          <span class="n">a</span> <span class="o">*</span> <span class="n">x_axis_offset</span> <span class="o">+</span> <span class="n">false_easting</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="n">y_axis_offset</span> <span class="o">+</span> <span class="n">false_northing</span><span class="p">,</span>
                          <span class="n">b</span> <span class="o">*</span> <span class="n">y_axis_offset</span> <span class="o">+</span> <span class="n">false_northing</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">exterior</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">3</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<div class="viewcode-block" id="NorthPolarStereo"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.NorthPolarStereo">[docs]</a><span class="k">class</span> <span class="nc">NorthPolarStereo</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NorthPolarStereo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>


<div class="viewcode-block" id="SouthPolarStereo"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.SouthPolarStereo">[docs]</a><span class="k">class</span> <span class="nc">SouthPolarStereo</span><span class="p">(</span><span class="n">Stereographic</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SouthPolarStereo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">central_latitude</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>


<div class="viewcode-block" id="Orthographic"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Orthographic">[docs]</a><span class="k">class</span> <span class="nc">Orthographic</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;ortho&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Orthographic</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="n">a</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The proj4 &quot;ortho&quot; projection does not appear to &#39;</span>
                          <span class="s1">&#39;handle elliptical globes.&#39;</span><span class="p">)</span>

        <span class="c1"># To stabilise the projection of geometries, we reduce the boundary by</span>
        <span class="c1"># a tiny fraction at the cost of the extreme edges.</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">0.99999</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="mf">0.99999</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.02</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span></div>


<span class="k">class</span> <span class="nc">_WarpedRectangularProjection</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span>
                                                           <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Obtain boundary points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">geodetic_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                     <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                     <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span>


<div class="viewcode-block" id="Mollweide"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Mollweide">[docs]</a><span class="k">class</span> <span class="nc">Mollweide</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Mollweide</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                                        <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e5</span></div>


<div class="viewcode-block" id="Robinson"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Robinson">[docs]</a><span class="k">class</span> <span class="nc">Robinson</span><span class="p">(</span><span class="n">_WarpedRectangularProjection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Warn when using Robinson with proj4 4.8 due to discontinuity at</span>
        <span class="c1"># 40 deg N introduced by incomplete fix to issue #113 (see</span>
        <span class="c1"># https://trac.osgeo.org/proj/ticket/113).</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="k">if</span> <span class="n">PROJ4_VERSION</span> <span class="o">!=</span> <span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">PROJ4_VERSION</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The Robinson projection in the v4.8.x series &#39;</span>
                              <span class="s1">&#39;of Proj.4 contains a discontinuity at &#39;</span>
                              <span class="s1">&#39;40 deg latitude. Use this projection with &#39;</span>
                              <span class="s1">&#39;caution.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot determine Proj.4 version. The Robinson &#39;</span>
                          <span class="s1">&#39;projection may be unreliable and should be used &#39;</span>
                          <span class="s1">&#39;with caution.&#39;</span><span class="p">)</span>

        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Robinson</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">,</span>
                                       <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e4</span>

    <span class="k">def</span> <span class="nf">transform_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture and handle any input NaNs, else invoke parent function,</span>
<span class="sd">        :meth:`_WarpedRectangularProjection.transform_point`.</span>

<span class="sd">        Needed because input NaNs can trigger a fatal error in the underlying</span>
<span class="sd">        implementation of the Robinson projection.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Although the original can in fact translate (nan, lat) into</span>
<span class="sd">            (nan, y-value), this patched version doesn&#39;t support that.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Robinson</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture and handle NaNs in input points -- else as parent function,</span>
<span class="sd">        :meth:`_WarpedRectangularProjection.transform_points`.</span>

<span class="sd">        Needed because input NaNs can trigger a fatal error in the underlying</span>
<span class="sd">        implementation of the Robinson projection.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Although the original can in fact translate (nan, lat) into</span>
<span class="sd">            (nan, y-value), this patched version doesn&#39;t support that.</span>
<span class="sd">            Instead, we invalidate any of the points that contain a NaN.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_point_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">input_point_nans</span> <span class="o">|=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">handle_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">input_point_nans</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle_nans</span><span class="p">:</span>
            <span class="c1"># Remove NaN points from input data to avoid the error.</span>
            <span class="n">x</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">y</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">z</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Robinson</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">src_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handle_nans</span><span class="p">:</span>
            <span class="c1"># Result always has shape (N, 3).</span>
            <span class="c1"># Blank out each (whole) point where we had a NaN in the input.</span>
            <span class="n">result</span><span class="p">[</span><span class="n">input_point_nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="InterruptedGoodeHomolosine"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.InterruptedGoodeHomolosine">[docs]</a><span class="k">class</span> <span class="nc">InterruptedGoodeHomolosine</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;igh&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InterruptedGoodeHomolosine</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span>
                                                         <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Obtain boundary points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">31</span>
        <span class="n">geodetic_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>

        <span class="c1"># Right boundary</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                               <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c1"># Top boundary</span>
        <span class="n">interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">interrupted_lons</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c1"># Left boundary</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                               <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c1"># Bottom boundary</span>
        <span class="n">interrupted_lons</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">interrupted_lons</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">+</span>
                                                   <span class="n">central_longitude</span><span class="p">,</span>
                                                   <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="c1"># Close loop</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span>
                                           <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="n">e4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<span class="k">class</span> <span class="nc">_Satellite</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="n">projection</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">satellite_height</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_Satellite</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">satellite_height</span><span class="p">)</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">h</span><span class="p">))</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.02</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xlim</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ylim</span>


<div class="viewcode-block" id="Geostationary"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Geostationary">[docs]</a><span class="k">class</span> <span class="nc">Geostationary</span><span class="p">(</span><span class="n">_Satellite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perspective view looking directly down from above a point on the equator.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Geostationary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span>
            <span class="n">satellite_height</span><span class="o">=</span><span class="n">satellite_height</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
            <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>


<div class="viewcode-block" id="NearsidePerspective"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.NearsidePerspective">[docs]</a><span class="k">class</span> <span class="nc">NearsidePerspective</span><span class="p">(</span><span class="n">_Satellite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perspective view looking directly down from above a point on the globe.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35785831</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NearsidePerspective</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;nsper&#39;</span><span class="p">,</span>
            <span class="n">satellite_height</span><span class="o">=</span><span class="n">satellite_height</span><span class="p">,</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
            <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
            <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
            <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span></div>


<div class="viewcode-block" id="AlbersEqualArea"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.AlbersEqualArea">[docs]</a><span class="k">class</span> <span class="nc">AlbersEqualArea</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Albers Equal Area projection</span>

<span class="sd">    This projection is conic and equal-area, and is commonly used for maps of</span>
<span class="sd">    the conterminous United States.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">standard_parallels</span><span class="o">=</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The central longitude. Defaults to 0.</span>
<span class="sd">            * central_latitude - The central latitude. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * standard_parallels - The one or two latitudes of correct scale.</span>
<span class="sd">                                   Defaults to (20, 50).</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;aea&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">standard_parallels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">proj4_params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AlbersEqualArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># bounds</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">103</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">central_longitude</span> <span class="o">-</span> <span class="mi">180</span><span class="p">,</span> <span class="n">central_longitude</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">lats</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lats</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<div class="viewcode-block" id="AzimuthalEquidistant"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.AzimuthalEquidistant">[docs]</a><span class="k">class</span> <span class="nc">AzimuthalEquidistant</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Azimuthal Equidistant projection</span>

<span class="sd">    This projection provides accurate angles about and distances through the</span>
<span class="sd">    central position. Other angles, distances, or areas may be distorted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The true longitude of the central meridian in</span>
<span class="sd">                                  degrees. Defaults to 0.</span>
<span class="sd">            * central_latitude - The true latitude of the planar origin in</span>
<span class="sd">                                 degrees. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from the planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from the planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * globe - An instance of :class:`cartopy.crs.Globe`. If omitted, a</span>
<span class="sd">                      default globe is created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Warn when using Azimuthal Equidistant with proj4 &lt; 4.9.2 due to</span>
        <span class="c1"># incorrect transformation past 90 deg distance (see</span>
        <span class="c1"># https://github.com/OSGeo/proj.4/issues/246).</span>
        <span class="k">if</span> <span class="n">PROJ4_VERSION</span> <span class="o">!=</span> <span class="p">():</span>
            <span class="k">if</span> <span class="n">PROJ4_VERSION</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The Azimuthal Equidistant projection in Proj.4 &#39;</span>
                              <span class="s1">&#39;older than 4.9.2 incorrectly transforms points &#39;</span>
                              <span class="s1">&#39;farther than 90 deg from the origin. Use this &#39;</span>
                              <span class="s1">&#39;projection with caution.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Cannot determine Proj.4 version. The Azimuthal &#39;</span>
                          <span class="s1">&#39;Equidistant projection may be unreliable and &#39;</span>
                          <span class="s1">&#39;should be used with caution.&#39;</span><span class="p">)</span>

        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;aeqd&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="n">central_latitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AzimuthalEquidistant</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># TODO: Let the globe return the semimajor axis always.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semimajor_axis</span> <span class="ow">or</span> <span class="n">WGS84_SEMIMAJOR_AXIS</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">globe</span><span class="o">.</span><span class="n">semiminor_axis</span> <span class="ow">or</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">_ellipse_boundary</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                   <span class="n">false_easting</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">e5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<div class="viewcode-block" id="Sinusoidal"><a class="viewcode-back" href="../../crs/projections.html#cartopy.crs.Sinusoidal">[docs]</a><span class="k">class</span> <span class="nc">Sinusoidal</span><span class="p">(</span><span class="n">Projection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Sinusoidal projection.</span>

<span class="sd">    This projection is equal-area.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kwargs:</span>

<span class="sd">            * central_longitude - The central longitude. Defaults to 0.</span>
<span class="sd">            * false_easting - X offset from planar origin in metres.</span>
<span class="sd">                              Defaults to 0.</span>
<span class="sd">            * false_northing - Y offset from planar origin in metres.</span>
<span class="sd">                               Defaults to 0.</span>
<span class="sd">            * globe - A :class:`cartopy.crs.Globe`.</span>
<span class="sd">                      If omitted, a default globe is created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proj4_params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;proj&#39;</span><span class="p">,</span> <span class="s1">&#39;sinu&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span> <span class="n">false_easting</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;y_0&#39;</span><span class="p">,</span> <span class="n">false_northing</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Sinusoidal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">proj4_params</span><span class="p">,</span> <span class="n">globe</span><span class="o">=</span><span class="n">globe</span><span class="p">)</span>

        <span class="c1"># Obtain boundary points</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="n">geodetic_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_geodetic</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                     <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span>
                                     <span class="n">lat</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">central_longitude</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">geodetic_crs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span><span class="o">.</span><span class="n">bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span> <span class="o">=</span> <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span> <span class="o">=</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_limits</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_limits</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">5</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_limits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_limits</span></div>


<span class="c1"># MODIS data products use a Sinusoidal projection of a spherical Earth</span>
<span class="c1"># http://modis-land.gsfc.nasa.gov/GCTP.html</span>
<span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span> <span class="o">=</span> <span class="n">Sinusoidal</span><span class="p">(</span><span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">semimajor_axis</span><span class="o">=</span><span class="mf">6371007.181</span><span class="p">,</span>
                                          <span class="n">semiminor_axis</span><span class="o">=</span><span class="mf">6371007.181</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">_BoundaryPoint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A representation for a geometric object which is</span>
<span class="sd">        connected to the boundary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        distance - float</span>
<span class="sd">            The distance along the boundary that this object</span>
<span class="sd">            can be found.</span>
<span class="sd">        kind - bool</span>
<span class="sd">            Whether this object represents a point from the pre-computed</span>
<span class="sd">            boundary.</span>
<span class="sd">        data - point or namedtuple</span>
<span class="sd">            The actual data that this boundary object represents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;_BoundaryPoint(</span><span class="si">%r</span><span class="s1">, </span><span class="si">%r</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_find_first_gt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>
    <span class="c1"># We&#39;ve gone all the way around, so pick the first point again.</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<div class="viewcode-block" id="epsg"><a class="viewcode-back" href="../../crs/index.html#cartopy.crs.epsg">[docs]</a><span class="k">def</span> <span class="nf">epsg</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the projection which corresponds to the given EPSG code.</span>

<span class="sd">    The EPSG code must correspond to a &quot;projected coordinate system&quot;,</span>
<span class="sd">    so EPSG codes such as 4326 (WGS-84) which define a &quot;geodetic coordinate</span>
<span class="sd">    system&quot; will not work.</span>

<span class="sd">    .. note::</span>
<span class="sd">        The conversion is performed by querying https://epsg.io/ so a</span>
<span class="sd">        live internet connection is required.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">cartopy._epsg</span>
    <span class="k">return</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">_epsg</span><span class="o">.</span><span class="n">_EPSGProjection</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../cartopy_outline.html" title="Module outline"
             >outline</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../gallery.html">gallery</a>|&nbsp;</li>
        

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer">
    <p style="text-align: left; float: left; margin: 0px; padding: 0 0 0 5px;">Documentation licensed under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/2/" rel="license">Open Government Licence</a></p>
        &copy; <a href="../../copyright.html">British Crown Copyright</a> 2011 - 2017, Met Office
    </div>

    <!-- Point to the *latest* version switcher. This will allow the latest versions to appear on older documentation. -->
    <script type="text/javascript" src="https://scitools.org.uk/cartopy/docs/latest/_static/version_switch.js"></script>


  </body>
</html>